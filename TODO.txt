ip n| grep ^10|grep :| while read LINE; do IP="$( echo "$LINE"| cut -d' ' -f1)"; echo $IP;done | sort -n| while read IP; do echo "$IP"; nc 2>/dev/null "$IP" 554 2>/dev/null && echo "OK $IP"; done

# wget -qO - "http://10.63.43.253/msx/" | sed "s/.*<a href='\(.*\)'>.*/\1/g"
# -> /msx/Radio_Sputnik-Livemitschnitt-Terminal_A-Track1.mp3
# http://10.63.43.253/msx/Radio_Sputnik-Livemitschnitt-Terminal_A-Track1.mp3

# auch total lahm, 21.dez.16 uhr
root@DG-Fries36-Wohnzimmer:~ _wifi minstrel 10.63.22.68 debug
lq=;nlq=;cost=;Dec 21 15:54:48 ' [up 41580s 6295552 bytes free] TERM:xterm -ash [daemon.debug] minstrel_out() output of /sys/kernel/debug/ieee80211/phy0/netdev:wlan0-1/stations/00:21:6a:32:7c:1c/rc_stats
 type           rate      tpt eprob *prob ret  *ok(*cum)        ok(      cum)
 CCK/LP          1.0M     0.6  72.6 100.0   2    0(   0)       119(      536)
 CCK/SP          2.0M     0.0   5.9   0.0   2    0(   0)         1(       11)
 CCK/SP          5.5M     0.0   8.7   0.0   2    0(   0)        85(      270)
 CCK/SP         11.0M     1.9  29.1  33.3   3    0(   0)       125(      425)
 HT20/LGI  BCDP MCS0      1.2  19.6   0.0   2    0(  45)       115(     1003)
 HT20/LGI       MCS1      0.0   0.0   0.0   0    0(   0)         0(        2)
 HT20/LGI       MCS2      0.0   0.0   0.0   0    0(   0)         0(        3)
 HT20/LGI       MCS3      0.0   9.5   0.0   5    0(   0)        10(       52)
 HT20/LGI       MCS4      0.0   0.0   0.0   0    0(   0)         0(        2)
 HT20/LGI       MCS5      0.0   0.0   0.0   0    0(   0)         0(        3)
 HT20/LGI       MCS6      0.0   7.2   0.0   4    0(   0)        76(      763)
 HT20/LGI       MCS7      0.0   0.0   0.0   0    0(   0)         0(        2)
 HT20/LGI       MCS8      0.0   9.2   0.0   4    0(   0)         4(       39)
 HT20/LGI       MCS9      0.0   0.0   0.0   0    0(   0)         0(        1)
 HT20/LGI       MCS10     0.0   0.0   0.0   0    0(   0)         0(        3)
 HT20/LGI       MCS11     0.0   6.3   0.0   5    0(   0)        20(      152)
 HT20/LGI       MCS12     0.0   7.8   0.0   1    0(   0)        54(      446)
 HT20/LGI A     MCS13    20.1  26.6   0.0   5    0(  54)       222(     1250)
 HT20/LGI       MCS14     0.0   0.0   0.0   0    0(   0)         0(        2)
 HT20/LGI       MCS15     0.0   0.0   0.0   0    0(   0)         0(        2)




# cut -d' ' -f1 /proc/modules | while read M; do echo $M; rmmod $M; done

# linksys: fe80::213:10ff:fe14:c4fe%wlan1
#          fe80::213:10ff:fe14:c4fc%eth1

root@4G-meshcube:/tmp sysupgrade -n -v /tmp/fw
killall: watchdog: no process killed
Sending TERM to remaining processes ... logd netifd odhcpd dnsmasq fakedns uhttpd crond olsrd askfirst
Sending KILL to remaining processes ... askfirst
Switching to ramdisk...
Performing system upgrade...
Unlocking kernel ...

Writing from <stdin> to kernel ...
Unlocking rootfs ...

Writing from <stdin> to rootfs ...
Upgrade completed
Rebooting system...

ssh: Connection to root@fe80::20e:56ff:fe00:fc53.115302e-314th1:22 exited: Error reading:






# A="$( seq 1 256 )"; I=10000; date +%s; while let I-=1;do logger "$A";done; date +%s

CHANNELS="$( iw phy phy0 info | fgrep ' MHz ' | grep -v 'disabled' | cut -d'[' -f2 | cut -d']' -f1 )"	#  161
CHANNELS="$( iw phy phy0 info | fgrep ' MHz ' | grep -v 'disabled' | cut -d'*' -f2 | cut -d' ' -f2 )"	# 5805
for FREQ in $CHANNELS; do {
	iw wlan0 ibss leave
	sleep 1
	echo "scan on $FREQ:"
	iw dev wlan0 ibss join XXX $FREQ fixed-freq 02:ca:ff:ee:ba:be

	I=10
	while let I-=1; do
		sleep 1
		iwconfig wlan0 | grep -q 'Cell: 02:CA:FF:EE:BA:BE' && break
	done

	iw dev wlan0 scan
} done

# lsmod | while read LINE; do case "$LINE" in *0);;*)echo $LINE;; esac; done|sort


# bilder fuer jeden router:
# https://wiki.freifunk-franken.de/w/Portal:Hardware



# block detect >/etc/config/fstab
# uci set fstab.@mount[0].enabled=1
# uci set fstab.@mount[0].target='/tmp/usb'


# autoteileladen 121: sturm openwrt r41296  

# bh: ibo: 15. nov. 2014: 06/042 E11 - war in Switchport 15 /surfst

# http://pad.freifunk.net/p/firmware


# intercity-vpn: + add to olsrd_interface_list
config interface 'innercity-vpn'
	option ifname 'tap0'
	option proto 'static'
	option ipaddr '10.63.21.121'
	option netmask '255.255.255.252'
	option mtu '1450'

# jena: https://github.com/FreifunkAdvanced/fsm-inetable/blob/master/lib/fsm/inetable/common.sh

# weimarnetz / VPN:
# https://github.com/weimarnetz/vpnconfig/#ip-schema
# https://github.com/weimarnetz/vpnconfig/blob/master/Setup.md


# kalua on server? (cgi-bin-status.html)

# http://ubuntuforums.org/archive/index.php/t-1758312.html
# iptables -A INPUT -p icmp --icmp-type echo-request -m limit --limit 3/s -j ACCEPT
# iptables -A INPUT -p icmp --icmp-type echo-request -j DROP
#
SERVERSIDE=10.63.99.30
SERVERSIDE="$( _ipsystem getvar WIFIVPNSERVERADR )"
iptables -I INPUT -p udp --dport 698 -s $SERVERSIDE -j DROP
iptables -I INPUT -p udp --dport 698 -s $SERVERSIDE -m limit --limit 2/s --limit-burst 1 -j ACCEPT
#
# auf server:
DEV='tap276'
iptables -I OUTPUT -p udp --dport 698 -o $DEV -j DROP
iptables -I OUTPUT -p udp --dport 698 -o $DEV -m limit --limit 3/s --limit-burst 3 -j ACCEPT



# vpn:

root@box:~ URL='http://vpn3.weimarnetz.de/freifunk/vpn/'
root@box:~ wget -qO - "$URL"
{
    "server": "vpn3.weimarnetz.de",
    "maxmtu": "1450",
    "port_vtun_nossl_nolzo": "5001",
    "clients": "1"
}

root@box:~ jshn -r "$( wget -qO - "$URL" )"
json_init;
json_add_string 'server' 'vpn3.weimarnetz.de';
json_add_string 'maxmtu' '1450';
json_add_string 'port_vtun_nossl_nolzo' '5001';
json_add_string 'clients' '1';

root@box:~ eval $( jshn -r "$( wget -qO - "$URL" )" )

# idea: overload json_init() and json_add_string() -> superfunction: json2shell "$URL"


# check: https://wiki.opennet-initiative.de/wiki/Ubiquiti_NanoStation#POE-Durchleitung


# OLSR-Roaming:
#
# IP-Schema: DHCP = 192.168.$HNA/26
# e.g. WIFIADR  =   10.63.48.65
#      OLSR_HNA =   10.63.48.64/26
#      DCHP     = 192.168.48.65 start
#                 limit = 62
#      roaming-ip immer 192.168.0.1
#
#
# ROUTER1+2+3:
# insmod macvlan
# ip link add link $WIFI-AP2-INTERFACE name roaming address 02:ca:ff:ee:00:01 type macvlan
# ip address add 192.168.0.1/16 dev roaming
# ip link set dev roaming up
# iptables -t nat -I POSTROUTING -s 192.168.0.0/16 -j MASQUERADE
#
# LAPTOP:
# ip address add 192.168.5.2/16 dev wlan0-2
# ping -c3 192.168.5.1
# ip neigh show to 192.168.5.1
#
# dann rumlaufen und ping laufen lassen
#
# script hoert mit 'iw event'
wlan0-1: new station 00:eb:2d:d4:6d:cd
wlan0-1: del station 00:1d:0d:b3:e3:13
-> olsrd2 = hna setzen/wegnehmen

# network:
#
config interface 'mastergate'
        option ifname 'roaming'
        option proto static
        option ipaddr 192.168.0.1
        option netmask 255.255.0.0

config device 'roaming'
        option type 'macvlan'
        option name 'roaming'
        option ifname '@wlanROAMING'
        option macaddr '02:ca:ff:ee:00:01'

# wireless: (2nd AP)
config wifi-iface
	option device 'radio0'
	option network 'wlanROAMING'
	option mode 'ap'
	option ssid 'weimarnetz (mobile)'

# dhcp:
#
config dhcp 'roaming'
	option interface 'mastergate'
	option start '192.168.8.1'
	option limit '253'
#
# dnsmasq-dhcp[4813]: DHCP, IP range 192.168.8.1 -- 192.168.8.253, lease time 1h

# ip a
20: roaming@wlan0-2: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UNKNOWN group default 
    link/ether 02:ca:ff:ee:00:01 brd ff:ff:ff:ff:ff:ff
    inet 192.168.0.1/16 brd 192.168.255.255 scope global roaming
       valid_lft forever preferred_lft forever
    inet6 fe80::ca:ffff:feee:1/64 scope link 
       valid_lft forever preferred_lft forever


# uci:
network.mastergate=interface
network.mastergate.ifname=roaming
network.mastergate.proto=static
network.mastergate.ipaddr=192.168.0.1
network.mastergate.netmask=255.255.0.0
network.roaming=device
network.roaming.type=macvlan
network.roaming.name=roaming
network.roaming.ifname=@wlanRADIO1
network.roaming.macaddr=02:ca:ff:ee:00:01

Fri Oct 17 21:25:48 2014 daemon.info hostapd: wlan0-2: STA 00:21:6a:32:7c:1c IEEE 802.11: authenticated
Fri Oct 17 21:25:48 2014 daemon.info hostapd: wlan0-2: STA 00:21:6a:32:7c:1c IEEE 802.11: associated (aid 1)
Fri Oct 17 21:25:48 2014 daemon.warn dnsmasq-dhcp[13640]: DHCP packet received on wlan0-2 which has no address
Fri Oct 17 21:25:48 2014 daemon.info dnsmasq-dhcp[13640]: DHCPREQUEST(roaming) 192.168.8.60 00:21:6a:32:7c:1c 
Fri Oct 17 21:25:48 2014 daemon.info dnsmasq-dhcp[13640]: DHCPNAK(roaming) 192.168.8.60 00:21:6a:32:7c:1c wrong address
Fri Oct 17 21:25:48 2014 daemon.warn dnsmasq-dhcp[13640]: DHCP packet received on wlan0-2 which has no address
Fri Oct 17 21:25:51 2014 daemon.info dnsmasq-dhcp[13640]: DHCPDISCOVER(roaming) 00:21:6a:32:7c:1c 
Fri Oct 17 21:25:51 2014 daemon.info dnsmasq-dhcp[13640]: DHCPOFFER(roaming) 192.168.8.60 00:21:6a:32:7c:1c 
Fri Oct 17 21:25:51 2014 daemon.warn dnsmasq-dhcp[13640]: DHCP packet received on wlan0-2 which has no address
Fri Oct 17 21:25:51 2014 daemon.info dnsmasq-dhcp[13640]: DHCPREQUEST(roaming) 192.168.8.60 00:21:6a:32:7c:1c 
Fri Oct 17 21:25:51 2014 daemon.info dnsmasq-dhcp[13640]: DHCPACK(roaming) 192.168.8.60 00:21:6a:32:7c:1c X301









# pwd: /root/tarball
# cd /root/tarball/; cd kalua; git pull; cd ..; kalua/openwrt-build/mybuild.sh build_kalua_update_tarball
#
# PLATFORMS='rb532 ar71xx atheros au1000 brcm47xx brcm63xx kirkwood mpc85xx ramips x86_64'
# PLATFORMS="$( find /var/www/firmware -maxdepth 1 -type d -exec basename "{}" \; | tail -n+2 | grep -v 'broadcom' )"
# vi info.txt; for ARCH in $PLATFORMS; do cp info.txt ../../../$ARCH/images/testing; cp -v /tmp/tarball.tgz ../../../$ARCH/images/testing; done
#
# pwd: /var/www/firmware/ar71xx/images/testing
# md5sum /tmp/tarball.tgz

# detect change of defgw, add reason (COST-values)
# ip monitor route | while read LINE; do let I+=1; case "$LINE" in default*) echo "$I: $LINE"; traceroute -m5 -w1 -n 8.8.8.8;; esac; done

# speedtest samba: http://examplenow.com/smbclient/usage
# smbclient //10.63.195.161/freigabe -I 10.63.195.161 -c 'prompt; ls ; cd bla; mget *;'
# smbclient //10.63.195.161/freigabe -I 10.63.195.161 -c 'prompt; cd bla; ls; get goflex_2_7_1_firmware.zip /dev/null;'
# smbclient //10.63.195.161/freigabe -I 10.63.195.161 --no-pass -c 'prompt; cd bla; ls; get ubuntu-13.04-desktop-i386.iso /dev/null;'
# smbclient //10.63.195.161/freigabe -I 10.63.195.161 --no-pass -c 'prompt; cd bla; ls; put file;'


Fri Aug 22 22:12:21 2014 user.emerg syslog: iptables v1.4.21: host/network `192.168.276.0' not found
Fri Aug 22 22:12:21 2014 user.emerg syslog: Try `iptables -h' or 'iptables --help' for more information.
Fri Aug 22 22:12:21 2014 user.emerg syslog: uci: Entry not found


# pan/tilt: https://www.adafruit.com/products/1967


# traceroute/ping is not the same:
root@AlexLaterne:~ traceroute -n 8.8.8.8
traceroute to 8.8.8.8 (8.8.8.8), 30 hops max, 38 byte packets
 1  10.63.8.65  1.026 ms  1.196 ms  4.459 ms
 2  10.63.93.65  12.845 ms  5.870 ms  10.084 ms
 3  192.168.171.1  9.638 ms  6.801 ms  8.797 ms
 4^C

root@AlexLaterne:~ ping 10.63.8.65
PING 10.63.8.65 (10.63.8.65): 56 data bytes
64 bytes from 10.63.8.65: seq=0 ttl=64 time=1397.935 ms
64 bytes from 10.63.8.65: seq=1 ttl=64 time=1296.531 ms
64 bytes from 10.63.8.65: seq=2 ttl=64 time=1243.560 ms
64 bytes from 10.63.8.65: seq=3 ttl=64 time=964.065 ms
64 bytes from 10.63.8.65: seq=4 ttl=64 time=921.009 ms
64 bytes from 10.63.8.65: seq=5 ttl=64 time=835.110 ms
^C
--- 10.63.8.65 ping statistics ---
7 packets transmitted, 6 packets received, 14% packet loss
round-trip min/avg/max = 835.110/1109.701/1397.935 ms

root@AlexLaterne:~ _wifi minstrel 10.63.8.65 debug
lq=0.399;nlq=0.921;cost=2.712;Aug 12 17:05:08 ' [up 46565s 4853760 bytes free] TERM:screen -ash [daemon.debug] minstrel_out() output of /sys/kernel/debug/ieee80211/phy0/netdev:wlan0-1/stations/64:66:b3:de:d9:8f/rc_stats
type         rate     throughput  ewma prob   this prob  retry   this succ/attempt   success    attempts
HT20/LGI     MCS0            6.1       98.4       100.0      3              0(  0)     96243      157081
HT20/LGI  tP MCS1            9.1       78.3       100.0      4              1(  1)     26257       51860
HT20/LGI T   MCS2           11.1       67.3        50.0      5              3(  6)    140430      249218
HT20/LGI     MCS3            0.0        0.0         0.0      0              0(  0)         6        2225
HT20/LGI     MCS4            0.0        0.0         0.0      0              0(  0)         0        2226
HT20/LGI     MCS5            0.0        0.0         0.0      0              0(  0)         0        2226
HT20/LGI     MCS6            0.0        0.0         0.0      0              0(  0)         0        2226
HT20/LGI     MCS7            0.0        0.0         0.0      0              0(  1)         0        2226



# http://tjworld.net/wiki/Linux/Kernel/Build/CustomiseVersionString -> automat@bittorf-wireless.de

# git checkout master; git branch | fgrep 'openwrt@' | while read LINE; do git branch -D $LINE; done; git stash clear

# Debug info is already staged in staging_dir/target-*/root-*. This path is used by scripts/remote-gdb, which also accepts corefiles.
# https://dev.openwrt.org/attachment/ticket/17782/fw3.1861.11.1410301939.core.txt
# e.g. staging_dir/target-*/root-*/usr/sbin/wpad

# ip monitor route | while read LINE; do case "$LINE" in '192.168.1.1 via'*) ip route del $LINE ;; esac; done

# dell truemobile 2300: tftp geht nur bis 6170 = 3.159.040 bytes = 48.bischen erase-blocks

# check: /sbin/snapshot

# noIPv6:
Making all in iptables
make[6]: Entering directory `/home/bastian/openwrt/openwrt/build_dir/target-mipsel_mips32_uClibc-0.9.33.2/linux-brcm47xx_generic/iptables-1.4.21/iptables'
/bin/bash ../libtool --tag=CC   --mode=link mipsel-openwrt-linux-uclibc-gcc -Wall -Waggregate-return -Wmissing-declarations     -Wmissing-prototypes -Wredundant-decls -Wshadow -Wstrict-prototypes    -Winline -pipe -DALL_INCLUSIVE -DENABLE_IPV4  -Os -pipe -mno-branch-likely -mips32 -mtune=mips32 -fno-caller-saves -fhonour-copts -Wno-error=unused-but-set-variable -msoft-float -I/home/bastian/openwrt/openwrt/build_dir/target-mipsel_mips32_uClibc-0.9.33.2/linux-brcm47xx_generic/iptables-1.4.21/include -I/home/bastian/openwrt/openwrt/build_dir/target-mipsel_mips32_uClibc-0.9.33.2/linux-brcm47xx_generic/linux-3.10.44/user_headers/include -ffunction-sections -fdata-sections   -L/home/bastian/openwrt/openwrt/staging_dir/target-mipsel_mips32_uClibc-0.9.33.2/usr/lib -L/home/bastian/openwrt/openwrt/staging_dir/target-mipsel_mips32_uClibc-0.9.33.2/lib -L/home/bastian/openwrt/openwrt/staging_dir/toolchain-mipsel_mips32_gcc-4.8-linaro_uClibc-0.9.33.2/usr/lib -L/home/bastian/openwrt/openwrt/staging_dir/toolchain-mipsel_mips32_gcc-4.8-linaro_uClibc-0.9.33.2/lib -Wl,--gc-sections  -o xtables-multi xtables_multi-xtables-multi.o xtables_multi-iptables-xml.o xtables_multi-iptables-save.o xtables_multi-iptables-restore.o xtables_multi-iptables-standalone.o xtables_multi-iptables.o  xtables_multi-xshared.o ../extensions/libext.a ../libiptc/libip4tc.la ../extensions/libext4.a  ../libxtables/libxtables.la -lm
OpenWrt-libtool: link: mipsel-openwrt-linux-uclibc-gcc -Wall -Waggregate-return -Wmissing-declarations -Wmissing-prototypes -Wredundant-decls -Wshadow -Wstrict-prototypes -Winline -pipe -DALL_INCLUSIVE -DENABLE_IPV4 -Os -pipe -mno-branch-likely -mips32 -mtune=mips32 -fno-caller-saves -fhonour-copts -Wno-error=unused-but-set-variable -msoft-float -I/home/bastian/openwrt/openwrt/build_dir/target-mipsel_mips32_uClibc-0.9.33.2/linux-brcm47xx_generic/iptables-1.4.21/include -I/home/bastian/openwrt/openwrt/build_dir/target-mipsel_mips32_uClibc-0.9.33.2/linux-brcm47xx_generic/linux-3.10.44/user_headers/include -ffunction-sections -fdata-sections -Wl,--gc-sections -o .libs/xtables-multi xtables_multi-xtables-multi.o xtables_multi-iptables-xml.o xtables_multi-iptables-save.o xtables_multi-iptables-restore.o xtables_multi-iptables-standalone.o xtables_multi-iptables.o xtables_multi-xshared.o  -L/home/bastian/openwrt/openwrt/staging_dir/target-mipsel_mips32_uClibc-0.9.33.2/usr/lib -L/home/bastian/openwrt/openwrt/staging_dir/target-mipsel_mips32_uClibc-0.9.33.2/lib -L/home/bastian/openwrt/openwrt/staging_dir/toolchain-mipsel_mips32_gcc-4.8-linaro_uClibc-0.9.33.2/usr/lib -L/home/bastian/openwrt/openwrt/staging_dir/toolchain-mipsel_mips32_gcc-4.8-linaro_uClibc-0.9.33.2/lib ../extensions/libext.a ../libiptc/.libs/libip4tc.so ../extensions/libext4.a ../libxtables/.libs/libxtables.so -ldl -lm
xtables_multi-xtables-multi.o:(.rodata.multi_subcommands+0x44): undefined reference to `ip6tables_main'
xtables_multi-xtables-multi.o:(.rodata.multi_subcommands+0x4c): undefined reference to `ip6tables_main'
xtables_multi-xtables-multi.o:(.rodata.multi_subcommands+0x54): undefined reference to `ip6tables_save_main'
xtables_multi-xtables-multi.o:(.rodata.multi_subcommands+0x5c): undefined reference to `ip6tables_save_main'
xtables_multi-xtables-multi.o:(.rodata.multi_subcommands+0x64): undefined reference to `ip6tables_restore_main'
xtables_multi-xtables-multi.o:(.rodata.multi_subcommands+0x6c): undefined reference to `ip6tables_restore_main'
collect2: error: ld returned 1 exit status



# nvram show | grep ^ff_ | sed 's/./nvram unset &/' | cut -d'=' -f1 | sh

# openwrt-build: iwinfo -> dont build when no wireless is there

# monitor changing defgw:
# ip monitor route | while read L; do case "$L" in def*) IP="$( echo "$L" | cut -d\  -f3 )"; echo "$(date) $HOSTNAME: defgw: $( n | grep $IP )";; esac; done

# etx * mqmult -> fixed math
# 4.047 * 0.7 = 2,832
# 4047  * 7   = 28329 -> rule: '.' -> '' and '0.' -> ''

# IPv6-Watchdog:
# - coldboot: interval = 15 mins (auch wenn kein ping kommt Zwangsausloesung)
# - erster ping: -> 2ter/Xter ping: (countdown)
#   - Abstand ergibt erwarteten Zeitpunkt für nächsten + % Schummelfaktor
#   - Faktor z.b. 1 sec / 5 sec / oder 5 min max?
# - nach X mal Router Reboot ohne erfolg: aufhören? -> oder interval erhoehen
# - ueber TTL der "ICMP"-Antwort anzeigen ob ausgeloest wurde
#   - so kann man bei einem unbekannten reboot rausfinden, ob es die Watchdog war oder was anderes
# - ueber SIZE interval einstellen

# delete route to 192.168.1.1
# while :;do sleep 1; R="$( ip r | grep ^'192\.168\.1\.1' )" && ip r d $R; done


# high load during tar.gz
Mem: 106556K used, 19960K free, 0K shrd, 3084K buff, 79984K cached
CPU:  75% usr   8% sys   0% nic   0% idle   0% io   0% irq  16% sirq
Load average: 1.59 1.89 2.11 3/39 6351
  PID  PPID USER     STAT   VSZ %VSZ %CPU COMMAND
 6345  6344 root     R     1732   1%  67% {exe} gzip -f
 2980     1 root     R     4160   3%  25% /usr/sbin/olsrd -f /var/etc/olsrd.con



# ping6 -L -c 1 -W 2 ff02::1%$iface
# ping6 ff02::1%$LANDEV

# howto:
# wget -O - http://[f8:d1:11:a9:c8:e0%25wlan0] -> http://tools.ietf.org/html/rfc6874
# wget -O - "http://[fe80::f6ec:38ff:fe9d:856e%wlan0]/cgi-bin-tool.sh?OPT=startshell"
# use curl!

# ubus list
# ubus call network.interface dump
# ubus call service list '{"verbose": true}'
# ubus -v list log	// show methods



# when 'Not-Associated', output = 'dBm'
# while true; do set -- $( iwconfig wlan0 | fgrep 'Access Point: ' ); MAC=$6; test "$4" = 'Not-Associated' && continue; test "$MAC" = "$OLD_MAC" || { echo "$( date ): $MAC"; OLD_MAC="$MAC"; }; sleep 5; done

DEV=wlan0
#
tc qdisc add dev $DEV root handle 1: prio multiqueue
tc qdisc add dev $DEV parent 1:1 handle 10: sfq perturb 10
tc qdisc add dev $DEV parent 1:2 handle 20: sfq perturb 10
tc qdisc add dev $DEV parent 1:3 handle 30: sfq perturb 10
tc filter add dev $DEV protocol ip parent 1: prio 1 u32 match ip protocol 17 0xff match ip dport 698 0xffff flowid 1:1
tc filter add dev $DEV protocol ip parent 1: prio 2 u32 match ip protocol 6 0xff match u8 0x10 0xff at nexthdr+13 flowid 1:1
tc filter add dev $DEV protocol ip parent 1: prio 3 u32 match ip protocol 17 0xff match ip dport 53 0xffff flowid 1:2
tc filter add dev $DEV protocol ip parent 1: prio 4 u32 match u16 0x00ff 0xff00 at 2 flowid 1:2
tc filter add dev $DEV protocol ip parent 1: prio 5 u32 match ip protocol 0 0x00 flowid 1:3
#
# tc -s qdisc ls dev $DEV
#
tc filter del dev $DEV protocol ip parent 1: prio 5 u32 match ip protocol 0 0x00 flowid 1:3
tc filter del dev $DEV protocol ip parent 1: prio 4 u32 match u16 0x00ff 0xff00 at 2 flowid 1:2
tc filter del dev $DEV protocol ip parent 1: prio 3 u32 match ip protocol 17 0xff match ip dport 53 0xffff flowid 1:2
tc filter del dev $DEV protocol ip parent 1: prio 2 u32 match ip protocol 6 0xff match u8 0x10 0xff at nexthdr+13 flowid 1:1
tc filter del dev $DEV protocol ip parent 1: prio 1 u32 match ip protocol 17 0xff match ip dport 698 0xffff flowid 1:1
tc qdisc del dev $DEV parent 1:3 handle 30: sfq perturb 10
tc qdisc del dev $DEV parent 1:2 handle 20: sfq perturb 10
tc qdisc del dev $DEV parent 1:1 handle 10: sfq perturb 10
tc qdisc del dev $DEV root handle 1: prio multiqueue



# wget -O /dev/null http://10.63.45.1/cgi-bin/luci/freifunk/status/zeroes

# echo 0 > /sys/kernel/debug/ieee80211/phy0/ath9k/ani

# https://etherpad.mozilla.org/mesh-networking
# http://www.reddit.com/r/Hocnet
# https://ezcrypt.it/QE8n#uTi265vSsfshFqDVsy4BzFs6
# https://groups.google.com/forum/#!topic/portland-meshnet/lBjLJHLBHUs

# http://wiki.freifunk.net/IPv6:Prefixe
# http://wiki.freifunk.net/IPv6/IPv6Concepts


Wed Jun 18 00:35:50 2014 daemon.notice hostapd: wlan0-1: STA 00:21:6a:32:7c:1c IEEE 802.11: did not acknowledge authentication response
Wed Jun 18 00:35:54 2014 daemon.notice hostapd: wlan0-1: STA 00:21:6a:32:7c:1c IEEE 802.11: did not acknowledge authentication response
Wed Jun 18 00:35:58 2014 daemon.notice hostapd: wlan0-1: STA 00:21:6a:32:7c:1c IEEE 802.11: did not acknowledge authentication response
Wed Jun 18 00:36:01 2014 user.notice root: debug: phy: phy0 interval: 60 avg: 20 avg_overall: 27 change: 35%
Wed Jun 18 00:36:02 2014 daemon.info hostapd: wlan0-1: STA 00:21:6a:32:7c:1c IEEE 802.11: authenticated
Wed Jun 18 00:36:06 2014 daemon.notice hostapd: wlan0-1: STA 00:21:6a:32:7c:1c IEEE 802.11: did not acknowledge authentication response
Wed Jun 18 00:36:06 2014 daemon.info hostapd: wlan0-1: STA 00:21:6a:32:7c:1c IEEE 802.11: associated (aid 1)
Wed Jun 18 00:36:09 2014 daemon.info dnsmasq-dhcp[2515]: DHCPDISCOVER(wlan0-1) 10.63.22.78 00:21:6a:32:7c:1c 
Wed Jun 18 00:36:09 2014 daemon.info dnsmasq-dhcp[2515]: DHCPOFFER(wlan0-1) 10.63.22.78 00:21:6a:32:7c:1c 
Wed Jun 18 00:36:11 2014 daemon.info dnsmasq-dhcp[2515]: DHCPREQUEST(wlan0-1) 10.63.22.78 00:21:6a:32:7c:1c 
Wed Jun 18 00:36:11 2014 daemon.info dnsmasq-dhcp[2515]: DHCPACK(wlan0-1) 10.63.22.78 00:21:6a:32:7c:1c X301



# http://wiki.openwrt.org/doc/uci#file.syntax
# http://wiki.openwrt.org/doc/uci#uci.paths


# TODO: check during write_config() if at least 1 interface has
#       an fd24:31bb:f31c::1/60 ULA
#
# olsrd2 --load /etc/olsrd2.conf --schema=log.debug 
# olsrd2 --load /etc/olsrd2.conf --set log.debug=os_system
# olsrd2 --load /etc/olsrd2.conf --set domain.table=233
#
# make package/oonf-api-git/clean
# make package/olsrd2-git/clean
# make package/olsrd2-git/compile
#
# auf loopback: option ip6assign 60 -> gives ULA = uci set network.loopback.ip6assign=60
#
# echo "/nhdpinfo link" | nc 127.0.0.1 2009
# old:
# echo "/nhdp iflink"    | nc 127.0.0.1 2009
# echo "/nhdp neighlink" | nc 127.0.0.1 2009
# echo "/layer2 net"     | nc 127.0.0.1 2009



uci add network  cityVPN
uci set network.@cityVPN[-1].interface='tap0'
uci set network.@cityVPN[-1].proto=static

uci set network.cityVPN=interface
uci set network.cityVPN.proto=static
uci set network.cityVPN.interface=tap0


# profiling in scheduler_run()
# olsr-uptime/neustarts zeigen


vtund_build_type()
{
	local file='/tmp/vtund_build_type'

	[ -e "$file" ] || {
		set -- $( ldd /usr/sbin/vtund )
		case "$@" in
			*'liblzo'*'libcrypto'*)
				echo >"$file" 'LZOSSL'
			;;
			*'liblzo'*)
				echo >"$file" 'LZOnoSSL'
			;;
			*)
				echo >"$file" 'noLZOnoSSL'
			;;
		esac
	}

	cat "$file"
}

# vtund: noSSL, noLZO
# root@bebelplatz4-triererstr:~ ldd /usr/sbin/vtund
	libgcc_s.so.1 => /lib/libgcc_s.so.1 (0x77761000)
	libc.so.0 => /lib/libc.so.0 (0x776f4000)
	ld-uClibc.so.0 => /lib/ld-uClibc.so.0 (0x77784000)
# vtund: noSSL, LZO
# root@EG-labor-AP:~ ldd /usr/sbin/vtund
        libz.so.1 => /usr/lib/libz.so.1 (0x774c6000)
        liblzo2.so.2 => /usr/lib/liblzo2.so.2 (0x774a4000)
        libgcc_s.so.1 => /lib/libgcc_s.so.1 (0x77480000)
        libc.so.0 => /lib/libc.so.0 (0x77413000)
        ld-uClibc.so.0 => /lib/ld-uClibc.so.0 (0x774e4000)
# vtund: SSL + LZO
# bastian@X301:~$ ldd /usr/sbin/vtund
	linux-gate.so.1 =>  (0xb7771000)
	libz.so.1 => /lib/i386-linux-gnu/libz.so.1 (0xb7739000)
	liblzo2.so.2 => /usr/lib/i386-linux-gnu/liblzo2.so.2 (0xb7716000)
	libcrypto.so.1.0.0 => /lib/i386-linux-gnu/libcrypto.so.1.0.0 (0xb756a000)
	libutil.so.1 => /lib/i386-linux-gnu/libutil.so.1 (0xb7566000)
	libc.so.6 => /lib/i386-linux-gnu/libc.so.6 (0xb73b2000)
	libdl.so.2 => /lib/i386-linux-gnu/libdl.so.2 (0xb73ad000)
	/lib/ld-linux.so.2 (0xb7772000)




# cron.min-ping fails -> inet_stable
# shoutbox jenaplan 

# 24h-tickets adagio

# vpn zwischen zwei entfernten nodes?
# tap0 als olsr-interface
# ipip-tunnel?

# auf 10.63.19.97 (Matterhorn)
list inkQualityMult '10.63.45.2 0.5'           # christian
list LinkQualityMult '10.63.95.65 0.8'          # matterhorn -> wachturm (soll ethernet)
list LinkQualityMult '10.63.19.65 0.7'          # F36dach


# build: echo 'bittorf-wireless.com' >/proc/sys/kernel/hostname


# implement mac-to-IPv6-UEI-64
# ftp://ftp.rfc-editor.org/in-notes/rfc3513.txt
# http://www8.cs.umu.se/~c05hed/mac2ipv6.php?mac=B0%3A48%3A7A%3ABE%3ACA%3A46
# http://ben.akrin.com/?p=1347
#
# LAN-MAC: 74:ea:3a:      db:15:aa
#    fe80::76.ea:3a.ff:fe.db:15.aa/64
#
# d.h.:
# - umrechnen in 'locally_administered'
# - 3 bytes links + 3 bytes rechts
# - in die mitte komt ff:fe
# - fe80:: davorsetzen
# - ping6 $ip%$iface


# https://wiki.ubuntu.com/DashAsBinSh


# dcf77
# ln -s /dev/ttyUSB0 /dev/refclock-0
#
root@703n:~ cat /etc/ntp.conf 
# use a random selection of 4 public stratum 2 servers
# see http://twiki.ntp.org/bin/view/Servers/NTPPoolServers
#restrict default nomodify notrap noquery
#restrict default noquery
driftfile  /var/lib/ntp/ntp.drift
server 127.127.8.0 prefer mode 14
restrict default ignore
restrict 127.127.8.0 nomodify
restrict 127.0.0.1 nomodify
restrict 10.0.0.0 mask 255.0.0.0 nomodify
logfile /tmp/ntp.txt
logconfig =all
#
#
ntpq -c clocklist
ntpq -c peers
ntpq -c cv -c rv





test -e /tmp/HHH || {
 set | grep -v ^strong_debug= | grep -v ^logfile= | grep -v ^line= | grep -v ^funcname= | grep -v ^file= | grep -v ^board= | grep ^[a-z] >/tmp/HHH2 && {
  cat /tmp/HHH2 >/tmp/HHH
  echo "$line" >>/tmp/HHH
  date >>/tmp/HHH
 }
}



root@KG-serverraum-MESH:~ ip n|grep 00:19:99:d0:da:e8
fe80::1c4:ee8c:6f32:7bf5 dev eth0.1 lladdr 00:19:99:d0:da:e8 STALE
10.63.4.53 dev eth0.1 lladdr 00:19:99:d0:da:e8 REACHABLE
10.63.4.55 dev eth0.1 lladdr 00:19:99:d0:da:e8 STALE



root@4900erHybrid-kueche:~ ip n|fgrep 10.63.222.
10.63.222.3 dev wlan0 lladdr 64:70:02:d3:24:0c STALE
10.63.222.1 dev wlan1 lladdr 64:70:02:d3:24:0b STALE
10.63.222.1 dev wlan0 lladdr 64:70:02:d3:24:0c STALE



Wed Apr 16 11:33:06 2014 daemon.info dnsmasq-dhcp[2505]: DHCPDISCOVER(eth0.1) 00:23:8b:a5:18:dc
Wed Apr 16 11:33:06 2014 daemon.info dnsmasq-dhcp[2505]: DHCPOFFER(eth0.1) 10.63.11.113 00:23:8b:a5:18:dc
Wed Apr 16 11:33:06 2014 daemon.info dnsmasq-dhcp[2505]: DHCPREQUEST(eth0.1) 10.63.11.113 00:23:8b:a5:18:dc
Wed Apr 16 11:33:06 2014 daemon.info dnsmasq-dhcp[2505]: DHCPACK(eth0.1) 10.63.11.113 00:23:8b:a5:18:dc InaMichalski-PC
Wed Apr 16 11:33:24 2014 daemon.alert fff+ /etc/dhcp-script.d/10dhcpscript netfilter_user_reachable(): no_success: mac: 00:23:8b:a5:18:dc ip: 10.63.11.112 devlist: 'eth0.1  wlan0  wlan0-1 '
Wed Apr 16 11:33:24 2014 daemon.info fff+ /etc/dhcp-script.d/10dhcpscript netfilter_user_add(): [ERR] unreachable - mac: '00:23:8b:a5:18:dc' ip: '10.63.11.112'
Wed Apr 16 11:33:24 2014 daemon.info fff+ /etc/dhcp-script.d/10dhcpscript dhcp_del(): '00:23:8b:a5:18:dc' is from 'eth0.1' = lan-DEV
Wed Apr 16 11:33:24 2014 daemon.info fff+ /etc/dhcp-script.d/10dhcpscript dhcp_add(): '00:23:8b:a5:18:dc' is from 'eth0.1' = lan-DEV
Wed Apr 16 11:33:24 2014 daemon.info fff+ /etc/dhcp-script.d/10dhcpscript mac_is_from_lan(): mac 00:23:8b:a5:18:dc is from LAN
Wed Apr 16 11:33:24 2014 daemon.info fff+ /etc/dhcp-script.d/10dhcpscript EG-steinmetzBuero_dhcp-add(): [OK] _weblogin login_check 00:23:8b:a5:18:dc
Wed Apr 16 11:34:01 2014 user.notice root: debug: phy: phy0 interval: 60 avg: 245 avg_overall: 225 change: -8%
Wed Apr 16 11:35:01 2014 user.notice root: debug: phy: phy0 interval: 60 avg: 223 avg_overall: 227 change: 1%
Wed Apr 16 11:35:47 2014 daemon.debug fff+ TERM:screen -ash netfilter_user_reachable(): probing: mac: 00:23:8b:a5:18:dc ip: 10.63.11.113 dev: 'eth0.1'
Wed Apr 16 11:35:47 2014 daemon.info fff+ TERM:screen -ash netfilter_user_add(): mac: 00:23:8b:a5:18:dc ip: 10.63.11.113



# https://dev.openwrt.org/ticket/15572
For small memory kernel optimized routing                                                                             
 {{{                                                                                                                   
 vm.min_free_kbytes=1                                                                                                  
 vm.vfs_cache_pressure=500                                                                                             
 vm.dirty_ratio=50                                                                                                     
 vm.overcommit_memory=0                                                                                                
 vm.overcommit_ratio=10                                                                                                
 vm.dirty_ratio=20                                                                                                     
 vm.dirty_expire_centisecs=1500                                                                                        
 vm.drop_caches=3                                                                                                      
 }}}                 


# fehler auf 1043er: (loeschen im bootloader ging nur bei 124/128)
Please press Enter to activate this console.

[   56.070000] jffs2: Short read from newly-erased block at 0x004d0000. Wanted 4096, got 0
[   96.070000] jffs2: Erase at 0x004c0000 failed immediately: errno -5
[  136.070000] jffs2: Erase at 0x004b0000 failed immediately: errno -5
[  176.080000] jffs2: Erase at 0x004a0000 failed immediately: errno -5
[  216.080000] jffs2: Erase at 0x00490000 failed immediately: errno -5
[  256.080000] jffs2: Erase at 0x00480000 failed immediately: errno -5
[  296.080000] jffs2: Erase at 0x00470000 failed immediately: errno -5
[  336.080000] jffs2: Erase at 0x00460000 failed immediately: errno -5
[  376.080000] jffs2: Erase at 0x00450000 failed immediately: errno -5

###
root@OpenWrt:/# sysupgrade -n /tmp/fw
[  496.080000] jffs2: Erase at 0x00420000 failed immediately: errno -5
[  536.080000] jffs2: Erase at 0x00410000 failed immediately: errno -5
[  576.080000] jffs2: Erase at 0x00400000 failed immediately: errno -5
[  616.080000] jffs2: Erase at 0x003f0000 failed immediately: errno -5
[  656.080000] jffs2: Erase at 0x003e0000 failed immediately: errno -5
[  696.080000] end_request: I/O error, dev mtdblock5, sector 0
[  696.080000] Buffer I/O error on device mtdblock5, logical block 0
[  736.090000] end_request: I/O error, dev mtdblock5, sector 8
[  736.090000] Buffer I/O error on device mtdblock5, logical block 1
[  776.100000] end_request: I/O error, dev mtdblock5, sector 16
[  776.100000] Buffer I/O error on device mtdblock5, logical block 2
[  816.110000] end_request: I/O error, dev mtdblock5, sector 24
[  816.110000] Buffer I/O error on device mtdblock5, logical block 3
[  856.120000] end_request: I/O error, dev mtdblock5, sector 0
[  856.120000] Buffer I/O error on device mtdblock5, logical block 0
Invalid image, hardware ID mismatch, hw: image:10430001.
Image check 'platform_check_image' failed.






# txpower:
# iw dev "$ifname" set txpower fixed "${txpower%%.*}00"
# iw dev "wlan0" set txpower fixed "2000"

# nodejs:
# https://code.google.com/p/v8/wiki/BuildingWithGYP
# https://github.com/paul99/v8m-rb
# https://github.com/paul99/v8m-rb/pull/19
# http://fibasile.github.io/compiling-nodejs-for-arduino-yun.html
# http://linino.org/doku.php?id=wiki:nodejsbuild#the_easy_waydownload_the_compiled_linino_toolchain_and_the_openwrt_sdk
# http://stackoverflow.com/questions/22914681/cross-compiling-node-js-modules-on-mips-big-endian
# https://forum.openwrt.org/viewtopic.php?id=34410
# https://github.com/brimstone/nodejs-openwrt

# RippleOS: http://www.right.com.cn/forum/thread-134949-1-1.html

# openwrt-desktop
# https://github.com/larsclausen/

# find . -type f -name Makefile | xargs fgrep 'rb532'

# USB/3G-Modems/Openwrt: http://ofmodemsandmen.com/downloads.html

# openwrt: USB: 5 ghz: https://forum.openwrt.org/viewtopic.php?id=48248

# bluetooth-networking: http://giovanni.wordpress.com/2007/04/06/how-to-use-tcpip-over-bluetooth/

# javascript: http://wiki.openwrt.org/toh/start

# store data:
Please don't use /var/state for more network related stuff like this.                                                                          
You can use something like the following:                                                                                                      
ubus call network.interface.<name> set_data '{ "name": "value" }'                                                                              
                                                                                                                                               
That way you can store name/value pairs in the per-interface data in                                                                           
netifd, which you can retrieve via interface status. When the interface                                                                        
goes down, the data is cleared again, so cleanup is easy.          

# 60 GHz:
# http://wireless.kernel.org/en/users/Drivers/wil6210
# https://wikidevi.com/wiki/List_of_802.11ad_Hardware
# http://wilocity.com/products/reference-designs


# http://news.gmane.org/gmane.comp.embedded.pandaboard

### monami:

root@E2-buerooben-MESH:~ ip a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 16436 qdisc noqueue state UNKNOWN 
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 brd 127.255.255.255 scope host lo
2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP qlen 1000
    link/ether 00:13:10:0a:d5:8b brd ff:ff:ff:ff:ff:ff
    inet 192.168.1.1/24 brd 192.168.1.255 scope global eth0
4: eth0.0@eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP 
    link/ether 00:13:10:0a:d5:8b brd ff:ff:ff:ff:ff:ff
    inet 10.63.6.33/27 brd 10.63.6.63 scope global eth0.0
5: eth0.1@eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP 
    link/ether 00:13:10:0a:d5:8b brd ff:ff:ff:ff:ff:ff
    inet 192.168.2.10/24 brd 192.168.2.255 scope global eth0.1
6: wlan0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP qlen 32
    link/ether 00:13:10:0a:d5:8d brd ff:ff:ff:ff:ff:ff
    inet 10.63.6.1/8 brd 10.255.255.255 scope global wlan0

if ping -c1 192.168.2.1; then
        touch '/tmp/GWSEEN'
else
        [ -e '/tmp/GWSEEN' ] && {
		ip a >/www/gw_lost.$$
		_system crashreboot 'gw_lost'
	}
fi

### monamiEND


# eigenes paket anlegen, z.b.
# package/utils/arduino-serial
# Makefile reinkopieren
# make menuconfig -> aktivieren
# make package/arduino-serial/compile	# achtung: ohne 'utils'
#
# e.g.: menuconfig -> lang
define Package/node
  DEPENDS:=+libpthread +librt +uclibcxx
  SECTION:=lang
  CATEGORY:=Languages
  TITLE:=Node.js is a platform built on Chrome's JavaScript runtime
  URL:=http://nodejs.org/
endef




# 

# checkout: darkstat

# Dave Taht: Re: [Battlemesh] recommendations for 40Km Link
# http://snapon.lab.bufferbloat.net/~cero2/jimreisert/results.html
# netperf-wrapper -l 60 --disable-log -p all_scaled -o mytest.svg -H                                                                                           # server -t 'test title' rrul_be # or rrul                 

# http://de.wikipedia.org/wiki/Andrew_File_System

# openwrt / panda / target = omap4430
# list files on ext2 on part2:
# ext2ls mmc 0:2
# load:
# load mmc 0:2 0x80300000 openwrt-omap-zImage
# bootz 0x80300000
#
# partition1 = fat16 -> files: 'MLO' + 'u-boot'
# partition2 = ext4  -> files: rootfs + /boot + /boot/zImage + /boot/*.dtb



# https://git.kernel.org/cgit/linux/kernel/git/stable/linux-stable.git/tree/arch/mips/boot/compressed/decompress.c?id=refs/tags/v3.10.58
# patch / upgrade new kernel:
# git checkout -n kernel_upgrade
#
# (loop starts here)
# vi target/linux/ar71xx/Makefile
# make target/linux/clean		# clean kernel tree
# make -j5 target/linux/compile		# rebuild kernel
#
# make -j5 target/install		# rebuild kernel + image files
# 
# ??? make package/kernel/mac80211/clean + compile
#
# make package/kernel/linux/clean


URL='https://www.kernel.org/pub/linux/kernel/v3.x/ChangeLog-3.10.50'
shortlog() {
clear; echo "$URL"; echo; wget -qO - "$URL" |
 while read LINE; do
	case "$LINE" in
		'commit'*|'Signed-off-by: '*|'Acked-by: '*|'Cc: '*|'Reported-by:'*|'Link: '*|'Fixes: '*|'['*)
			PARSE=
		;;
		'Date:'*)
			PARSE=1
		;;
		*': '*)
			test -n "$PARSE" && echo "$LINE"
		;;
	esac
done | sort
}
shortlog "$URL"

# git rm/add $changed/deleted_patchfiles
# git add target/linux/ar71xx/Makefile
# git diff --cached --color
# git commit
  [ar71xx/kernel] upgrade 3.10.49 to 3.10.50 - released 2014-07-28

  [ar71xx/kernel] upgrade 3.10.49 to 3.10.50 - released 2014-07-28

  compile tested. runtime tested.

  shortlog from https://www.kernel.org/pub/linux/kernel/v3.x/ChangeLog-3.10.50
  ...

# (or loop here)
# git format-patch -s -1
# git checkout master


# /sys/kernel/debug/ieee80211/phy0/ath9k/dump_nfcal
# /sys/kernel/debug/ieee80211/phy0/ath9k/reset
# /sys/kernel/debug/ieee80211/phy*/ath9k/interrupt
# /sys/kernel/debug/ieee80211/phy0/ath9k/queues
# /sys/kernel/debug/ieee80211/phy0/queues
# for W in reset interrupt queues;do for F in /sys/kernel/debug/ieee80211/phy*/ath9k/$W /sys/kernel/debug/ieee80211/phy*/queues; do echo "### $F"; cat $F; done; done
#
# echo 1 >/sys/kernel/debug/ieee80211/phy0/ath9k/disable_ani
# more debug: (https://dev.openwrt.org/ticket/15320#comment:29)
# echo 0x4409 >/sys/kernel/debug/ieee80211/phy0/ath9k/debug
# echo 0x48   >/sys/kernel/debug/ieee80211/phy0/ath9k/debug	(ATH_DBG_ANI + ATH_DBG_CALIBRATE)
# echo 0x40   >/sys/kernel/debug/ieee80211/phy0/ath9k/debug	(ATH_DBG_ANI)
# echo '0xffffffff' > /sys/kernel/debug/ieee80211/phy0/ath9k/debug
#
# https://github.com/cjdelisle/athdrvrs/blob/master/ath.h
#  * The debug level is used to control the amount and type of debugging output
 * we want to see. Each driver has its own method for enabling debugging and
 * modifying debug level states -- but this is typically done through a
 * module parameter 'debug' along with a respective 'debug' debugfs file
 * entry.
 */
enum ATH_DEBUG {
	ATH_DBG_RESET		= 0x00000001,
	ATH_DBG_QUEUE		= 0x00000002,
	ATH_DBG_EEPROM		= 0x00000004,
	ATH_DBG_CALIBRATE	= 0x00000008,
	ATH_DBG_INTERRUPT	= 0x00000010,
	ATH_DBG_REGULATORY	= 0x00000020,
	ATH_DBG_ANI		= 0x00000040,
	ATH_DBG_XMIT		= 0x00000080,
	ATH_DBG_BEACON		= 0x00000100,
	ATH_DBG_CONFIG		= 0x00000200,
	ATH_DBG_FATAL		= 0x00000400,
	ATH_DBG_PS		= 0x00000800,
	ATH_DBG_BTCOEX		= 0x00001000,
	ATH_DBG_WMI		= 0x00002000,
	ATH_DBG_BSTUCK		= 0x00004000,
	ATH_DBG_MCI		= 0x00008000,
	ATH_DBG_DFS		= 0x00010000,
	ATH_DBG_WOW		= 0x00020000,
	ATH_DBG_ANY		= 0xffffffff
};







# TEMPer2:
# https://github.com/s-leroux/TEMPer2/blob/master/Makefile
# https://github.com/s-leroux/TEMPer2
# http://dp.nonoo.hu/measuring-temperature-using-openwrt/
# openwrt 0c45:7401
# https://dev.openwrt.org/ticket/10577
# https://dev.openwrt.org/attachment/ticket/10577/temper.zip



root: ich = 'dnt3' nachbar = '/tmp/dnt1.log' : signal: -56 [-56] dBm
root: ich = 'dnt3' nachbar = '/tmp/dnt1.log' : signal avg: -56 [-56] dBm
root: trying ec:88:8f:c6:69:3a
root: ich = 'dnt3' nachbar = '/tmp/dnt2.log' : signal: -53 [-53] dBm
root: ich = 'dnt3' nachbar = '/tmp/dnt2.log' : signal avg: -53 [-53] dBm
root: trying 6c:e8:73:eb:2b:90
Failed to connect to generic netlink.

   

92 root         0 SW   [kswapd0]
  137 root         0 SW   [fsnotify_mark]
  152 root         0 SW<  [ath79-spi]
  228 root         0 SW<  [deferwq]
  232 root         0 SW<  [kworker/0:1H]
  283 root         0 SW   [khubd]
  320 root         0 SWN  [jffs2_gcd_mtd3]
  381 root       908 S    /sbin/ubusd
  382 root       772 S    /sbin/askfirst ttyS0 /bin/ash --login
  623 root      2056 S    /bin/sh -c . /tmp/CRON_IS_CAREFUL
  838 root         0 SW   [kworker/u2:1]
  839 root         0 SW   [kworker/0:1]
 1570 root         0 SW<  [cfg80211]
 1662 root      1344 S    /sbin/logd
 1693 root      1488 S    /sbin/netifd
 1711 root      1160 S    /usr/sbin/odhcpd
 2036 root      1372 S    udhcpc -p /var/run/udhcpc-lo.pid -s /lib/netifd/dhcp
 2402 nobody    1020 S    /usr/sbin/dnsmasq -C /var/etc/dnsmasq.conf -k
 2421 root       976 S    /usr/sbin/dnsmasq -C /var/etc/dnsmasq.conf -k
 2548 root         0 SW   [kworker/u2:0]
 2675 nobody     904 S    /sbin/fakedns --address=/#/10.10.2.129 -p 5353
 2872 root      1100 S    /usr/sbin/dropbear -F -P /var/run/dropbear.1.pid -p
 2921 root      1672 S    /usr/sbin/uhttpd -f -h /www -r EG-INETrezeption-MESH
 2989 root      1380 S    /usr/sbin/crond -L /dev/null
 4246 root         0 SW   [kworker/0:0]
 4960 root      1544 S    /bin/sh -c . /tmp/CRON_IS_CAREFUL
 4967 root      1352 S    sleep 30
 4971 root      1352 S    sleep 30
 4975 root      1352 S    sleep 30
 4979 root      1352 S    sleep 30
 4983 root      1352 S    sleep 30
 4989 root      1352 S    sleep 30
 4991 root      1352 S    sleep 30
 4995 root      1352 S    sleep 30
 5005 root      1352 S    sleep 30
 5031 root      1360 R    ps
 5298 root      2120 S    /bin/sh -c . /tmp/CRON_IS_CAREFUL
 7265 root      1376 S    /usr/sbin/olsrd -f /var/etc/olsrd.conf -nofork
10387 root      2060 S    /bin/sh -c . /tmp/CRON_IS_CAREFUL
17601 root      2064 S    /bin/sh -c . /tmp/CRON_IS_CAREFUL
21168 root      2048 S    /bin/sh -c . /tmp/CRON_IS_CAREFUL
23580 root      2068 S    /bin/sh -c . /tmp/CRON_IS_CAREFUL
25042 root      2052 S    /bin/sh -c . /tmp/CRON_IS_CAREFUL
28763 root      2056 S    /bin/sh -c . /tmp/CRON_IS_CAREFUL
30385 root      2068 S    /bin/sh -c . /tmp/CRON_IS_CAREFUL


# dynamic-client-portfw:
# list of mac's + mapping extern -> intern port (can be one than once per device)
# e.g. 00:11:22:33:44:55 -> 10080 -> 80 + 10443 -> 443


# build old kernel with git://nbd.name/aa-mac80211.git

Mar 06 08:53:10 ' [up 7626s 5140480 bytes free] /bin/sh [daemon.alert] olsr_daemon() start: has_crashed
Mar 06 08:53:12 ' [up 7628s 4583424 bytes free] /bin/sh [daemon.alert] watch_coredump() wrote: /dev/null (low storage: was: /tmp/olsrd.6188.11.1394092386.core)
Mar 06 09:00:09 ' [up 8044s 4308992 bytes free] /bin/sh [daemon.alert] olsr_daemon() start: has_crashed
Mar 06 09:00:11 ' [up 8046s 3788800 bytes free] /bin/sh [daemon.alert] olsr_daemon() start: has_crashed
Mar 06 09:00:12 ' [up 8047s 3575808 bytes free] /bin/sh [daemon.alert] olsr_daemon() start: has_crashed
Mar 06 09:00:13 ' [up 8048s 2912256 bytes free] /bin/sh [daemon.alert] olsr_daemon() start: has_crashed
Mar 06 09:00:14 ' [up 8049s 2580480 bytes free] /bin/sh [daemon.alert] watch_coredump() wrote: /dev/null (low storage: was: /tmp/olsrd.4551.10.1394092805.core)
Mar 06 09:00:15 ' [up 8050s 5816320 bytes free] /bin/sh [daemon.alert] watch_coredump() cron died, restarting
Mar 06 09:00:16 ' [up 8051s 5246976 bytes free] /bin/sh [daemon.alert] watch_coredump() wrote: /dev/r39139.ar71xx.crond.2510.10.1394092811.core
Mar 06 09:00:16 ' [up 8051s 3977216 bytes free] /bin/sh [daemon.alert] watch_coredump() segfault in script, removing lockfiles
Mar 06 09:00:16 ' [up 8051s 3944448 bytes free] /bin/sh [daemon.alert] watch_coredump() wrote: /dev/null (low storage: was: /tmp/sh.5893.11.1394092812.core)
Mar 06 09:00:16 ' [up 8052s 4493312 bytes free] /bin/sh [daemon.alert] watch_coredump() segfault in script, removing lockfiles
Mar 06 09:00:17 ' [up 8052s 3747840 bytes free] /bin/sh [daemon.alert] watch_coredump() wrote: /dev/null (low storage: was: /tmp/sh.6130.11.1394092816.core)
Mar 06 09:00:17 ' [up 8052s 4337664 bytes free] /bin/sh [daemon.alert] watch_coredump() segfault in script, removing lockfiles
Mar 06 09:00:17 ' [up 8053s 3624960 bytes free] /bin/sh [daemon.alert] watch_coredump() wrote: /dev/null (low storage: was: /tmp/sh.6129.11.1394092816.core)
Mar 06 09:00:17 ' [up 8053s 4198400 bytes free] /bin/sh [daemon.alert] watch_coredump() segfault in script, removing lockfiles
Mar 06 09:00:18 ' [up 8053s 2920448 bytes free] /bin/sh [daemon.alert] watch_coredump() wrote: /dev/null (low storage: was: /tmp/sh.6320.11.1394092817.core)
Mar 06 09:00:18 ' [up 8053s 3432448 bytes free] /bin/sh [daemon.alert] watch_coredump() segfault in script, removing lockfiles
Mar 06 09:00:19 ' [up 8054s 3350528 bytes free] /bin/sh [daemon.alert] watch_coredump() wrote: /dev/null (low storage: was: /tmp/sh.6244.11.1394092817.core)
Mar 06 09:00:19 ' [up 8054s 3977216 bytes free] /bin/sh [daemon.alert] watch_coredump() segfault in script, removing lockfiles
Mar 06 09:00:19 ' [up 8054s 2662400 bytes free] /bin/sh [daemon.alert] watch_coredump() wrote: /dev/null (low storage: was: /tmp/sh.6397.6.1394092818.core)
Mar 06 09:00:19 ' [up 8055s 3403776 bytes free] /bin/sh [daemon.alert] watch_coredump() segfault in script, removing lockfiles
Mar 06 09:00:20 ' [up 8055s 3092480 bytes free] /bin/sh [daemon.alert] watch_coredump() wrote: /dev/null (low storage: was: /tmp/sh.6392.11.1394092818.core)
Mar 06 09:00:20 ' [up 8055s 3723264 bytes free] /bin/sh [daemon.alert] watch_coredump() segfault in script, removing lockfiles
Mar 06 09:00:20 ' [up 8056s 3698688 bytes free] /bin/sh [daemon.alert] watch_coredump() wrote: /dev/null (low storage: was: /tmp/sh.6547.11.1394092819.core)
Mar 06 09:00:20 ' [up 8056s 4276224 bytes free] /bin/sh [daemon.alert] watch_coredump() segfault in script, removing lockfiles
Mar 06 09:00:21 ' [up 8056s 3657728 bytes free] /bin/sh [daemon.alert] watch_coredump() wrote: /dev/null (low storage: was: /tmp/sh.6546.11.1394092819.core)
Mar 06 09:00:21 ' [up 8056s 4227072 bytes free] /bin/sh [daemon.alert] watch_coredump() segfault in script, removing lockfiles
Mar 06 09:00:21 ' [up 8057s 4165632 bytes free] /bin/sh [daemon.alert] watch_coredump() wrote: /dev/null (low storage: was: /tmp/sh.6759.11.1394092821.core)
Mar 06 09:16:15 ' [up 9010s 2756608 bytes free] /bin/sh [daemon.alert] watch_dns_resolution() dnsmasq died, old PIDs: '2549', restarted, PID now '11712 11710'
Mar 06 09:17:06 ' [up 9061s 4362240 bytes free] /bin/sh [daemon.alert] olsr_daemon() start: has_crashed
Mar 06 09:17:09 ' [up 9064s 3563520 bytes free] /bin/sh [daemon.alert] watch_coredump() wrote: /dev/null (low storage: was: /tmp/olsrd.5961.11.1394093825.core)
Mar 06 09:20:41 ' [up 9277s 2961408 bytes free] /bin/sh [daemon.alert] olsr_daemon() start: has_crashed
Mar 06 09:20:44 ' [up 9279s 2756608 bytes free] /bin/sh [daemon.alert] watch_coredump() wrote: /dev/null (low storage: was: /tmp/olsrd.12054.11.1394094035.core)
Mar 06 09:20:44 ' [up 9279s 5136384 bytes free] /bin/sh [daemon.alert] watch_coredump() wrote: /dev/r39139.ar71xx.hostapd.5813.11.1394094038.core
Mar 06 09:20:44 ' [up 9280s 5275648 bytes free] /bin/sh [daemon.alert] watch_coredump() cron died, restarting
Mar 06 09:20:45 ' [up 9281s 4767744 bytes free] /bin/sh [daemon.alert] watch_coredump() wrote: /dev/r39139.ar71xx.crond.6081.10.1394094041.core
Mar 06 09:21:32 ' [up 9328s 2121728 bytes free] /bin/sh [daemon.alert] scheduler_allow_run() removing lockfile, which seems to be left by accident
root@boltenhagendh-ap--75:~ date
Fri Mar  7 11:33:56 CET 2014
root@boltenhagendh-ap--75:~ reboot
root@boltenhagendh-ap--75:~ _system crashreboot




# how to configure the order of languages in captive portal
# HTTP_ACCEPT_LANGUAGE=de-DE,de;q=0.8,en-US;q=0.6,en;q=0.4
# reverse ssh tunnel
# sixxx.net / tunnelbroker.net 
# local repo for keys/design, so only 1 node must change
# password is in profile -> how profile looks like
# automount: ext2/vfat/btrfs


# nping -c1 --data-string "Geheimcode1234" 10.63.2.1

root@dhsylt-adhoc--72:~ ps
  PID USER       VSZ STAT COMMAND
    1 root      1344 R    /sbin/procd
    2 root         0 SW   [kthreadd]
    3 root         0 SW   [ksoftirqd/0]
    5 root         0 SW<  [kworker/0:0H]
    7 root         0 SW<  [khelper]
   58 root         0 SW<  [writeback]
   60 root         0 SW<  [bioset]
   62 root         0 SW<  [kblockd]
   92 root         0 SW   [kswapd0]
  137 root         0 SW   [fsnotify_mark]
  152 root         0 SW<  [ath79-spi]
  228 root         0 SW<  [deferwq]
  280 root         0 SW   [khubd]
  318 root         0 SWN  [jffs2_gcd_mtd3]
 1516 root         0 SW<  [bat_events]
 1617 root         0 SW<  [cfg80211]
 3284 root      1160 S    /usr/sbin/dropbear -F -P /var/run/dropbear.1.pid -p 22
 3315 root      1664 S    /usr/sbin/uhttpd -f -h /www -r dhsylt-adhoc--72 -c /etc/httpd.conf -x /cgi-bin -t 60 -T 30 -A 1 -E /cgi-bin-404.sh
 5298 root         0 SW   [kworker/0:0]
 5300 root         0 SW   [kworker/u2:2]
 6591 root      2192 S    /bin/sh -c . /tmp/CRON_IS_CAREFUL
10432 root         0 SW<  [kworker/0:1H]
12880 root      2204 S    /bin/sh -c . /tmp/CRON_IS_CAREFUL
17673 root      2204 S    /bin/sh -c . /tmp/CRON_IS_CAREFUL
18670 root      2176 S    /bin/sh -c . /tmp/CRON_IS_CAREFUL
19622 root      2184 S    /bin/sh -c . /tmp/CRON_IS_CAREFUL
20736 root      2184 S    /bin/sh -c . /tmp/CRON_IS_CAREFUL
20738 root         0 Z    [fgrep]
20739 root         0 Z    [cut]
20799 root      2204 R    /bin/sh -c . /tmp/CRON_IS_CAREFUL
21197 root      2204 S    /bin/sh -c . /tmp/CRON_IS_CAREFUL
21198 root      2204 S    /bin/sh -c . /tmp/CRON_IS_CAREFUL
21199 root      1484 S    fgrep FILE: 'tarball.tgz'
21200 root      1484 S    cut -d  -f2
21204 root      1304 S    /sbin/logd
21205 root       880 S    /sbin/ubusd
21208 root         0 RW   [kworker/0:1]
21209 root         0 SW   [kworker/u2:0]
21210 root         0 SW   [kworker/0:2]
21211 root         0 SW   [kworker/u2:1]
21212 root      1204 S    /usr/sbin/dropbear -F -P /var/run/dropbear.1.pid -p 22
21213 root      1676 S    -ash
21218 root         0 SW   [kworker/u2:3]
21308 root      1488 R    ps
25156 root      1536 S    /sbin/netifd
25234 root         0 Z    [udhcpc]
29751 root      2192 S    /bin/sh -c . /tmp/CRON_IS_CAREFUL




# uh! r99:
root@EG-labor-AP:~ _firmware update_pmu
-ash: /tmp/kalua/firmware: line 6: _firmware_conf: not found
-ash: /tmp/kalua/firmware: romGwrootbin/db_backup.tgz: not found
-ash: /tmp/kalua/firmware: /www/NETFILTER_AUTOADD: not found
-ash: /tmp/kalua/firmware: /www/NETPARAM: Permission denied
-ash: /tmp/kalua/firmware: /etc/HARDWARE: Permission denied
-ash: /tmp/kalua/firmware: /www/switch.txt: Permission denied
-ash: /tmp/kalua/firmware: /www/SIMPLE_MESHNODE_FORCE_DHCP_LAN: not found
Connection to 10.63.99.33 closed.



# ethernet tot: 1043nd:
root@R5orange-E1technik-MESH:~ dmesg 
[28531.430000] IPv6: ADDRCONF(NETDEV_UP): wlan0: link is not ready
[28533.760000] IPv6: ADDRCONF(NETDEV_CHANGE): wlan0: link becomes ready
[28536.940000] IPv6: ADDRCONF(NETDEV_UP): wlan0: link is not ready
[28546.430000] eth0: link down
[28546.450000] ar71xx: pll_reg 0xb8050014: 0x1a000000
[28546.450000] eth0: link up (1000Mbps/Full duplex)
[28547.820000] IPv6: ADDRCONF(NETDEV_UP): wlan0: link is not ready
[28550.100000] IPv6: ADDRCONF(NETDEV_CHANGE): wlan0: link becomes ready
[28562.400000] IPv6: ADDRCONF(NETDEV_UP): wlan0: link is not ready
[28562.730000] IPv6: ADDRCONF(NETDEV_CHANGE): wlan0: link becomes ready


# ubus call network.interface.lan status


# git clone git://nbd.name/aa-mac80211.git


# capture hostapd management traffic
http://wiki.openwrt.org/doc/devel/debugging#capture.management.traffic

# unstripped bauen:
make package/odhcpd/{clean,compile} STRIP=/bin/true

# alle originatoren:
set -- $( batctl o ); while [ -n "$1" ]; do case "$1" in *'/'*) ;; *']'*) ;; *':'*) echo $1 ;; esac; shift; done | sort
set -- $( batctl o ); while [ -n "$1" ]; do _sanitizer do "$1" mac check && echo "$1"; shift; done | sort | uniq
set -- $( batctl o ); while [ -n "$1" ]; do _sanitizer do "$1" mac check && echo "$1"; shift; done | cut -b12- | sort | uniq

# procd:
# init_debug=4 in cmdline

# Use the source, luke.
# A Ship Is Safe In The Harbor,  But That's Not What Ships Are For
# http://www.youtube.com/watch?v=JNi-2ehPU1U = 'X Farnhams Legende: Kapitel 1'

# check arp-table size:
# http://www.serveradminblog.com/2011/02/neighbour-table-overflow-sysctl-conf-tunning/

# 4900erV1-kueche / jede minute:
usbcore: deregistering interface driver snd-usb-audio
usb_audio: Warning! Unlikely big volume range (=4096), cval->res is probably wrong.
usb_audio: [5] FU [Mic Capture Volume] ch = 1, val = 0/4096/1<6>[16415.356306] usbcore: registered new interface driver snd-usb-audio


# report: r39404
up: 28428.35 load: 0.28 rest: 0.33 0.29 3/41 12489
procd: watchdog_timeout_cb(37): Ping
procd: watchdog_timeout_cb(37): Ping
procd: watchdog_timeout_cb(37): Ping
procd: watchdog_timeout_cb(37): Ping
procd: watchdog_timeout_cb(37): Ping
procd: watchdog_timeout_cb(37): Ping
EG-labor-AP
procd: watchdog_timeout_cb(37): Ping
procd: watchdog_timeout_cb(37): Ping
procd: watchdog_timeout_cb(37): Ping
procd: watchdog_timeout_cb(37): Ping
procd: watchdog_timeout_cb(37): Ping
procd: watchdog_timeout_cb(37): Ping
up: 28488.06 load: 0.10 rest: 0.27 0.28 2/41 12541
procd: watchdog_timeout_cb(37): Ping
procd: watchdog_timeout_cb(37): Ping
procd: watchdog_timeout_cb(37): Ping
procd: watchdog_timeout_cb(37): Ping
procd: watchdog_timeout_cb(37): Ping
procd: watchdog_timeout_cb(37): Ping
EG-labor-AP
procd: watchdog_timeout_cb(37): Ping
procd: watchdog_timeout_cb(37): Ping
procd: watchdog_timeout_cb(37): Ping
procd: watchdog_timeout_cb(37): Ping
procd: watchdog_timeout_cb(37): Ping
procd: watchdog_timeout_cb(37): Ping
up: 28548.28 load: 0.39 rest: 0.33 0.30 4/41 12594
procd: watchdog_timeout_cb(37): Ping
procd: instance_exit(203): Instance ubus::instance1 exit with error code 11 after 28572 seconds
procd: instance_exit(203): Instance odhcpd::instance1 exit with error code 11 after 28555 seconds
procd: instance_start(174): Started instance ubus::instance1
procd: instance_exit(203): Instance log::instance1 exit with error code 10 after 28558 seconds
procd: watchdog_timeout_cb(37): Ping
procd: instance_start(174): Started instance odhcpd::instance1
parent: /bin/sh system_crashreboot() reason: 'olsrd_missing'
procd: instance_start(174): Started instance log::instance1
procd: watchdog_timeout_cb(37): Ping
procd: watchdog_timeout_cb(37): Ping
[28596.450000] SysRq : Trigger a crash
[28596.450000] CPU 0 Unable to handle kernel paging request at virtual address 00000000, epc == 801a6f2c, ra == 801a72f4
[28596.450000] Oops[#1]:
[28596.450000] CPU: 0 PID: 12721 Comm: ux4,1390925890, Not tainted 3.10.28 #5



# report: r39139
Wed Jan 15 13:29:37 2014 kern.info kernel: [32900.550000] eth0: link down
Wed Jan 15 13:29:37 2014 daemon.info olsrd[2585]: Removing interface eth0.1
Wed Jan 15 13:29:37 2014 kern.debug kernel: [32900.580000] ar71xx: pll_reg 0xb8050014: 0x1a000000
Wed Jan 15 13:29:37 2014 kern.info kernel: [32900.580000] eth0: link up (1000Mbps/Full duplex)
Wed Jan 15 13:29:37 2014 daemon.info olsrd[2585]: Removing interface eth0.2
Wed Jan 15 13:29:37 2014 daemon.info olsrd[2585]: Writing '0' (was 0) to /proc/sys/net/ipv4/conf/eth0.1/send_redirects
Wed Jan 15 13:29:37 2014 daemon.info olsrd[2585]: Writing '0' (was 0) to /proc/sys/net/ipv4/conf/eth0.1/rp_filter
Wed Jan 15 13:29:37 2014 daemon.notice netifd: Interface 'lan' is now up
Wed Jan 15 13:29:37 2014 daemon.notice netifd: Interface 'loopback' is now up
Wed Jan 15 13:29:37 2014 daemon.notice netifd: Interface 'wan' is now up
Wed Jan 15 13:29:37 2014 daemon.info olsrd[2585]: Adding interface eth0.1
Wed Jan 15 13:29:37 2014 daemon.info olsrd[2585]: Writing '0' (was 0) to /proc/sys/net/ipv4/conf/eth0.2/send_redirects
Wed Jan 15 13:29:37 2014 daemon.info olsrd[2585]: Writing '0' (was 0) to /proc/sys/net/ipv4/conf/eth0.2/rp_filter
Wed Jan 15 13:29:37 2014 daemon.info olsrd[2585]: Adding interface eth0.2
Wed Jan 15 13:29:37 2014 daemon.warn 6relayd[2622]: Termination requested by signal.
Wed Jan 15 13:29:37 2014 daemon.warn 6relayd[2622]: Failed to relay to ff02::1%eth0.1 (Cannot assign requested address)
Wed Jan 15 13:29:38 2014 kern.info kernel: [32901.540000] IPv6: ADDRCONF(NETDEV_UP): wlan0: link is not ready
Wed Jan 15 13:29:38 2014 kern.info kernel: [32901.560000] IPv6: ADDRCONF(NETDEV_CHANGE): wlan0: link becomes ready
Wed Jan 15 13:29:41 2014 daemon.notice netifd: radio0 (16174): Bus error (core dumped)
Wed Jan 15 13:29:41 2014 daemon.notice netifd: radio0 (16174): Device setup failed: HOSTAPD_START_FAILED
Wed Jan 15 13:29:42 2014 daemon.debug olsrd_hotplug: [OK] already_active: 'lan' => 'eth0.1'
Wed Jan 15 13:29:42 2014 daemon.err 6relayd[16266]: Unable to open interface wan6 (No such device)
Wed Jan 15 13:29:42 2014 daemon.debug olsrd_hotplug: [OK] already_active: 'wan' => 'eth0.2'
Wed Jan 15 13:29:42 2014 daemon.info olsrd_hotplug: [OK] ifup: 'loopback' => 'lo'
Wed Jan 15 13:29:42 2014 daemon.debug olsrd_hotplug: [OK] interface 'loopback' => 'lo' not used for olsrd
Wed Jan 15 13:29:55 2014 kern.info kernel: [32917.040000] IPv6: ADDRCONF(NETDEV_UP): wlan0: link is not ready
Wed Jan 15 13:29:55 2014 kern.info kernel: [32919.290000] IPv6: ADDRCONF(NETDEV_CHANGE): wlan0: link becomes ready
Thu Jan 16 07:44:10 2014 authpriv.info dropbear[16426]: Child connection from 10.10.39.25:39313
Thu Jan 16 07:44:13 2014 authpriv.notice dropbear[16426]: Password auth succeeded for 'root' from 10.10.39.25:39313
# -> no coredump found, but coredump of crond found














# batman-adv
# general device config structure:
config device
  option type device-type  # e.g. "macvlan"
  option name virtual-ifname  # e.g. "macvlan0"
  list ifname lower-device  # e.g. "eth0"
  # one or more type specific options, e.g. "option macaddr" for macvlan
 
# example for batadv:
config device
  option type batadv
  option name bat0  # this is the virtual batiface that is to be created
  list ifname wlan0 # these are the devices bat0 should contain
  list ifname wlan1 # ...
  # zero or more options that apply to bat0
 
# example for batadv-vlan:
config device
  option type batadv-vlan
  option name bat0.1  # we want to make a vlan1 on top of bat0
  list ifname bat0 # this is the base device for bat0.1
  # zero or more options that apply to batman vlans




# bluetooth:
# http://h-wrt.com/en/doc/bluetooth
# https://forum.openwrt.org/viewtopic.php?id=22343
# https://forum.openwrt.org/viewtopic.php?id=29977
# http://www.ebay.de/itm/Ampire-BLU100-BLK-AMPIRE-Bluetooth-Aktivlautsprecher-mit-Akku-schwarz-/141131890603?pt=DE_Lautsprecher_Martin&hash=item20dc1dbfab


# ssh $IP wird sofort wieder beendet, das steht dann im log:
Sun Jan  5 10:11:52 2014 authpriv.info dropbear[30105]: Child connection from 192.168.2.1:52923
Sun Jan  5 10:11:59 2014 authpriv.notice dropbear[30105]: Password auth succeeded for 'root' from 192.168.2.1:52923
Sun Jan  5 10:12:00 2014 authpriv.err dropbear[30106]: ioctl(TIOCSCTTY): Input/output error
Sun Jan  5 10:12:00 2014 authpriv.err dropbear[30106]: /dev/pts/0: No such file or directory
Sun Jan  5 10:12:00 2014 authpriv.err dropbear[30106]: open /dev/tty failed - could not set controlling tty: No such device or address




# IRC: list users in channel: /names

# airport graphit:
# http://web.archive.org/web/20031207071236/http://www-hft.ee.tu-berlin.de/~strauman/airport/airport.html
# http://web.archive.org/web/20031211141153/http://www-hft.ee.tu-berlin.de/~strauman/airport/airport_etherboot.html

# mailinglist:
# https://lists.openwrt.org/pipermail/openwrt-devel/2013-October/021752.html
#
# loader.c -> reset when halt():
# ./target/linux/ar71xx/image/lzma-loader/src/ar71xx_regs.h
# #define AR71XX_APB_BASE         0x18000000
# #define AR71XX_RESET_BASE       (AR71XX_APB_BASE + 0x00060000)
#
 #define AR71XX_RESET_REG_RESET_MODULE           0x24
 #define AR913X_RESET_REG_RESET_MODULE           0x1c
 #define AR724X_RESET_REG_RESET_MODULE           0x1c
 #define AR933X_RESET_REG_RESET_MODULE           0x1c
 #define AR934X_RESET_REG_RESET_MODULE           0x1c
#
 #define AR71XX_RESET_FULL_CHIP          BIT(24)
 #define AR934X_RESET_FULL_CHIP          BIT(24)
# 
# target/linux/ar71xx/image/lzma-loader/src/loader.c
# arch/mips/include/asm/mach-ath79/ath79.h
# -> ath79_device_reset_set -> ath79_reset_wr(unsigned reg, u32 val) -> 
#  __raw_readl(ath79_reset_base + reg);
#  __raw_writel(val, ath79_reset_base + reg);


# flashbank:
#  1. brcm47xx = wrt54g + wap?
#  2. brcm63xx = speedW500V/Targa-WR-500-VoIP
#  3. ar71xx = tplink 1043nd + 841nd + Bullet 5M
#  4. atheros = ar231x = ar2315-fonera + 5312-nanostation5 + dlink-dir300
#  5. au1000 = meshcube/tmobilebox
#  6. ar7 = alte fritzbox?
#  7. mpc85xx = 4900er
#  8. x86 = Soekris NET
#  9. kirkwood = NAS/seagate
# 10. imx23/mx2 = chumbyOne
# 11. s3c24xx   = openmoko (removed @34767)
# 12. Marvell/Intel PXA2xx/ARM   = zipit
# 13. omap4 = pandaboard
# 14. brcm2708 = raspberryPi
# 15. Cobalt = SunCobalt-RaQ4i
# 16. rb532 = routerboard/boltenhagen
# 17. gemini = Wilibox WBD-111 (kaufen)
# 18. arm5l = WiFiSD-Card
# 19. sparc = SUN Enterprise 250 UltraSparc
# 20. imx21 = VP6500
# 21. ???   = horstbox

# empfang schlechter: txpower?: iw dev wlan0 set txpower fixed 2300
# vorher: r35300
root@hauptstrasse52-dach:~ n
Table: Links
Local IP	Remote IP	Hyst.	LQ	NLQ	Cost
10.10.36.1	10.10.2.1	0.00	0.701	0.364	3.905	
10.10.36.25	10.10.225.33	0.00	1.000	1.000	0.100		# OK
10.10.36.1	10.10.157.1	0.00	0.607	0.454	3.616	
10.10.36.1	10.10.12.1	0.00	0.592	0.753	2.242		# OK
10.10.36.1	10.10.17.1	0.00	0.306	0.000	INFINITE	
10.10.36.1	10.10.4.1	0.00	0.497	0.713	2.813	
10.10.36.1	10.10.22.1	0.00	0.000	0.000	INFINITE	
# nachher: r39139
root@hauptstrasse52-dach:~ n
Table: Links
Local IP        Remote IP       Hyst.   LQ      NLQ     Cost
10.10.36.1      10.10.2.1       0.00    0.701   0.000   INFINITE
10.10.36.25     10.10.225.33    0.00    1.000   1.000   0.100   	# OK
10.10.36.1      10.10.157.1     0.00    0.701   0.000   INFINITE
10.10.36.1      10.10.12.1      0.00    0.514   0.725   2.683   	# OK (wenig schlechter)
10.10.36.1      10.10.17.1      0.00    0.074   0.000   INFINITE
10.10.36.1      10.10.4.1       0.00    0.211   0.000   INFINITE
10.10.36.1      10.10.22.1      0.00    0.000   0.000   INFINITE
# spaeter nochmal / r39139:
root@hauptstrasse52-dach:~ n
Table: Links
Local IP        Remote IP       Hyst.   LQ      NLQ     Cost
10.10.36.1      10.10.2.1       0.00    0.804   0.259   4.806   	# etwas schlechter
10.10.36.25     10.10.225.33    0.00    1.000   1.000   0.100		# OK
                10.10.157.1
10.10.36.1      10.10.12.1      0.00    0.713   0.776   1.804		# OK
                10.10.17.1
10.10.36.1      10.10.4.1       0.00    0.031   0.717   INFINITE
                10.10.22.1
10.10.36.1      10.10.72.1      0.00    0.682   0.271   5.416   


# RAM/memory-fragmentation:
# echo m > /proc/sysrq-trigger
# http://stackoverflow.com/questions/4863707/how-to-see-linux-view-of-the-ram-in-order-to-determinate-the-fragmentation
#
# maybe set 'CONFIG_COMPACTION', so we can use 'echo 1 >/proc/sys/vm/compact_memory'

# memleak global vars?
# http://landley.net/notes-2006.html#24-10-2006

# be strict:
# https://sipb.mit.edu/doc/safe-shell/
# set -e

# styleguide?
# http://google-styleguide.googlecode.com/svn/trunk/shell.xml

# how does this work, maybe join?: http://oops.kernel.org/
# https://lkml.org/lkml/2013/8/22/208


# generische beschreibung eines routers / der komponenten. = mailingliste: mal raussuchen, gabs schonmal was
TP-LINK TL-WDR4900 {
{
	SoC: Atheros AR9342 rev 2
	arch:
	endianess:
	switch: AR8327v4
	ram: 128
	flash: 32
	cpu:
	radio0:
	radio1:
}


TODO-important:
# read quilt: http://wiki.openwrt.org/doc/devel/patches
# openwrt: git grep 'md5sum -'
# openwrt: git grep ' '$	// space + tabs
# openwrt: git grep 'case "\${#'
# openwrt: git grep 'case \$'
# openwrt: failsafe via crashlog
# openwrt: git grep ' () {'
# openwrt: git grep -e '((\$'	// wrong parenthesis
# openwrt: git grep ' -le "'	// dont calc wit ""
# openwrt: git grep '=""'	// enforce empty var is enough with: A=
# openwrt: refactor postinst()
# openwrt: cleanup 'package/base-files/files/bin/login.sh'
# openwrt: include/download.mk - cleanup: prepare_download()
# openwrt: git grep " -ot " ... git grep " -nt "
#
# 
# patches liefern:
# openwrt: git ls-files | while read FILE; do grep -HPzo 'return \$\?\n}' "$FILE";done
# openwrt: hotplug: dont export _C= + SHVLV= + CONFIG_APPEND= + LIST_SEP= + LOAD_STATE= + LOGNAME= + board= + script=
# openwrt: maintain atftp/atftpd / oldpackages
# openwrt: show crash when login
# openwrt: implement ifconfig with 'shellscript/netifd/json'
# openwrt: repair '/bin/board_detect'
#
# http://patchwork.openwrt.org/project/openwrt/list/?order=submitter
#
# git: patch for 'git fgrep' = 'git grep -F'
#
#
#

# showstopper before release:
  - RRD
  - VDS
  - tcpdump-segfault:            https://dev.openwrt.org/ticket/17753#comment:6
  - ppp-crash:                   https://dev.openwrt.org/ticket/18118 + https://dev.openwrt.org/ticket/7793#comment:44 + https://dev.openwrt.org/ticket/18799
  - switch 1043/10mbit all ports https://dev.openwrt.org/ticket/12491
  - logd/logread/ubus:		 https://dev.openwrt.org/ticket/18364
  - logd/klog                    https://dev.openwrt.org/ticket/18419
  - netifd-crash:                https://dev.openwrt.org/ticket/18204 - r43738 still affected
  - ath9k-fix: "hangs"           https://dev.openwrt.org/ticket/17364 - r43060/r43210 still affected
  - ath9k-fix: "gets slower"     https://dev.openwrt.org/ticket/17582 - r43102 still affected
  - ath9k-fix: TX DMA            https://dev.openwrt.org/ticket/11862 - r43102 still affected
  - atk9k-fix: WDS/packetloss	 https://dev.openwrt.org/ticket/17354 - r43209
  - atk9k-fix: reboots	 	 https://dev.openwrt.org/ticket/18497
  - ath9k-signal-strength        https://dev.openwrt.org/ticket/17565
  - hostapd-crash:               https://dev.openwrt.org/ticket/18126 - r43738 still affected
  - odhcp6c-crash: test: r43056+ https://dev.openwrt.org/ticket/18212 - r43589 still affected
  - ag71xx-fix:                  https://dev.openwrt.org/ticket/6754
                                 https://dev.openwrt.org/ticket/14035
                                 https://dev.openwrt.org/ticket/11217
				 https://dev.openwrt.org/ticket/18415
				 https://dev.openwrt.org/ticket/18616 - fixed? TESTEN!
  - ar8216-fix:			 https://dev.openwrt.org/ticket/17800 - still issues with 3.14
  - atheros-watchdog:		 ???				      - r43781 still affected (dhfl)
  - pppoe/autoreconnect fails:   https://dev.openwrt.org/ticket/18026
  - archerC7 v2:		 https://dev.openwrt.org/ticket/16589#comment:86

#
#
# change domain to 'wlan'?
# das WLAN 10.10.0.0/16 darf auf 172.17.0.28
445
137
139
35255
4343
8059

exchange = 0.23 port 999

dns/ntp eigentlich 172.17.0.21/22 aber besser gleich die 0.1 fragen
test: ejbw-ex01.ejbweimar.lan -> 172.17.0.23
test: mail.ejbweimar.de
test: email.ejbweimar.de
mac-schutz ejbw ausschalten

# fix olsrd2-build: v.0.6.0
# vtund: link up/down
  - make sure IF is not blocked by olsrd: before 'up', clean old ifs or even kill olsrd
  - check in intervals, if all tap's have an ipv6 - if not - kill olsrd
  - script can hang:
  root@server1:~# lsof | grep tun|grep -v vtun
  tincd      2852          root    4u      CHR             10,200      0t0 1269554737 /dev/net/tun
  sh        24056          root    4u      CHR             10,200      0t0 1269554737 /dev/net/tun
  olsrd     24059          root    4u      CHR             10,200      0t0 1269554737 /dev/net/tun
  - ps:
  24056 ?        S      0:00 sh -c . /tmp/loader; _vpn; _vpn_innercity_master_iface up   tap81
  #
dev_ok()
{
  cut -d':' -f1 /proc/net/dev | while read DEV; do
    case "$DEV" in 'tap'*|' tap'*)
      ip address show dev $DEV | grep -q 'inet6 ' || return 1
    esac
  done
}

dev_ok || olsr_restart

=== kkk ===
# sort -u VS sort | uniq -> r30823 kann es
# report via mail when pinglost on inetoffer each day?
# write hotplug for p910d -> https://dev.openwrt.org/ticket/18773
# vpn: use 'type tun' and 'proto udp'???
# DHT for mac's: full or half and use for splash
# tastatur per USB/funktastatur anschliessen und neuen hostnamen eintippen?
# dnsmasq: option localservice 0	# since r43982
# monitoring: dont show crashs older than X days?
# check minstrel: only slow rates and massiv sampling on alle rates -> HWreset
# fix pdf output: http://www.pdf-tools.com/pdf/validate-pdfa-online.aspx
# build: automatically add new downloads to a git and push - use this git during initial setup
# bad olsr-ip of 44? from NAS? how can that happen?
# http://www.shellcheck.net/about.html

system.vpn.hostname=weimarnetz.de
system.vpn.ipaddr=77.87.48.19
system.vpn.port=5001
system.vpn.enable=1

# HTTP_ACCEPT_ENCODING=gzip, deflate, sdch -> deliver compressed? http://checkgzipcompression.com/?url=https%3A%2F%2Fwww.google.de
  - laptop: nc -l 9999 >request + open in browser 127.0.0.1:9999 + CTRL+C
  - cat request | nc www.google.de 80 >response -> see headers 8-)
    - Content-Encoding: gzip
full:
bastian@X301:~$ more response
HTTP/1.1 200 OK
Date: Thu, 08 Jan 2015 10:10:51 GMT
Expires: -1
Cache-Control: private, max-age=0
Content-Type: text/html; charset=UTF-8
Set-Cookie: NID=67=jXeenU8io_2QnBFCf-0JlEhEXhaTM3fZ_V_nf4OacdZgpEIKZ2ruV_9nNVpBULabLun_3SNPNZIvGiJfkJlCjNtAPzNAlASGq-d0jv_yd5WMsrvQFjXA-X4q_IKXi0TX; expires=Fr
i, 10-Jul-2015 10:10:51 GMT; path=/; domain=.; HttpOnly
P3P: CP="This is not a P3P policy! See http://www.google.com/support/accounts/bin/answer.py?hl=en&answer=151657 for more info."
Content-Encoding: gzip
Server: gws
X-XSS-Protection: 1; mode=block
X-Frame-Options: SAMEORIGIN
Transfer-Encoding: chunked
Alternate-Protocol: 80:quic,p=0.02

7872
[...]


00000270  50 72 6f 74 6f 63 6f 6c  3a 20 38 30 3a 71 75 69  |Protocol: 80:qui|
00000280  63 2c 70 3d 30 2e 30 32  0d 0a 0d 0a 37 38 37 32  |c,p=0.02....7872|
                                   ^^^^^^^^^^^
00000290  0d 0a 1f 8b 08 00 00 00  00 00 02 ff ec bd d9 76  |...............v|
          ^^^^^^^^^^^
000002a0  db c8 92 00 f8 5e 5f 41  d1 dd 12 d9 82 28 80 fb  |.....^_A.....(..|

---> gzip = 1f8b - aber vorher kommt noch 0d 0a + 0d 0a + 37 38 37 32 , 0d 0a + 1f 8b



printf "HEAD / HTTP/1.0\r\n\r\n" | nc -n -i1 10.63.96.225 80
printf "HEAD /cgi-bin-status.sh HTTP/1.0\r\n\r\n" | nc -n -i1 10.63.22.65 80
printf "GET /cgi-bin-status.sh HTTP/1.0\r\n\r\n" | nc -n -i1 10.63.22.65 80

00000020  73 65 0d 0a 43 6f 6e 74  65 6e 74 2d 74 79 70 65  |se..Content-type|
00000030  3a 20 74 65 78 74 2f 68  74 6d 6c 0d 0a 0d 0a 3c  |: text/html....<|
                                            ^^^^^^^^^^^ = linebreak
00000040  21 44 4f 43 54 59 50 45  20 48 54 4d 4c 20 50 55  |!DOCTYPE HTML PU|

# transfer-encoding:
bastian@X301:~$ printf "GET /cgi-bin-status.sh HTTP/1.0\r\n\r\n" | nc -n -i1 10.63.22.65 80 | hexdump -C
00000000  48 54 54 50 2f 31 2e 30  20 32 30 30 20 4f 4b 0d  |HTTP/1.0 200 OK.|
00000010  0a 43 6f 6e 6e 65 63 74  69 6f 6e 3a 20 63 6c 6f  |.Connection: clo|
00000020  73 65 0d 0a 43 6f 6e 74  65 6e 74 2d 74 79 70 65  |se..Content-type|
00000030  3a 20 74 65 78 74 2f 68  74 6d 6c 0d 0a 54 72 61  |: text/html..Tra|
00000040  6e 73 66 65 72 2d 45 6e  63 6f 64 69 6e 67 3a 20  |nsfer-Encoding: |
00000050  67 7a 69 70 0d 0a 0d 0a  37 38 37 32 0d 0a 1f 8b  |gzip....7872....|
                      ^^^^^^^^^^^              ^^^^^^^^^^^
00000060  08 00 49 2e b0 54 02 03  ed 5b 7b 73 db 38 92 ff  |..I..T...[{s.8..|

# content-encoding:
bastian@X301:~$ printf "GET /cgi-bin-status.sh HTTP/1.0\r\n\r\n" | nc -n -i1 10.63.22.65 80 | hexdump -C >/tmp/BLA
00000000  48 54 54 50 2f 31 2e 30  20 32 30 30 20 4f 4b 0d  |HTTP/1.0 200 OK.|
00000010  0a 43 6f 6e 6e 65 63 74  69 6f 6e 3a 20 63 6c 6f  |.Connection: clo|
00000020  73 65 0d 0a 43 6f 6e 74  65 6e 74 2d 74 79 70 65  |se..Content-type|
00000030  3a 20 74 65 78 74 2f 68  74 6d 6c 0d 0a 43 6f 6e  |: text/html..Con|
00000040  74 65 6e 74 2d 45 6e 63  6f 64 69 6e 67 3a 20 67  |tent-Encoding: g|
00000050  7a 69 70 0d 0a 0d 0a 37  38 37 32 0d 0a 1f 8b 08  |zip....7872.....|
                   ^^^^^^^^^^^              ^^^^^^^^^^^
00000060  00 49 2e b0 54 02 03 ed  5b 7b 73 db 38 92 ff fb  |.I..T...[{s.8...|



http://www.gzip.org/zlib/rfc-gzip.html#file-format
http://stackoverflow.com/questions/388595/why-use-deflate-instead-of-gzip-for-text-files-served-by-apache
http://www.vervestudios.co/projects/compression-tests/results
http://stackoverflow.com/questions/11584390/on-linux-use-the-compress-and-uncompress-functions-of-zlib-it-sometimes-re
http://stackapps.com/questions/916/why-content-encoding-gzip-rather-than-transfer-encoding-gzip
http://stackoverflow.com/questions/2308389/gzip-without-server-support
http://stackoverflow.com/questions/3894794/node-js-gzip-compression
https://github.com/tomgco/gzippo/blob/master/lib/staticGzip.js


# use 'readonly $var' ?
# announce reboot to neighs via netmsg - e.g. against false positives of switch() / lost olsr neigh
# switch: rb532
# S43ether: alles ist client und alle interfaces die hochkommen werden abgezogen. loest das prob mit .3 = user-lan3-n222 -> soll = node222adhoc?
# opkg install ca-certificates + export SSL_CERT_DIR=/etc/ssl/certs ???
# pdf: font aendern oder einbetten
# stresstest netifd/ulogd
# button: support for pressing e.g. 7 times
# ilm1: mcastrate auf 2.4ghz hoch -> 5ghz bevorzugen
# autoconvert?:
  - option hwmode '11ng' -> 11g
  - list ht_capab -> option path     'platform/ath9k'
# paltstadt: 5/bssid + ffeth + 10.63?
# crashlog2log (init) extra function
# use parser?: http://www.yolinux.com/TUTORIALS/BashShellCgi.html
# remove '$DIR_DATABASE' from flash? (old error) - so we can test -d $DIR_DATABASE && ...
# unstable LAN? rehungen: mii-tool -r eth0 (3 stellen auf 249)
# ejbw: 10.10.31.61: empfaengt OLSR, aber wird nicht gehoert (aber 55 hoert in doch!)
# restoring userdata: wait till tar is good? how can it happen, that a bad tar is uploaded? -> full disc during download/restore
  ### signal/sms when [ERR] untar DB
# newstyle-firmware-update:
  # es sollte moeglich sein eine beliebige konstellation anzufordern und zu checken, also:
    # gibt mir/zeig mir: stable/beta/testing oder
    # bau mir XY mit version r12345 (dann muss update = 0 gemacht werden)

  - pmu:
    https://$monitoringserver/networks/$NET/scripts/testing/tarball.tgz
  - firmware:
    https://$monitoringserver/networks/$NET/firmware/models/$HW/testing/$fullname.bin
  #
  _links firmware_url_get
  _links firmware_url_get tarball
  _links firmware_url_get crc


# dhf: jeder kann master werden (wenn WAN gesteckt wird?)
# RRD-graph for VPN-server
# dynamic_portfw: generate JSON? or sh-script for monitoring-server [xoai]
# think about _scheduler_wait_till_cpuload_is_low()
# alle: $( _system version short ) -> $OPENWRT_REV
# firmware_burn: dont complain 'msg3' when network-stuff was not unloaded?
# rmmod: dont try to unload /proc/modules -> 'ipv6                  256705 16 [permanent]'
# monitoring-wifimac = locally_administered -> delete + recreate + correcting on monitoring-server?
# fix au1000-mac: "add a file in /etc/uci-defaults/ these get called on firstboot and are deleted after being run"
# S43ether breaks for kurt/dns/LAN - 10.63.156.161 = 666
# make use of 'ip -details link' for getting type (wireless, tun, ether, vlan)
# checken ob einspeiser wirklich 0.0.0.0/0 hat? -> spbansin7
# tobi/youtube-dl -g
# reduce the "CRON_LASTCALL" -checker to: hotplug/dhcp + www?
# dont complain about unstable LAN
  - for new neighs (report after olsr-newup) + delete from log
# fix: first LOWMEM after first olsr_build_tables
# implement system.@netfilter[0].lan_masquerading = 0
# check if dnsmasq really offers all configured ranges? -> ejbw -> schulkinowoche
# monitoring-server: watch failure of longshot 
# defaultrouter (ppp!) does not work? -> fax/sms via nexthop + remove HNA inet-offer
# nach crash/reboot werden clients nicht automatisch wieder angemeldet
# db: erst mails verschicken, wenn backup erfolgreich?
# db: regen grepable -> signal to all for new download?
# olsr: dont log all unstable neigh's of at least 1 is good or it is our default route
# use image in readme: ![sxiv](http://muennich.github.com/sxiv/img/logo.png "sxiv")

### changed effective gateway? effective nexthop? send message once (with lifetime)?

### howto remotely add/del hideandseek-user?
### autoactivate hideandseek on master for ALL routers...(the master must not be the authserver)
    # hideandseek: add all IP's via trafficsend ... + autoremove old IP's on master
    # master can reboot and everything/rules is lost?
# vpn-server:
  - write default olsr.conf
  - provide minihelper for compile olsrd + vtun + tinc?
# vpn: hide port/ip/mtu/etc in dns-SRV records:
  # wie linken auf vpnserver mit anderem port?
  # echo 'request google.de' | nc -vu 8.8.8.8 53 >/tmp/H
  # http://www.jfranken.de/homepages/johannes/vortraege/netcat_inhalt.de.html#ToC6
  # dig _carddav._tcp.home.andi95.de SRV
# convert to valid reasons: git grep 'system reboot_safe'
# vpn_hideandseek: remove old IPs (same mask) before add 'exclude'
  -> how to check, if 10.63.22.125/26 belongs to 10.63.22.65/26?
  -> ip2long()
  -> calc net-address? http://networkengineering.stackexchange.com/questions/7106/how-do-you-calculate-the-prefix-network-subnet-and-host-numbers
  -> test youtube nongerman/nonblocked with: Tron Legacy - Overture (1) [Daft Punk] 


# tune TCP and lowmem devices: https://dev.openwrt.org/ticket/9304#comment:41
# use statistics from 'iw wlan0 survey dump': http://stackoverflow.com/questions/24161383/how-to-get-wifi-channel-busy-time
# fix S43 for nslookup: 10.63.222.3
# lsusb -> find /sys/devices/platform/ehci-platform|fgrep '/idVendor' + idProduct
# build: use diffconfig.sh?
# adserver: change range to priv-ip
# fix: MESSAGE="startup/ when db cannot be downloaded
# ffweimar -> weblogin nur mit "wegdruecken" + integration grafiken/button ins image?
# log() sms_once + all alert to central master?
# halfduplex when bullet -> 1043 and enforced rate 100mbit?
# bullet: 10mbit -> only switch if error eccured once? 
# loader: empty arg = show, but only if interactive - otherwise just include -> in s() case "$-" in *i*)
# always set 'funcname' or let it include from loader? (also $self - so we can call ourself)
# propagate loss of inet on master?
# tunnel: make a NOT possible (e.g. everything through tunnel but NOT xy) -> also make 'mask' part if $1 and $2 = NOT
# towerpower: 0.0.0.0/0 nach uhrzeit?
# wifi: ath9k: track worst/best calibration value
# debugfs knob 'dfs_block_radar_events'
# fix registrator with new API (get_next_free)
# vpn: check_server + check_client: use 'hanging_command vtund'
# win-prob: dns.msftncsi.com
# rechedule: include stub-class? e.g: _vpn; _vpn bla
# olsr-status: kabelnachbarn werden nicht als missing angezeigt
# userdb-gui: suchen 'in allen profilen' geht nicht
# cron.add... show "best" 3
# $IPT -> function?
# vpn-server: ordentliche index-page + robots.txt
# test: env-space gets exhausted with 128k VARS= ??? (including funcs?)
# protection against: NTP-Amplification-Attack
# towerpower: reject all from wan?
# olsr: wird nicht jede minute geprueft?
# youtube-dl: einspeiser fragt vpn-server: ich bin dein "tinyproxy:8888", gibbe URL von VideoX - download X + loop (jedes mal anderer browser?)
# test: usb-stick -> automount -> audiofiles ueber cgi-bin-music.sh freigeben und ankuendigen
# innercity-tunnel:
  - join server + router-skripts
    - alle nodenummern fuer vtun-conf erzeugen
  - verschiedene tunnel:
    - innercity()
      - server
      - client: hideandseek()
    - router2inetoffergw()
      - user2inetoffergw()
    - intercity()
  - vpn_hideandseek_user_add()
  - vpn_hideandseek_user_del()
  - vpn_beim einloggen "ich will" an zentrale (wie tool?) und bei jeder trafficmeldung auch.
    - vpn_askmaster_request_permission()
  - koppeln an ETX 1.000 fuer 5min - nutzer die "wollen" muessen sich vorher anmelden und werden einzeln an/abgeschaltet
    - in olsr_build_tables()
  - youtube-mode: http://stackoverflow.com/questions/9342782/is-there-a-way-to-get-all-ip-addresses-of-youtube-to-block-it-with-windows-firew


# iptables: hotplug: integrate tunnel-traffic https://github.com/weimarnetz/weimarnetz/blob/master/openwrt-addons/etc/kalua/vpn#L160
# longshot-test: check with 'strings' if trash arrived
# block info /dev/sdb -> should fail of n/a
# user_list -> also in e.g. /tmp/OLSR/fixed_arp_10.63.40.97? -> delete user
# code-duplication of watchdns + _net_refresh_dnshosts
# refresh hosts/statistic of dnsmasq sometimes wrong pid
# hash aus downloaddir weg, wird nicht gebraucht. ausserdem order-struktur aufraeumen
# auto-apport of crashdumps
# longshot-report: /sys/kernel/debug/ieee80211/phy0/ath9k/dfs_stats
# log: wenn $funcname da ist, mit anzeigen?
# fix autoreschedule
#
# userdb:
  - zeigen an welche emails verschickt wird
  - pdf/font: arialnarrow gibts nicht ueberall, fallbackfont einbinden (Times)
  - ticket-nummern + seitennummern
  - funktion: sperren/gesperrt
  - abgleaufen anzeigen


#
# olsr-netfilter: -d unneeded? separate wired/2.4/5ghz?
# fehlerhafter mailversand wenn erst gmx, dann scp
# mydesign: FeWo Wuensch
# mydesign: ffweimar
# mydesign: zwickauerflitzer
# VPN: hotplug -> wan/lan
# called too often: netfilter_masquerade_start
# hostapd oder 'iw event'-script: http://forum.ubuntuusers.de/topic/hostapd-wlan-ap-aufruf-eines-scripts-wenn-ein-/
# fix ADSL broken in monitoring: check inet_gw: pppoe
# jffs2-ready() hook '/sbin/jffs2reset -y'? or /sbin/jffs2mark
# switch: html: detect blink and show it (rebooting neigh)
root@dhfleesensee-adhoc--62:~ while :;do echo "$(date) $(_switch show)";sleep 1;done
Thu Oct 30 14:15:39 CET 2014 -.----
Thu Oct 30 14:15:40 CET 2014 -.----
Thu Oct 30 14:15:41 CET 2014 -.----
Thu Oct 30 14:15:43 CET 2014 -.----
Thu Oct 30 14:15:44 CET 2014 -.C---
Thu Oct 30 14:15:45 CET 2014 -.C---
Thu Oct 30 14:15:46 CET 2014 -.C---
Thu Oct 30 14:15:47 CET 2014 -.C---
Thu Oct 30 14:15:48 CET 2014 -.C---
Thu Oct 30 14:15:50 CET 2014 -.C---
Thu Oct 30 14:15:51 CET 2014 -.C---
Thu Oct 30 14:15:52 CET 2014 -.C---
Thu Oct 30 14:15:53 CET 2014 -.C---
Thu Oct 30 14:15:54 CET 2014 -.C---
Thu Oct 30 14:15:55 CET 2014 -.C---
Thu Oct 30 14:15:57 CET 2014 -.C---
Thu Oct 30 14:15:58 CET 2014 -.C---
Thu Oct 30 14:15:59 CET 2014 -.C---
Thu Oct 30 14:16:00 CET 2014 -.C---
Thu Oct 30 14:16:01 CET 2014 -.C---
Thu Oct 30 14:16:02 CET 2014 -.C---
Thu Oct 30 14:16:04 CET 2014 -.C---
Thu Oct 30 14:16:05 CET 2014 -.C---
Thu Oct 30 14:16:06 CET 2014 -.----
Thu Oct 30 14:16:07 CET 2014 -.----
Thu Oct 30 14:16:08 CET 2014 -.----
Thu Oct 30 14:16:09 CET 2014 -.----
Thu Oct 30 14:16:11 CET 2014 -.----
Thu Oct 30 14:16:12 CET 2014 -.----
Thu Oct 30 14:16:13 CET 2014 -.----
Thu Oct 30 14:16:14 CET 2014 -.C---
Thu Oct 30 14:16:15 CET 2014 -.C---
Thu Oct 30 14:16:16 CET 2014 -.C---
Thu Oct 30 14:16:18 CET 2014 -.C---
Thu Oct 30 14:16:19 CET 2014 -.C---
Thu Oct 30 14:16:20 CET 2014 -.C---
Thu Oct 30 14:16:21 CET 2014 -.C---
Thu Oct 30 14:16:22 CET 2014 -.C---
Thu Oct 30 14:16:23 CET 2014 -.C---
Thu Oct 30 14:16:25 CET 2014 -.C---
Thu Oct 30 14:16:26 CET 2014 -.C---
Thu Oct 30 14:16:27 CET 2014 -.C---
Thu Oct 30 14:16:28 CET 2014 -.C---
Thu Oct 30 14:16:29 CET 2014 -.C---
Thu Oct 30 14:16:30 CET 2014 -.C---
Thu Oct 30 14:16:32 CET 2014 -.C---
Thu Oct 30 14:16:33 CET 2014 -.C---
Thu Oct 30 14:16:34 CET 2014 -.C---
Thu Oct 30 14:16:35 CET 2014 -.----
Thu Oct 30 14:16:36 CET 2014 -.----
Thu Oct 30 14:16:37 CET 2014 -.----
Thu Oct 30 14:16:39 CET 2014 -.----
Thu Oct 30 14:16:40 CET 2014 -.----
Thu Oct 30 14:16:41 CET 2014 -.----
Thu Oct 30 14:16:42 CET 2014 -.----
Thu Oct 30 14:16:43 CET 2014 -.C---
Thu Oct 30 14:16:44 CET 2014 -.C---
Thu Oct 30 14:16:46 CET 2014 -.C---



# make user of '/tmp/sysinfo/board_name' -> tl-wr1043nd
# make use of output/switchtype: swconfig dev switch0 help
# fire memtest before flashing? = 6K -> http://downloads.openwrt.org/attitude_adjustment/12.09/ar71xx/generic/packages/memtester_4.1.3-1_ar71xx.ipk
# make use of 'test -s $file' (must be greater than zero)
# build.sh: fix --kernel with new VAR
# make use of 'opkg list-changed-conffiles'?
# delete capabilities in CC+: https://dev.openwrt.org/ticket/17849#comment:5
# detect changes in cat /sys/kernel/debug/ieee80211/phy0/ath9k/dfs_stats
# patches: support for revertXY
# smoketest: gen_html? from_logfile? runtime_array + always gen if array changes
# button: use $SEEN in [sec] or hackin SEEN_MS
# olsr: 1st neigh: force probing (for seeing a mac) for making perm: 10.63.40.193 dev wlan0 lladdr dc:9f:db:0c:ca:cc PROBE
# statusseite: SNR: anzeigen wenn longshot und es gibt nur einen nachbarn
# db_restore/db_lock -> kann ewig dauern -> adagio
# tool: messages: collect + mailsend before reboot + in longshot: show distance + e.g. 'no_longshot' ($HOSTNAME) in groups
# tarball-pmu: add possibility to download and install into ramdisc a .autorun (even if flash is full)
# ralf: add default-password for weblogin + autoenable VTUN
# longshot: test also HT40, when signal is better then 60dBm?
# longshot: test a row: e.g. rehungen: 237 -> 254 -> viel daten, forward aus
# longshot: test >5mb e.g. 50? - when maint_window()?
# den nachbarn fragen: alles i.o.? -> dhcp-reanimate -> leonardo
# ipsystem: add IPV6/weimarnetz
# netfilter: roaming support
# build: Small: disable station-mode? disable ap-mode? -> "CONFIG_PACKAGE_wpad-mini is not set"
# openwrt + kalua: rewrite: A=$(( A + 1 )) instead of A=$(( $A + 1 ))
# enhance syntax: '_wifi set apX 2ghz ssid ROAMING' - if X is set, then explicitely set the 2nd occurence
# olsrd_build_tables() nicht alle permanent-eintraege bleiben, ab und zu auffrischen?
# nutzen?: /lib/netifd/dhcp.script wird alle 15-30mins mit renew+setup_interface() aufgerufen
# fix RRD
# fix weekly report
# firmware: include default design (flags!)
# support for login = community (loginmask without username/pass) -> system.@weblogin[0].auth_credentials
# get rid of: /www/SOFTWARE_FULLY_INSTALLED
# implement: look for new firmware? = write openwrt-revision into info.txt
# portability: replace all calls of: echo -en / echo -n -> dash-problem -> use printf = builtin
# only running service after crash: tweak script?: udhcpc -p /var/run/udhcpc-eth0.2.pid -s /lib/netifd/dhcp.script -f -t 0 -i eth0.2 -r 10.10.6.25 -C
# do ROADMAP.md
# support PRIO in weblogin_auth_message (e.g. spbansin)
# email/phone/etc. in db()
# resarch: ACKs are send with double mcast_rate? 12 -> 24
# start writing tests for all functions, which can be run an a router
  - prevent injection local vars into functions: write a test
# db_restore_from_server() move from VDS to db()
# handle tap0 in build_tables() also fixed arp?
# mv /etc/kalua to /lib/xxx? and rework rc.common?
# inet_unstable on inet_offer: temp. remove && restart
	olsrd.@Hna4[1]=Hna4
	olsrd.@Hna4[1].netaddr=0.0.0.0
	olsrd.@Hna4[1].netmask=0.0.0.0

# debug ulogd2-startup LOGEMU
# implement: _wifi get device ifname 2ghz_1st_ap?
# strip kalua_init: log/measure time in wrapper = cleaner
# style: http://www.softpanorama.org/Scripting/Shellorama/Control_structures/comparison_operators.shtml - "we recommended remove dollar sign from all variables in  double round bracket comparison construct"
# time wget -O /dev/null http://guetersloh.freifunk.net/testfile-10M.img
# remove mybuild.sh - e.g. scripts/diffconfig.sh
# only write those to /www/NETFILTER_AUTOADD, which are not there yet
# longshot: mrate -> lowest basic rate? MCS0 vs 6000 - maybe MCS2?
# no pingcheck/dns/inet-check during longshot_test()
# fix wifi dhcp, if 2.4ghz is radio1 (wlan -> wlanRADIO1)
# abmelden von ror-clients, wenn es keinen dhcp-lease gibt -> liste klein halten
# any failed inet-action raises error-counter for seems_stable() (and vice versa) - e.g. 'killing hard' for 'wget'
# fix ffmpeg-mini
# pingcheck-stats to everlog/Mail + remove pingstat
# _wifi longshot
  - enforces RRD
  - auto-pingcheck?
# ilm1: [ "$MAC" = 'f8:d0:ac:47:fc:94' ] && return 0
# ilm1: [ "$MAC" = '7c:dd:90:43:1a:4d' ] && return 0
# monitoring: check if nexthop can be an IP if it is special
# patch: syslog "uci commit"
# before shutdown, try to determine max_txpower for each phy*/channel
  - (iwinfo needed) and store this, so we can have e.g. uci set txpower=35% 
  - use 'iw phy phy0 set antenna_gain 11' for fighting againt reghack-patch (which always shows 30 dBm)
  - cat /sys/kernel/debug/ieee80211/phy1/power
# fix fail2ban for portfw (boltenhagendh)
# fix net_ping6() -c1 does not work
# speedtest: during monitoring: offload to own function/script
# speedtest: https://github.com/sivel/speedtest-cli
# xoai: mydesign
# EJBW: 10er Netz darf nicht ins verwaltungsnetz
# kernel: overcommit? https://lists.openwrt.org/pipermail/openwrt-devel/2014-September/028004.html
# GIT: remove empty files and unused functions + remove all special 'case $CONFIG_PROFILE in' -> function-graph
# make patchset for weimarnetz for each function
# wifi_speed() -> measure new neigh without asking cron.check_inet? and rename to _net nexthop_speed()?
# ejbw: sed 's/^DNS_SERVERS=.*/DNS_SERVERS=172.17.0.1/' /etc/init.d/dnsmasq + HNA0/0 auf 100
# use ';' for separating vars in query_string instead of '&'
# detect route-change like pingchecker (refire every minute)
# detect missing cron-runs (last must not be older than 60 sec/uptime)
# ticket: procd startup-timeout?
# Sep 09 04:18:43 ' [up 533s 6123520 bytes free] /bin/sh [daemon.alert] system_reboot_safe() scheduling reboot - reason: 'wifi_watch_phy_restarts: no wifi clients, rebooting'
    # Tue Sep  9 04:19:13 CEST 2014 [OK] reboot reason: 'watchdog_disable'
# network: fewo: http://www.fewo-werbeagentur.de/images/phocagallery/ferienwohnung_logo_1000.jpg
# special_tweaks: leonardo-master
# solve: autoconnect/netfilter/wired neighs
# cgminer: usbreset 0403:6014 -> cgminer-api summary | fgrep '[MHS av] =>' | cut -d' ' -f7 | cut -d'.' -f1
# build: use: 'resolveip' instead of nslookup?
# build: support for alien-repo (bernd)
# olsr: NatThreshold 0.5 -> olsrd.@olsrd[0].NatThreshold=0.5
# sanitizer hostname in kalua_loader
# apply_profile: immer hybrid und selectiv an/aus (dynamic config) -> adhoc = ap off; ap = adhoc off
# apply_profile: ejbw: n43: lan_alias = nodenumber - lan_real = 192.168.0.1/24 + lan-dhcp_ignore=0 + start = 192.168.0.2 / limit = 253 + HNA: 192.168.0.0/24
# DB: when sending many mail, only backup once
# implement: show_path($IP) with all rx/tx-values / speed
# make sure, all radios are on (itze!)

# taskplanner: ohne sleep task alle X aufrufe ausfeuhren: /tmp/OLSR/ROUTE_COUNT -> cron.add_collected_userdata_into_db
# - calculate how often a task must be executed (e.g. every 42 mins)
# - and set marks in future: probe if these marks are reached -> execute and fetch next mark

# build: x86: laptop: echo "conservative" >/sys/devices/system/cpu/cpu0/cpufreq/scaling_governor 
# traffic_control_user_del: make sure wired devices are not deleted?
# who calls cron restart?
# QoS: fast cache for: _net speed gateway $IP <up|down> - can we simple 'change' speed of root-qdisc? achtung: tx muss nicht rx gateway sein!
# button-press: restart cron if needed
# button-press: diagnose senden wenn >5sec?
# SATA/hotplug:
# introduce ipsystem/THRUSTED_NET (fail2ban)
# sysupgrade cannot work, if full flash (moving S51* fails)
# activate/inactivate kmod: check for asterisk (*)
# generic_checker() lowercase must be local vars!
# check if we can use: $_ -> http://web.njit.edu/all_topics/Prog_Lang_Docs/html/ruby/variable.html
# build: http://wiki.openwrt.org/doc/howto/build
# why? [OK] first activity seen on dev wlan0 (0 packets) - marking
# support for HA (no nightly reboot) -> NAS (over_uptime + nightly reboot)
# maintain some packages: https://github.com/openwrt/packages/blob/master/CONTRIBUTING.md
# stop running cron/scripts during shutdown/STOP -> how to detect STOP?
# netfilter: user_add() mkdir /tmp/NETFILTER/USER/$mac - can be missed?
# build: usecase NAS: screen,samba-server,rtorrent,rsync,hdparm + hdidle + smart
#
# tc:
# http://lartc.org/howto/lartc.qdisc.filters.html
# http://lartc.org/howto/lartc.cookbook.ultimate-tc.html
# http://linux-ip.net/articles/hfsc.en/
# http://blog.plenz.com/2012-05/trying-the-codel-bufferbloat-solution-locally.html
# http://serverfault.com/questions/549755/how-can-i-limit-the-upload-download-bandwidth-on-my-centos-server
# https://gist.github.com/akrasic/7242498#file-limit-tc-sh
# default queue: mq: http://serverfault.com/questions/474230/linux-traffic-control-qdisc-mq
# http://linux.die.net/man/8/tc-prio
# http://mailman.ds9a.nl/pipermail/lartc/2003q3/009805.html
#
# make use of hwclock if available: set regulary and read during bootup -> https://www.ibr.cs.tu-bs.de/users/thuerman/time/quick.html
# gen dmesg.boot earlier in startup -> testcase = NAS@home
# check DNS-chain router -> inetoffer?
# profiling for boltenhagendh: which function is called most often / causes load
# rewrite all direct/local calls to cgi-bin-sql -> move into functions
# DNS-check in cgi-bin-sql? why?
# uci-switch for ignore high load ( 2 x cron.minu + 1 x scheduler_allow_run)
# audioplayer: iptables -I OUTPUT -p tcp --dport 80 (port from stream) and check if it raises, if not rekick
# when writing to /www (flash), always check if it fails: cron.check_switch is flapping when flash is full
# uhttpd: listen for IPv6 too: uhttpd.main.listen_http='80' + uhttpd.main.listen_https='443'
# cgi-bin-myinfo.sh:
# - ping to each HOP which is on traceroute
# - auto speedtest
# apply_profile: network/node = same? -> remember values: olsrd: LinkQualityMult
# intercept SSL? Loginpage: https://code.google.com/p/chromium/issues/detail?id=402071#c17
# mark "sysupgrade"-reason in crashreboot
# autorenew of https-cert
# adblock 1.1.0.0/20 -> 127.0.53.53? https://www.icann.org/news/announcement-2-2014-08-01-en
# switch:
# - wenn auf halfduplex abfaellt: reboot?
# - generell: warten ob default-route wegfaellt oder route-count dramatisch sinkt -> reboot
# - in case of an switch error, try: swconfig dev switch0 set apply 1
# maybe use: 'make image PROFILE=NBG6716'
# dhcp-script runs parallel - maybe offload via hotplug-event?
# sed-load boltenhagendh
#  - wer benutzt cgi-bin-sql.sh?
# backup-problem loesen (boltenhagendh): 4320 -> 432 8-)
# lr | grep "OLSR: sendto IPv4 Resource temporarily unavailable" | wc -l 	# = 118	-> reboot

# NETFILTER_AUTOADD: remove old entries, (wired!)
# db_backup() when it fails we have temp-files: /tmp/DB/USER/device/rows[a-zA-Z0-9]*
# audioplayer: mkfifo /dev/myfifo -> https://packages.debian.org/de/source/squeeze/buffer
#  commandB < /dev/myfifo &
#   commandA > /dev/myfifo
#    rm myfifo
# support ping-monitoring via '/bin/netmsg' (also for internal monitoring)
#  - iptables --insert INPUT -p udp --dport 53 \
#     -m string --from 40 --to 51 --algo bm --hex-string '|04706b7473046173696100|' \
#     -j DROP -m comment --comment "DROP DNS Q pkts.asia"
# or: http://www.stearns.org/doc/iptables-u32.current.html
#
# check: http://wiki.openwrt.org/doc/techref/ubus#access.to.ubus.over.http
# _netfilter_portforwarding_start() -> convert to userscript: /etc/firewall.user -> /tmp/firewall.user
# pass fuer sms-versenden (keine ip -> ejbw)
# immer ping (auf gateway? authserver? nexthop?) nach 'scheduler' wenn noch zeit bis zur naechsten runde, statistik fuehren
# howto: ("which neighbour relation seems important?") count traffic which comes FROM or goes TO a neigh (but src or dst is far away)
# db in eigener tmpfs ODER usb-stick
# check path: db_backup_error -> locked -> check()?
# igmp-snooping: https://dev.openwrt.org/ticket/13097#comment:2
# /usr/sbin/cron.add_collected_userdata_into_db: line 139: can't create /tmp/DB/USER/device/stats: nonexistent directory
# abstraction: is_enabled && ... (fuer init-skripte)
# olsr-slave: slave startet neu und master hat sein olsr aus: was dann? -> master muss schauen, ob sein slave noch da ist -> wenn slave, dann?
# switch: buffalo WHR54HP
# switch: 741nd v2
# use the cool wifi-helpers in override() for e.g. _wifi_change_essid_ap()
# wget returncode = 1 on http status code 201 :: https://dev.openwrt.org/ticket/16885 -> testcase registrator
# private monitoring on every node during build_tables() = passiv monitoring (lookout HNA's/nodes/mid's)
# fix report_weekly
# log() use special var instead of $0 maybe introduce include()? - see sourcing of /usr/sbin/cron.registrator_client.sh
# tc: prio for OLSR
  - http://mailman.ds9a.nl/pipermail/lartc/2006q1/017871.html
  - http://ff-firmware.cvs.sourceforge.net/viewvc/ff-firmware/ff-devel/freifunk-olsrd/etc/init.d/S90olsr-prio?revision=1.6&view=markup
  - https://github.com/weimarnetz/weimarnetz/issues/34
### remove old /tmp/vds*
# ejbw: force WAN olsr on 50
# checkout wifi-greenfield: https://dev.openwrt.org/ticket/16667#comment:6 https://dev.openwrt.org/ticket/16667#comment:8
# implement PPP-Max-Payload: https://dev.openwrt.org/ticket/16805 + https://forum.openwrt.org/viewtopic.php?id=51326
# remove db_lock when crond-lock/scheduler-log is removed
# OLSR-prio: https://github.com/zioproto/fairvpn/wiki/ShapingNotes
# einspeiser muss propagieren, das internet ausgefallen ist (satama!)
# beacon-rate bei longshot-adhoc?
# wenn bei user_add() festgestellt wird, mac gibt es schon: abmelden und neu anmelden. wenn IP = 169.254.216.113 -> sonderbehandlung
# usb-power off: 703n: echo 0 >/sys/class/gpio/gpio8/value
# set custom X-HTTP header for weblogin output
# alle 'case $CONFIG_PROFILE in' nach override_uci_vars

# solve dhcp-with-many-IP's to the same client-issue: http://lists.thekelleys.org.uk/pipermail/dnsmasq-discuss/2011q2/005041.html
root@EG-steinmetzBuero:~ ip neigh | grep 00:23:8b:a5:18:dc
fe80::b17f:c521:1487:d871 dev eth0.1 lladdr 00:23:8b:a5:18:dc STALE
10.63.11.113 dev eth0.1 lladdr 00:23:8b:a5:18:dc STALE
10.63.11.112 dev eth0.1 lladdr 00:23:8b:a5:18:dc STALE
10.63.11.111 dev eth0.1 lladdr 00:23:8b:a5:18:dc STALE
169.254.216.113 dev eth0.1 lladdr 00:23:8b:a5:18:dc STALE

#
#
# olsr-status: show SNR for missing nodes
# remove HT40- or HT40+ calls
# refresh hotplug_without_exit-patches
# rework khubd-blocked-detector (why?)
# how to avoid: user_add() when user is a router? -> olsr_fixed_arp?
# everywhere: use 'grep -m1' instead of 'grep bla | head -n1' (check which commit enabled this option)
# enforce wifi-speedtest via linklocal IPv6 = forbid route switching -> needs fixed wget
# switch: check all supported models and remove legacy code
# lizst28: when etx_ff, remove 'Mode ether/mesh'
# status.sh: raus/rein: broadcast/echter datenverkehr trennen
# is it portable? echo $((try++))
# loader: can we use $@ = quoted $* instead of $1 $2 $n?
# nightly_reboot wenn eigentlich overup?
# include sorttable.js -> google_closure -> CrunchMe = http://www.bitsnbites.eu/?p=112 -> pngout = http://advsys.net/ken/utils.htm -> 2.8k
# status.sh: ip->32bit int for sorting
# status.sh: highlight each 2nd row with CSS and same for numbering first row
### report to sql: >X gig-users
### satama/fparkssee/marinapark: SSID=wartung, wenn einpseiser fehlt
### sehr oft index_gen?
### - always 'read' = 'read -r'? http://pubs.opengroup.org/onlinepubs/9699919799/utilities/read.html#tag_20_109
# build: support for Davicom DM9601 USB Ethernet
# - 0fe6:9700 Kontron (Industrial Computer Source / ICS Advent) DM9601 Fast Ethernet Adapter
# = dm9601,cdc_ether + usbnet
# = DEFAULT_kmod-usb-net-dm9601-ether
### - switch: kueche/UFO: TP-LINK TL-WR841N/ND v7
# - check each function during scheduler_run/debug-mode with: set | grep ^[a-z]
### watch coredump: only restart daemons ONCE + show all dumps first
# usb2ethernet: LogiLink: 9710:7830 MosChip Semiconductor MCS7830 10/100 Mbps Ethernet adapter
# rb532: ath5k: http://patchwork.linux-mips.org/patch/4087/
# 148f:3070 Ralink Technology, Corp. RT2870/RT3070 Wireless Adapter -> dodge/garage = Intellinet wireless 150N usb-adapter rev. 3.04
###### instead of use 'test -e ' -> ls -1 "/var/www/networks/gnm/settings/"*.jpg 2>/dev/null >/dev/null
### join: _net_ip_reachable + _netfilter_reachable()
### via netcat: https://github.com/weimarnetz/openwifimap-api/blob/master/API.md
### schoeneck: etiketten/format
### generic: max,min,avg,leaving_border and use for: mcast-rate, routes-counter etc.
# remove all calls of 'exit'
# kalua-parser fails if:  grep ' # mac: ' $file (dont cut off '#' when not a comment)
# LANADR is NOT always there, e.g. meshcube + no wire -> error during deepcheck of webserver -> use new var 'force_link' from r40456
  - uci set network.lan.force_link=1
# build-server: export HOSTNAME
# - coredump: udhcpc -> ifup wan, when dhcp
# - 192.168.$NODENUMBER.x = $ROAMING_IP		-> 172.16.0.0/14 = 172.16.0.1 ... 172.19.255.254
# - firmware-update: dont delete /tmp/.uci
# - no uci_commit during new_user()@GUI
# monitoring: show red if pubkey not thrusted
### iface_ifdown() cron hangs, restarting 3mins before reboot
### $count in coredump wird falsch gezaehlt
### add olsr-watchdog-plugin to cron.minutely?
# - userdb: einmaltickets -> automatisches eintragen der mac
# - new dyndns or: '$IP bwireless.mooo.com' in '/etc/local.hosts' + update -> eigener dyndns-dienst: haus12.spbansin.intercity-vpn.de
# - switch_show() defekter switch node12? -> retry nur wenn es schonmal ging
# - ueberlange moni-meldungen mit minimal-heartbeat abschliessen oder keine OK speichern
# - olsr-control counter: do i send out myself?
# - count traffic in same network? e.g. NAS<->MEDION
### - amalienhof: strange situation2: olsr-nexthop != routing-table nexthop: 10.10.80.1/172.20.1.1
### - amalienhof: wireless.@wifi-iface[0].encryption=psk2 wireless.@wifi-iface[0].key=31122014
### - move hotplug-wan-security to netfilter
### - move IP/WAN-stuff into private /tmp/apply_
### - /tmp/user_vdsOK - only accept if not older than X? (against nodes with long uptime)
# - http://twitter.com/#!/Rehungen ?
# - make usage of 'connlimit'?
# - 'pidof dnsmasq' shows also pid of 'fakedns'
# - make sure rrd-update makes no spikes?
### - ejbw: fremd-sms nicht mit "WLAN-SYSTEM" verschicken
# - cupandcoffee: sms-mode aktivieren?
### - Feb 25 04:10:11 ' [up 86191s 3776512 bytes free] /etc/dhcp-script.d/10dhcpscript [daemon.alert] watch_cron() cron died, restarting
# - rework 4900er lan-MAC: https://dev.openwrt.org/ticket/14714#comment:5
### - GeraetX ping der reihenfolge nach immer wieder alle durch, fuer _schnelleres_ monitoring.
      - extra cronjob
      - direkte meldung an monitoring-server
      - evtl. auch ICMP-filewall-dings dann muss es kein extra cronjob sein sondern man schaut nur was ausbleibt.
      - am besten das geraet, wo auch sql/ticket-meldungen hingehen? -> anlegen der ICMP-regeln nach IP
      - Ziel: Monitoring soll schneller Rot zeigen
      - jeder node muss notfallanweisung bereitstellen: e.g. nachbar muss sich mit IP xy verbinden und Z ausfuehren (e.g. wget)
      - was ist wenn MONITORING-node neustartet? Anweisungs/IP-liste muss erhalten bleiben
      - aus abhängigkeitsliste kann auch gleich updateliste erstellt werden.
#
# apply_profile: ejbw50/master: allow WAN-olsr
# apply_profile: community.XY
#
# - ibfleesensee:
#   - tweak dnsmasq-hotplug
#   - disable kmodules: ip6tables + ppp + ulog + usbcommon/core + ath9k
#   - vlan-doku: z111=105, z206=198:ZG3/7, z315=125:EG3/17, z411=220:ZG1/11, z512=152:2OG1/12, z442=150, z542=183
# - reboot_nightly und inet tot? -> speichern und gleich wieder SSID wechseln nach boot
### nexthop regelmaessig bauen/minimoni (fuer batman auch?)
### monitoring: exit wegen [ -z $WIFIDEV ] ?
# - new_build:
#   - add info.txt what means e.g. Standard
#   - add info.txt about buildtime for hole build + each target?
# - shaping: $i + $j -> classid_down/up
# - dont send 'realcrash' to master, if 'watchdog' was the reason
# - reboot/crash ankuendigen durch netmsg $LAN - damit umliegende keinen 'switch_error' werfen
# - crashreboot for: scheduling reboot - reason: 'wifi_watch_phy_restarts: no wifi clients, rebooting'
# - inet_seems_stable() check real internet from time to time too
# - pingplotter in cron.minutely or RRD
#   - DSLer: ping ins internet
#   - ansonsten "ping -c1" auf nexthop. wenn latenz hoch, ping -c 10 + durchschnitt
# - monitoring: rebootknopf?
# - after DMA erro: cat /sys/kernel/debug/ieee80211/phy*/ath9k/interrupt - https://dev.openwrt.org/ticket/11862#comment:187
# - disable 5ghz on non-batman nodes, till we fix ip-system/dhcp
#
# - watch_lowmem_freemem() if simplemesh, keep everything up till hna-slave was there
# - lowmem: only end netifd/ubus after recent uptime/when hna4-slave-question was
#
# - enable wlan-dhcp + enable on correct interface e.g. wlanRADIO1 (former batman-node)
# - check all 'set -- ' if there is globbing involved, maybe do set -f; set -- $bla; set +f
# - count 'events' and show this number in monitoring (e.g. all 'alerts'?)
# - global VAR for $STORAGE_DIR on flash, e.g. STORAGE_DIR='/www'
# - own history for reboot + switch
# - update_pmu/brcm47xx?
# - check all rcS-tasks for 15sec length -> $SCHEDULER  and remove anti-hang-hacks with rTODAY
# - portfw doesnt go through shaping?
# - mail_resend: nen haufen leichen... readable? -> r99 -> netfilter copy over own pub-ip
# - webcam: motion: snapshot always 60 sec, but upload dont use if there was an event and when no event, adjust according to event-action
# - webcam: store event.log + upload
# - server/monitoring: support for 'autohide' (lisztwe)
# - liszt28: echo 2 >/sys/kernel/debug/mips/unaligned_action
# - splash: check error-code: 511?
# - batman: raise MTU on adhoc - 1560?
# - batman-gwl: dynamic lease, renew every X mins -> dnsmasq reload
# - inet_seems_stable auf inet_offer schlaegt X mal fehl, irgendwie nodes in wartungsmodus versetzen
# - http/ssl-certs: gueltigkeit! -> immer neu generieren?
# - warum kann es mehrere scp-prozesse geben?
# - get shaping/speed from ticket
# - webcam: better sort: img_889.ffmpeg.jpg -> img_88.ffmpeg.jpg
# - if planned overload: fire watch_monitoring()
# - boltenhagendh: stopwatch_stop(): task 'index_gen' lasts 5677.82 seconds (1h 34min 37sec) - wirklich 5 uhr starten? -> besser 2uhr
# - lockfile-remove: show last job which was invoked
# - update_pmu: no_space_left -> watch_flash + prozentanzeige des verlaufs + alphabetische reihenfolge?
# - kein SCP wenn schon scp laeuft/haengt
# - r2: empaengt noch, aber sendet nicht mehr. olsr-check. irgendwie automatisch -> groesse der routentabelle loggen
# - rrd_show wirklich alle 15min?
# - solve scheduler prob: A="logger 'hallo'"; $A -> the call will be: logger "'hallo'"
# - https://bbs.archlinux.org/viewtopic.php?pid=1168667 -> nf_conntrack: automatic helper assignment is deprecated and it will be removed soon.
# - crashdump: disable on lowmem-devices -> otherwise oom happens during crashdump-output
# - crashdump: store in "small" tmpfs, otherwise simultanious crashs can eat up too much mem
# - log pppoe-con losts/downtime via dyndns-hotplug
# - kein firmware-update wenn vor ca. 24h ein neustart war (zeitschaltuhr)
# - dhcp-old -> SCHEDULER
# - taskplanner: dont run every minute, only when low load but build a todo-time-file
# - batman: check if dhcp-users are logged in, if not: splash
# - detect ubusd pid-change
# - wenn 192.168.0.61 -> 192.168.222.1 -> 192.168.76.1 -> olsr-netz, dann nat oder HNA
# - taskplanner: die meisten entscheidungen koennen bei cron.startup getroffen werden
# - taskplanner: include into cron-ram-copy + kein loader mehr noetig
# - 1043nd: watchdog: https://dev.openwrt.org/ticket/12121
# - ping IC: remeber last and only ping once round-robin + use: -W 3?
# - remove 'sleep 30' from netfilter-startup -> hotplug
# - hangs: rmmod xt_tcpudp + rmmod xt_CT + iptable_raw + ipv6
# - WTF: warn netifd: You have delegated IPv6-prefixes but haven't assigned them to any interface. Did you forget to set option ip6assign on your lan-interfaces?
# - do something against stack-corruption/overflow:
#   - http://stackoverflow.com/questions/11861762/stack-corruption-in-c
#   - http://stackoverflow.com/questions/1258550/why-should-you-use-strncpy-instead-of-strcpy
# - logger: send ALL alerts to central server, e.g. crashs
# - cron = procd-service
# - scp_do()
# - coredump: autoupload/remove
# - reboot_safe() fix REASON and fix autorun-call
# - db_backup() calc size needed?
# - cron.check_inet_gw: dont accept "# ignore localhost", when not inet-offer
# - really disable batman if not needed (remove aliases too + changed macs)
# - askconsole: activate when not LOWMEM
# - pmu() too often?
# - check: endlich insmod mit parametern?
# - monitoring: show 'error watch_dns_resolution' -> IFA126
# - schoeneck: 126 = '3e:75:11:b1:02:61'?
#   root@HausA-KellerZimmerEDV:~ batctl tr 192.168.126.1
#   traceroute to 192.168.126.1 (3e:75:11:b1:02:61), 50 hops max, 20 byte packets
# - mailstash = alert?
# - zram via hotplug?: Fri Jan  3 11:34:11 UTC 2014 1: block ACTION: add DEVPATH: /devices/virtual/block/zram0 INTERFACE:  DEVICE:
# - hotplug: cron running?: simple check if cron.minutely was active?
#   - pidof S51crond_fff+  (can hang)
#   - in /sbin/hotplug-call:
#     - echo "$(date) 1: $1 ACTION: $ACTION DEVPATH: $DEVPATH INTERFACE: $INTERFACE DEVICE: $DEVICE" >/dev/console
#     - echo "$(date) 1: $1 ACTION: $ACTION DEVPATH: $DEVPATH INTERFACE: $INTERFACE DEVICE: $DEVICE" >>/tmp/HOTPLUG
#   - in /lib/netifd/dhcpv6.script
#     - echo "$(date) 1: $1 2: $2 3: $3" >>/tmp/LOG
#   - dyndns: ACTION=ifup INTERFACE=wan DEVICE=pppoe-wan $1 = 'iface'
# wget-loop firmware: _watch pppoe/dns in each cycle
#
#
# make use of: ubus call network.device status (we have now: ubus call network.interface.lan status)
# - Link auf interne Ticket-DB vom Rezeptionsrechner: portfw
# batctl trace -> to each laptop from master during assoc
#
# build: all kalua-tweaks via subcall
# DIR300: swconfig eth0: 4 gap 3 2 1 0
# dnsmasq: force interface: DNSMASQ_INTERFACE is wrong on 222: lan -> wlan1-1
# batman: BLA - only activate when needed, it makes extra traffic
# marinapark: HNA/MP-dsler: missing? -> wartungsmodus
# make use of moni-wiredneighs for sorting (grouping real partners)
# radioX disabled? name SSID = off
# profiling for each function via switch?
# speedtest upload via backquestion
# _log view 2h
# viele reboots? -> disable wireless at bootup
# detect bitcoind-traffic
# no internet? bit firmware-upgrade needs hash-download, even when /tmp/fw exists
# OLSR-LAN-strange: 	iptables -I INPUT -p udp --dport 698 -i $LANDEV ! -s $LANADR
#			iptables -nxvL INPUT;sleep 60;iptables -nxvL INPUT
#			-> strange = e.g.: 37 ... 22 ... 20 packets/min
#			-> good =    e.g.: 350 ... 340 ... 353 packets/min	# hotello-B01
#
# build:
# bastian: kalua/openwrt-build/build.sh: apply_symbol() ERROR during 'git am'
# previous rebase directory /home/bastian/openwrt/.git/rebase-apply still exists but mbox given.
# laptops: batctl transglobal | while read line; do set -- $line; echo $2; done | sort | uniq | wc -l
# tool: show traffic/tc from a single mac
# make mysleep() with internal command : -> use it when critical

# teredo? http://www.heise.de/newsticker/meldung/AVM-aktualisiert-Fritz-Box-7490-Firmware-kleiner-Rueckschritt-inbegriffen-2060590.html
# -> miredo!

# idee: youtube ueber tunnel:
# https://forum.openwrt.org/viewtopic.php?pid=207497#p207497


# dyndns:
# /etc/hotplug.d/iface/99-ifup-wan
# ACTION=ifup + INTERFACE=wan ? -> dyndns

# Tue Dec  3 10:04:06 2013 daemon.notice netifd: cfg114d8f (25410): ./batadv.sh: eval: line 1: can't create /sys/class/net/pppoe-wan/batman_adv/mesh_iface: nonexistent directory
# -> no batman-WAN, if pppoe or DHCP

# sleep for reboots with real builtins?
# http://stackoverflow.com/questions/3224878/what-is-the-purpose-of-the-colon-gnu-bash-builtin

# idee: vermeiden von neustart/switch_check: vorher abmelden bei nachbarn


# idea for kalua-global-vars:
# OPENWRT_REVISION='12345'

# idee:
# opkg install kmod-ipt-filter iptables-mod-filter
# iptables -A INPUT   -p udp --dport 53 -m string --algo bm --string "facebook.com"


# ping6 in busybox lack '-L' so it returns loopback: ping6 -c 1 ff02::1%${LANDEV:-eth0}
# also: -p payload: http://superuser.com/questions/569445/which-ping-sends-icmp-echo-as-payload
# timestamp: http://sd.wareonearth.com/~phil/net/ping/

# install htop?

# traffic erst ab X mb shapen: traffic_control_autoapply_speedsuggest()

# iptables -I FORWARD -m ttl --ttl-eq 1

# cgminer: rrd: cgminer-api stats | grep -i temp -> temp1 + temp2 + Vcc1 + Vcc2 + Vmain + Speed + HW-errors

# _log do Ausfall daemon sms "J4-Lueftungskeller-T11 (auf Serverschrank) neustarten"

# research: http://hack-it.org/index.php?title=Mdk3
# MDK is a proof-of-concept tool to exploit common IEEE 802.11 protocol weaknesses.


# disable/enable kmodules, if not needed / needed:
# - ppp
# - wifi
# - batman
# - netfilter

# liszt28:
# check if on *_ap all wifi-clients are in 'batctl translocal'


# 4900er: flash_size incorrect


# new build:
# timer 'prepare'
# timer 'make'

# shell: for octet in ${mac//[\.:-]/ }
# shell: octet="${octet:0:2} ${octet:2:2}"

# idee:
# failsafe via net aktivieren:
# patch failsafe: ping 6.6.6.6? -> ja + meldung
# patch: package/base-files/files/lib/preinit/30_failsafe_wait


# pruefen:
# gegen netrate_ratelimit:
# https://lists.openwrt.org/pipermail/openwrt-devel/2013-November/022559.html
# net.ipv4.tcp_max_syn_backlog = 2048                                                                                                                          # net.ipv4.tcp_synack_retries = 3    

# tuberlin:
# config httpsproxy                 
#        option enabled 1       
#        option ipaddr  auto     # auto = first LAN-DHCP-lease | <ipaddress> OR via FORM_DATA
# cookie support?

# apply_profile:
# - ejbw: WAN+LAN-Olsr auf Einspeiser
# - ejbw: RF bssid?


# pruefen: https://github.com/schuza/openvswitch + http://openvswitch.org/

# konzept: pingtest/watchdog fuer netio230b selber implementieren und per netcat port-reset ausloesen
# - gnm + dhsylt + frenzel + schoeneck
# http://wiki.linuxonlinehelp.de/index.php/Netio-230b
# - ping auf station X, raise counter till Y
# - action = netcat ...
# - 3 werte:
# geht nur, wenn 2 geraete an steckdose sind...


# liszt28: 5ghz: mcast = 1.000 ???

# problem loesen das im monitoring manchmal richtige und manchmal batman-mac steht

# detect non-working scp to monitoring-server and show in monitoring + dont try again?

# interesting batman/dnsmasq-trick: http://lists.thekelleys.org.uk/pipermail/dnsmasq-discuss/2013q4/007750.html

# http://stackoverflow.com/questions/15372011/configuring-arp-age-timeout
# make use of '/proc/sys/net/ipv4/neigh/eth0.2/gc_stale_time' ?

# LOWMEM: erst in S95done wird '/tmp/CRON_IS_CAREFUL' sichtbar gemacht

# apply_profile.code kann auf /tmp/loader aufbauen

# use ulogd2 / ulogd_output_OPRINT.sh : http://kangran.su/~nnz/pub/nf-doc/ulogd2/i
# or ulogd_output_SQLITE3.so

# LOWMEM:
# - no dhcp on WAN, when apply_profile exists
# - no ntp(d) , when apply_profile exists / /etc/init.d/sysntpd
# - no sleep 300 in S70prep , when apply_profile exists
# - no S69 when apply_profile exists
# - no 6relayd , when apply_profile exists
# - cron.konzept ueberdenken
# - webserver beenden/dropbear starten wenn 'fresh' ohne profile-definitionen
# - wenn nicht fresh, wifi down
# - 15min-cronjob: uhttpd stop

# fix missing "wan/inet-offer" mode in monitoring

# maybe: monitoring: send /proc/net/dev -> rx/tx bytes/packets -> rewrite wifi_tx_and_rx()
# maybe: batman-trace/nextIF: debug-output, e.g. debug="LAN= WAN=$WANDEV was: $nexthop-dev"

# db: nach aufräumen 'eval' test jeder zeile

# rewrite cron-startup

# reverse_ssh-tunnel: make it forceable even without inet-offer (b01/4)

# ubus call network.device status '{ "name": "anygw" }'

# audioplayer: check somehow if '/dev/dsp' is used (hanging wget/madplay)

# build: support for including all mypackages* for specific network

# why 2 empty lines at top of cron.minutely?

# firmware_wget() -> respect bigbrother/usbaudio

# netfilter: check_deps()

# better locking: http://wiki.bash-hackers.org/howto/mutex
# mkdir /var/lock/mytask || exit 1
# rm -R /var/lock/mytask

# rrd: ping/latency to nexthop:
# - ping -c 60 $IP
# - 60 packets transmitted, 60 packets received, 0% packet loss
# - round-trip min/avg/max = 2.314/27.849/390.571 ms
# draw: loss/avg/max/metric?

# rrd: forks (each time cron.minutely is called $$)
# rrd: respect phy/phy1/phy2 in one graph - just "change" nulllinie + opaque colors?
# rrd: gateway-node: fat line, change color for each GW, show GWs in legend
# rrd: include add() into CRON_IS_CAREFUL and use the rest via kalua
# rrd: add total-counters: CDEF:ds0total=ds0,$(uptime_sec),*    +    GPRINT:ds0total:AVERAGE:"Total\:%lf"
# rrd: repair no_forward
# rrd: wc -l /tmp/OLSR/ROUTING_TABLE_MAIN *** oder *** batctl originators | wc -l
# rrd: longshot-faker/enforcer for nexthop (dhsylt|rehungen_feld)
# rrd: load: when >1.00 ONLY rrd_load, all other values dont set/collect (um wirklich LOAD zu sehen)
# rrd: longshot/all-mode: show in legend and show rx/tx OR wifi2lan OR lan2lan
# rrd:
#   - bei setup() datei X anlegen.
#   - die ersten 30 mal '#' nach X appenden.
#   - solange X existiert wird default_gw bestimmt.
#   - wenn defgw = wifi, dann 'MAC' bestimmen
#   - von dieser MAC rx/tx plotten
#   - wenn sich MAC nicht aendert, wird /tmp/RRD_MAC geschrieben (und weiterhin genommen)
# longshot-detector: only when first 30mins = longshot -> maybe if wifi-gateway = fix? (f36dach -> schreibtisch)


# USERDB-copy download von node der es nicht hat? -> kein OK, aber was anderes...

# hohe load? rm /tmp/USERDB*.gz ? oder einfach loeschen wenn es ne weile nicht angefasst wurde

# test: b0rken inet -> change essid in batman-mode: it works!? -> deactivate reboot

# reboot-detector: in own file /www/REBOOTS ? und bei year = 1970 beim ersten ntp in diesem file korrigieren

# pubssh.ipk -> auf batman ip's rein 192.168.x.1

# beim abliefern von cron.add-user... kommandos uebergeben? bequemes ausfuehren von befehlen auf allen routern?

# debug high load on r99: http://stackoverflow.com/questions/10846747/origin-of-a-kworker-thread

# git grep reboot_safe -> ordentliche reasons eintragen

# cron: crashreboot.file jede minute schreiben und ausfuehren mit 'reason=bla; . /tmp/CRASHREBOOT'

# check: http://rooter.kyberian.net/tag/adhoc/

# USERDB: support for shorthash (first 8 bytes?): db_hash() echo -n "bla" | md5sum | cut -b1-8

# check: shaper: http://openwrt.pl/doku.php/zastosowania:pasmo

# mail: ticket-tar: besserer name + nicht in /tmp

# high-load? wifi down! -> immernoch? reboot, sonst wifi up

# speedtest/testdownload zu jedem neuen gateway

# die 3 haeufigsten Gateways im monitoring zeigen (prozentualer anteil)

# patch: procd: show module-loading on /dev/console
# patch: procd: minicron

# ejbw: 100: lan_masq needed?

# instead grep JSON: . /usr/share/libubox/jshn.sh; json_load "$(devstatus $WANDEV)"; json_get_var var1 speed; echo $var1

# add macvlan via netifd: http://nbd.name/gitweb.cgi?p=luci2/netifd.git;a=commitdiff;h=5dd87fd8ad3a42c71d90a8fecc893af973e552bf;hp=9585227f1141d9da5a3186df5e10c4521e65083e


# debug in cron.minutley:
# high load? maye loop for more console output?

# build a kernel with 'CONFIG_PERF_EVENTS=y' and use 'perf top'

# bat-tr: node(weblogin_authserver)->192.168.$node.1

# USERDB-copy: from nexthop

# scp: test auf monitoring-server bei _watch_random_node_id()/registrator?

# pruefen:
# root@liszt28-hybrid--222:~ _net ip2dev 192.168.222.61
# br-mybridge
# root@liszt28-hybrid--222:~ ip n|fgrep 192.168.222.61
# 192.168.222.61 dev br-mybridge lladdr 00:21:6a:32:7c:1c PERMANENT
# 192.168.222.61 dev gateway0 lladdr 00:21:6a:32:7c:1c PERMANENT



# cisco-esque

# memtest:
# keine pruefung, wenn crash - ausser bei speziellem crash: nur welcher? (sysrq wird auch bei ALERT benutzt/gebraucht)
# -> "neightly_reboot_crash"
# ungeplanter reboot? -> kein netfilter (ausser NAT wenn inet_offer)

# find a way to check for patched regdb, maybe klog?
# see: apply_profile.code

# check:
# monitors the netfilter conntrack table to help tune the max limit one needs to set:
# https://github.com/QueuingKoala/wrt-nflog
# https://github.com/QueuingKoala/wrt-iptables

# batman: revert change for 'batctl if':
# scp root@intercity-vpn.de:/var/www/files/openwrt/0001-batman-adv-avoid-openwrt_metadata_stripping feeds/routing/batman-adv/patches
# eigentlich:
# cd feeds/routing
# git revert a8e21bf882e1815023b224081843248030f1ad18


# only signal dnsmasq, if something relevant has changed

# git checkout -b feature_abc

# random:
# dd if=/dev/urandom count=1 2> /dev/null | md5sum
# grep -m1 -ao '[0-9]' /dev/urandom
# grep -m1 -ao '[0-1][0-2][0-9]' /dev/urandom

# wificheck: rrd
# wificheck: border muss abhängig sein von avg. bei 20 frames/sec sind 50% was anderes als bei 200 f/s
# wificheck: avg_p_change > border? ...ping 1 or 2 neighs, of not possible: wifi_restart?
# wificheck: max und min festhalten

# wget() convert pause = pause between no data is transfered?

# parse version2date from: https://www.kernel.org/pub/linux/kernel/v3.x/
# http://landley.net/writing/git-bisect-howto.html


# ticketmails: hinweis auf NICHT antworten und ReplyTo: correct setzen?

# URL_PATCH="http://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/patch/?id=9c9b415c50bc298ac61412dff856eae2f54889ee"
# URL_PATCH="http://www.intercity-vpn.de/files/openwrt/memtest.patch"
# wget -O target/linux/ar71xx/patches-3.10/$NAME.patch
# make V=99 target/linux/{clean,compile}; make

# olsr-packets on LAN, but no neigh? restart daemon

# rrd: better way for check: longshot? -> if not, hide line

# /www/mybestneigh anlegen und uhrzeit von dort stellen
# wenn reboot NICHT geplant war, logging (kein crash, kein nightly reboot, kein safe_reboot)
# wenn reboot NICHT geplant war: netfilter off?

# reserving runtime for longrunning tasks must include a max (count down)

# ssh-key.ipk
# optimize
# add batman-ips

# batman-adv:
# parse "station dump" and "batctl o" for neigh-list and gateway...
# nexthop?

# monitoring/doku: energieverbrauch errechnen?

# batman/openwrt-fix (module-optimization)

# add wifi and ethernet-performance
# http://wiki.openwrt.org/doc/howto/performance


# mkmime:
CONFIG_BUSYBOX_CONFIG_MAKEMIME=y
CONFIG_BUSYBOX_CONFIG_FEATURE_MIME_CHARSET="n"


# support for http://wireless.kernel.org/en/users/Documentation/acs

# flash 1043nd:
# erase 0xbf020000 +7c0000; tftpboot 0x81000000 code.bin; cp.b 0x81000000 0xbf020000 0x7c0000; bootm 0xbf020000

# batman: gateway muss immer selber adresse sein, aber es muss eine art metric geben wie die gleiche adresse NOCH liegt?
# also: was passiert bei reboot: es soll weitergehen. das geht nur wenn GW auch erreichbar ist...

# automatically collect bootloader-hashs of 1043nd

# screen: backlog: safe scrollbackbuffer to file: CTRL-A : hardcopy -h <filename>
# screen: backlog: raise scrollbackbuffer size:   CTRL-A : scrollback 10000 <enter>

# memtest:
# http://lkml.indiana.edu/hypermail/linux/kernel/1211.1/00711.html
# https://lkml.org/lkml/2012/11/9/129
#
# memtest early clock:
# http://lists.linaro.org/pipermail/linaro-dev/2013-August/016542.html
# http://lwn.net/Articles/460432/

# HTB: quantum of class 10001 is big. Consider r2q change.
# http://www.linksysinfo.org/index.php?threads/tomato-mod-1-20-8000.26621/page-3#post-125507

# network.mybridge.netmask_dhcpcalc -> muss zu dhcp

# update-reihenfolge anhand hopcount festlegen

# cupandcoffee: profile anlegen / flashen

# olympia: fwupdate + roaming

# use wifi-watchdog:
# /sys/kernel/debug/ieee80211/phy0/statistics/multicast_received_frame_count

# If you are running out of memory (which I suspect you are) the following 3 lines in /etc/sysctl.conf will probably help to prevent that.
# vm.vfs_cache_pressure=1000
# vm.min_free_kbytes=4099
# vm.swappiness=0


# lowmem: nocron_during_client_action: at least send minimal-monitoring
# maybe same abstraction like routers which needs "proof of work" (too much reboots)


# detect suddenly lost auf neighs:
# best would be: average olsr-packets/interval on each interface:
# log/action: if something goes crazy

root@HausA-Wintergarten-MESH:~ n
Table: Links
Local IP        Remote IP       Hyst.   LQ      NLQ     Cost
10.10.211.1     10.10.132.1     0.00    0.897   0.646   1.721   
10.10.211.1     10.10.234.1     0.00    1.000   0.948   1.054   
10.10.211.1     10.10.143.1     0.00    0.948   0.815   1.291   
10.10.211.1     10.10.138.1     0.00    0.901   0.952   1.163   
10.10.211.1     10.10.147.1     0.00    0.948   0.808   1.304   
10.10.211.1     10.10.153.1     0.00    0.854   0.815   1.434   
10.10.211.1     10.10.210.1     0.00    0.948   0.497   2.115   
10.10.211.1     10.10.157.1     0.00    0.765   0.866   1.509   
10.10.211.1     10.10.140.1     0.00    0.701   0.780   1.825   
10.10.211.1     10.10.136.1     0.00    0.736   0.862   1.571   
10.10.211.1     10.10.134.1     0.00    0.619   0.909   1.773   

root@HausA-Wintergarten-MESH:~ n
Table: Links
Local IP        Remote IP       Hyst.   LQ      NLQ     Cost
10.10.211.1     10.10.132.1     0.00    0.000   0.446   INFINITE
10.10.211.1     10.10.153.1     0.00    0.000   0.713   INFINITE
10.10.211.1     10.10.134.1     0.00    0.000   0.909   INFINITE
10.10.211.1     10.10.136.1     0.00    0.000   0.808   INFINITE
10.10.211.1     10.10.143.1     0.00    0.000   0.646   INFINITE
10.10.211.1     10.10.234.1     0.00    1.000   1.000   1.000
10.10.211.1     10.10.157.1     0.00    0.121   0.815   10.084
10.10.211.1     10.10.140.1     0.00    0.000   0.713   INFINITE
10.10.211.1     10.10.147.1     0.00    0.000   0.748   INFINITE
10.10.211.1     10.10.210.1     0.00    0.000   0.329   INFINITE
10.10.211.1     10.10.138.1     0.00    0.000   0.847   INFINITE
10.10.211.1     10.10.145.1     0.00    0.000   0.000   INFINITE

-> lots of 'ath: phy0: Failed to stop TX DMA'



# alle flash-schreiboperationen sperrbar machen: global var: $STORAGE = /www/storage or /tmp/storage

# scp: immer absichern gegen haenger -> cron.webcam

# proof of work: zielmarke 1h update, 2h...4h...12h...dann erst "wifi on"
# bei unerwartetem reboot: erneut
# CONFIG_PROGILE: *_ap + reboots > X -> disabled wifi 

# make target_install -> rebuild images from the customized filesystem
# http://downloads.openwrt.org/docs/buildroot-documentation.html#custom_targetfs

# mon-server: automatically write OFF/Restart-history fuer every router?

# cupandcoffee

# BATMAN in hole net: disabled olsr + touch /tmp/service_olsrd_nowatching

# UPGRADE:
# busybox: package/utils/busybox/Makefile -> 1.21.1 -> 795394f83903b5eec6567d51eebb417e

# _switch() own history-file

# [ -n "$BATMAN" ] && ..     # uci get batman-adv.bat0 -> mesh

# ap: limit to 8 devices?

# /www/NETFILTER_AUTOADD: function for writing to disc without stopping firewall
# /www/NETFILTER_AUTOADD: if in DB/mac: direct _netfilter user_add

# sometimes we loose config.tgz - why? also store it on nexthop/linklocal-ping6?

# dmesg: 'net_ratelimit: 115 callbacks suppressed'

# Friwo Tischnetzteil ErP 12V 1A

# build tables: always restart if 0

# git clone git://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git linux-git

# find -name '*.sysupgrade.bin' | grep -v "\.r" | while read L; do md5sum "$L"; done

# detect silent hangs (on gateway?)
# track routes: ip r | wc -l
# no forwarded traffic for X minutes: reboot

# bssid_wellformed_fix fuer alle adhoc-netze

# early_boot: sometimes 'kalua_init' does not run -> override_uci does not work?

# reverse.ssh.tunnel: retry 25 times

# wifi/wartungsmodus -> inet_seems_stable

# force olsr-hna-slave: uci set olsrd.@olsrd[0].disabled=1

# button tickets: verfeinern, nur bei "autocreate" und vorrat zeigen

# mips/memtest:
# http://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/?id=272b9cad6e7a2f61b13cfcd7dde0010e02e9376e
# http://stackoverflow.com/questions/11640062/how-to-do-memory-test-on-arm-architecture-hardware-something-like-memtest86
# http://unix.stackexchange.com/questions/38887/how-can-i-test-the-ram-for-data-corruption-on-an-arm-based-system

# rrd: ping-time auf node im Netz

# check klog?: CPU 0 Unable to handle kernel paging request at virtual address --> Oops

# build: upload() if images small than 3.6mb, upload ONLY some additionally (e.g. WR-841ND)

# general class: _lock (auto unlock-trap?)


# B01 und allgemein: check incoming WIRED_OLSR: erste stunde = durchschnitt. jede minute pruefen.

# dont spam too much: loady_after_overload

# apply_profile: nanostationM: uci set wireless.@wifi-iface[0].antenna=mode - vertical|horizontal|external

# add a printk to the reghack.patch

# webcam: dont add files to movie when hash already was used before

# before reboot: scan -> file on flash with "mac: lastseen/signal"

# 1043er-Tickets:
# https://dev.openwrt.org/ticket/9654
# https://dev.openwrt.org/ticket/11862

# boltenhagendh: allow olsr-slave with huge OK-window (for not restarting olsr a lot of times)

# DB: index_gen for a single login should not force a full backup _now_ but later

#### incoming_wifi_activity spams log. only once for each changed framecounter

# keine defaultroute in ap-mode? go hybrid (nicht permanent) -> cool_wifi_makro

# rrd: better colors

# case "$( pidof scp )" in *" "*" "*" "*) echo ja;; esac

# rethink uci/log-settings e.g. for leds/syslog

# underload, anderen CRON killen:
# pidof sh
# cat /proc/$PID/cmdline: '/bin/sh-c. /tmp/CRON_IS_CAREFUL'

# ist jemand per telnet eingeloggt?
# pidof ash
# cat /proc/$PID/cmdline = "/bin/ash--login"


# during log(): local load="$( _system load 1min )"; test $load -gt 80 && { MESSAGE="LOAD:$load $MESSAGE"; PRIO=alert; }

# think about:
# it happens during:
# tc filter add dev eth0.1 protocol ip parent 1:0 prio 6 u32 match ip src 10.63.2.34/32 flowid 1:6
# tc filter del dev eth0.1 protocol ip parent 1:0 prio 10
root@EG-labor-AP:/ _netfilter_traffic_control_stop
RTNETLINK answers: Invalid argument
We have an error talking to the kernel
RTNETLINK answers: Invalid argument
We have an error talking to the kernel
RTNETLINK answers: No such file or directory
RTNETLINK answers: No such file or directory
RTNETLINK answers: Invalid argument
We have an error talking to the kernel
RTNETLINK answers: Invalid argument
We have an error talking to the kernel
RTNETLINK answers: No such file or directory
RTNETLINK answers: No such file or directory
RTNETLINK answers: No such file or directory

# IPv6 ausschalten:
* Global build settings -> [ ] Enable IPv6 support in packages
* Kernel modules -> Netfilter Extensions -> [ ] kmod-ip6tables 
* Kernel modules -> Network Support -> [ ] kmod-ipv6
* Network -> [ ] odhcp6c
* Network -> [ ] 6relayd
* Network -> Firewall -> [ ] ip6tables ???
* Libraries -> Firewall -> [ ] libip6tc

# HASH=59d13e5; for F in *; do case "$F" in *git.*) case "$F" in *$HASH*) ;; *) rm "$F"; esac; esac; done
# + link to it!





# simple tftp-server: (we can see in log e.g.: dnsmasq-tftp[32648]: sent /tmp/t18.rom to 192.168.0.10)
# 1043nd = 192.168.0.2
# ip address add 192.168.0.5/24 dev $LANDEV
# dnsmasq --port 0 --enable-tftp --tftp-root=/tmp	# with file 'code.bin'
# # erase 0xbf020000 +7c0000
# # tftpboot 0x81000000 code.bin
# # cp.b 0x81000000 0xbf020000 0x7c0000
# # bootm 0xbf020000
# # erase 0xbf020000 +7c0000; tftpboot 0x81000000 code.bin; cp.b 0x81000000 0xbf020000 0x7c0000; bootm 0xbf020000
#
# 4300:
# ip address add 192.168.1.100/24 dev $LANDEV
# dnsmasq --port 0 --enable-tftp --tftp-root=/tmp	# with file '6F01A8C0.img'
# on router:
# tftpboot 0x81000000; erase 0x9f020000 +7c0000; cp.b 0x81000000 0x9f020000 0x7c0000; reset
#
# 841nd v8:
# ip address add 192.168.1.100/24 dev $LANDEV
# dnsmasq --port 0 --enable-tftp --tftp-root=/tmp	# with file '6F01A8C0.img'
# tftpboot 0x80000000					# use WAN-port
# erase 0x9f020000 +0x3c0000
# cp.b 0x80000000 0x9f020000 0x3c0000
# bootm 0x9f020000
#
# 703n:
# ip address add 192.168.1.100/24 dev $LANDEV
# dnsmasq --port 0 --enable-tftp --tftp-root=/tmp	# with file '/tmp/6F01A8C0.img'
# tftpboot 0x81000000
# erase 0x9f020000 +0x3c0000
# cp.b 0x81000000 0x9f020000 0x3c0000
# bootm 9f020000
#
# 4900er: (pass = 'vl' at bootloader-prompt)
# ip address add 192.168.0.104/24 dev $LANDEV		# with file 'uImage', router has '192.168.0.86' with mac '00:04:9f:ef:01:01'
# dnsmasq --port 0 --enable-tftp --tftp-root=/tmp
#
# tftpboot
# sf probe 0
# sf erase 0x60000 0xf80000
# sf write 0x1000000 0x60000 0xf80000
# reset
#
#
#
# tmobile Internetbox / cube:
# ip address add 192.168.0.100/24 dev $LANDEV
# dnsmasq --port 0 --enable-tftp --tftp-root=/tmp
# ip neigh add 192.168.0.1 dev eth0 lladdr 00:0e:56:00:0f:c5 nud permanent
#
# wget -O /tmp/1.srec http://downloads.openwrt.org/backfire/10.03.1/au1000/openwrt-au1000-au1500-vmlinux-flash.srec
# wget -O /tmp/2.srec http://downloads.openwrt.org/backfire/10.03.1/au1000/openwrt-au1000-au1500-jffs2-128k.srec
#
# wget -O /tmp/1.srec http://downloads.openwrt.org/snapshots/trunk/au1000/openwrt-au1000-au1500-vmlinux-flash.srec
# wget -O /tmp/2.srec http://downloads.openwrt.org/snapshots/trunk/au1000/openwrt-au1000-au1500-squashfs.srec
#
# sudo ip neigh change 192.168.0.1 dev eth0 lladdr 00:0e:56:00:0e:10 nud permanent
# sudo ethtool -s eth0 speed 10 duplex half autoneg on
# sudo ./ethernet_flash -i eth0
#
# set
# setenv bootserver 192.168.0.100
# setenv ipaddr 192.168.0.1
# setenv gateway 192.168.0.100
# ping 192.168.0.100	# for ARP
# erase -s		# hangs for ~120 seconds
# load /1.srec		# openwrt-au1000-au1500-vmlinux-flash.srec
# load /2.srec		# openwrt-au1000-au1500-squashfs.srec ~ 13mb size
# go
#
# mtd    write /tmp/vmlinux.bin kernel
# mtd -r write /tmp/fs.bin      kernel
#
#
#
# rb532:
# boot-proto = dhcp
# dnsmasq --port 0 --enable-tftp --tftp-root=/tmp	# mit vmlinux, e.g. openwrt-rb532-jffs2-128k.kernel 

URGENT:
- noolsr/ibfleesensee

- 1043ND: md5sum /dev/mtd0 :: strings /dev/mtd0 | grep U-Boot
  - ??? : dab5229a0cbe46160e8b8d0ef093eb2c :: U-Boot 1.1.4 (Nov 17 2009 - 11:56:26)	-> spbansin/haus6
  - ??? : d2acf2a1587e2349d858da14bd9fe445 :: U-Boot 1.1.4 (Nov 17 2009 - 11:56:26)	-> spbansin/haus12
  - good: 31ef3d5fad161ce7affbac0d0ae3293e :: U-Boot 1.1.4 (Nov 17 2009 - 11:56:26)
  - good: 17d63e8edb736df029cf6bc0391a080a :: U-Boot 1.1.4 (Aug  4 2010 - 20:06:51)	-> liszt28-2
  - bad:  12cb02c599ad92ed607d05e65daabd4e :: U-Boot 1.1.4 (Aug  4 2010 - 20:06:51)
    - wget -O /tmp/uboot.bin http://intercity-vpn.de/files/openwrt/bootloader_TL-WR1043ND_17d63e8edb736df029cf6bc0391a080a_WANok_U-Boot_1.1.4_Aug_4_2010.bin
    - mtd write /tmp/uboot.bin u-boot

- hybrid: no_incoming() fails? -> check AP
- always let 2 nodes ping monitoring server
- no shaping under X megabytes
- ticket-speed = real-speed
- multiradio: bssid adhoc varieren: = c11 c36
- multiradio: working dhcp
- index_gen nur bei ticket_gen?
- fix netfilter/splash for batman
- backup's db in die cloud, nicht auf flash
- conntrack auch in sysctl auf alten wert / eigene zeile raus
- check shaping when different interfaces are involved
- rehungen: apply_shaping after X mb
- spbansin: 812 + 908?
- spbansin: replace wrong bootloader
- batman: correct add if 'wlan0' to bridge via ifstatus <ifname>|grep ifname
- wenn load immer weiter sinkt (Tendenz), soll OVERLOAD nicht ausloesen
- cron.minutely: monitore olsr-packets on wire per minute (B01)
- wenn mehrere male 'ath: phy0: Failed to stop TX DMA' dann echo 4 >diag

TODO-next:
# - rrd: show users + overall users
# - rrd: show overall traffic in [mb]
# - master: outgoing with sourceaddress not from me? drop
# - leonardo: wan2 + alias wan + wan-dhcp + wan=free + extended reachable check for wan
# - speed auf pfad anpassen: regelmaessig fuer jeden node den max up/down ermitteln und in max-speed einfliessen lassen bei apply_shaping
# - reverse-ssh-tunnel: autossh?
# - reverse-ssh-tunnel: retry 10 times if conn will not establish
# - rrd: show stations: for S in /sys/kernel/debug/ieee80211/phy0/netdev:wlan0/stations/*; do echo $S; done
# - make use of netfiler 'notrack' for e.g. port53 dns
# - scp to monitoring-server: sometimes we need to regen keys, although everything seems good. the real check is to scp something to server. automate this.
# - patch inittab on LOWMEM for non-user-shell/askfirst
# - reboot not at timeX? message! (during ntp) 
# - ifup wan (when dhcp) before reboot? (to sticky the lease)
# - mail: set replyTO:
# - mail/smtp: implement 3 different smtp-gateways/methods
# - webcam-support UVC 1.00:
#   - HP Webcam HD-4110 (03f0:9207) = Seepark Bansin
#   - Microsoft® LifeCam Studio(TM) (045e:0772) = Buero Fenster
#   - SunplusIT PC Camera (1bcf:0b01) = 2te Lieferung HP?
# - support for specials: e.g. bigbrother (webcam-support), mini (4mb flash)
#   - build/upload: Buffalo WZR-HP-AG300H.bigbrother.r37106-kernel3.8.13-git.fb34ce2.sysupgrade.bin
#   - links() + apply_profile()
# - batman-modus im monitoring senden
# - update-server/monitoring-server: info.txt muss ein script sein, was hashes + files dynmaisch zusammensetzt
# - vtund-check in cron.minutely oder watch(): grep "tap0:" /proc/net/dev || action
# - sysupgrade fuer einzelnen knoten im wartungsfenster aktivieren: touch upgrade_next_window?
# - DHSYLT/K80/Netzwerksteckdose: bei sysupgrade weiter pingbar sein, auch:
    - iptables -I INPUT -p icmp                  -j LOG --log-prefix "ICMP: "
    - iptables -I INPUT -p icmp ! -s 84.38.67.43 -j LOG --log-prefix "ICMP: "
# - list() we always input a space separated list and out put a "\n" one - problems?
# - ath9k-error: cat /sys/kernel/debug/ieee80211/phy0/ath9k + echo 4 >/sys/kernel/debug/ieee80211/phy0/ath9k/diag ==> resetHW
# - firmware-upgrade: cannot unload kmodule IPv6: maybe delete allinet6 fe80::* stuff?
# - dns: change leasetime according to scheduled reboottime
# - switch: check if we can read the expected number of ports. otherwise: portmap: 'B.--C' was: 'B.---C'
# - use flock? http://stackoverflow.com/questions/13551840/bash-flock-why-200
# - NOTICE: /proc/<pid>/oom_adj is deprecated and will be removed, please see Documentation/feature-removal-schedule.txt.
# - myinfo.sh: show token + store_on_flash.$token
# - build: use folder "files" instead of occupy package/base-files
# - /proc/net/dev -> /sys/class/net/
# - boltenhagendh: hybrid = kanal 1 + komische bssid
# - ist olsr-hash wirklich noetig? hotello-B01: hash2: c44b44ba7a3612e2f6be3531ddcba407
# - support/use of 'logread -f -r server:port'
# - netfilter: enforce writing of NETFILTER_AUTOADD
# - nach reboot sehr schnelles monitoring-senden fuer IP _wenn_ local_inet_offer
# - batman for boltenhagendh
# - monitoring: fetch meshrdf if ping_error and ping_good again
# - log each reboot, (crash or manually) and calc real bootdate
# - batman: zweiter IP-Bereich oder groesser
# - faxe: antwort-fax-nummer mit drauf
# - batman: # zeile 512: echo "dhcp-range=bridge,192.168.5.100,192.168.5.120,255.255.255.0,10m" >> $CONFIGFILE
# - monitoring: make switch sortable (e.g. "all with inet-offer", all which are the same), just add +1 for each used port and +2 for inetofferport?)
# - ffweimar: WAN = dhcp + static + OLSR
# - neigh: show wifi/channel humanreadable?
# - ubus call hostapd.wlan1 del_client '{ "addr" : "00:21:6a:32:7c:1c", "reason" : "assoc toomany" }'
# - ubus call hostapd.wlan0 del_client '{ "addr" : "00:21:6a:32:7c:1c", "reason" : "assoc toomany", "ban_time" : 10000 }'
#   - http://resin.csoft.net/cgi-bin/man.cgi?section=5&topic=hostapd.conf
# - each node: accept forwarded, but filter outgoing packets, which have source-address ! ownHna4 (should do each ISP)
# - olsrd: fixup an ipv6 startup/both instances/concept
# - make all neighs arp-permanent
# - nutzen fuer kmdlinetweak: target/linux/ar71xx/Makefile LINUX_VERSION:=3.8.12
# - nach anmeldung umleitung auf "willkommen" + angebot: http://www.dorfhotel.com/angebote/hotelangebote-sport-golf-segeln-fahrrad-nordicwalking-yoga.html
# - apply_profile: no wlan-ifname in network
# - olsrd-init: restart() b0rken?
# - olsrd-init: ipv4 + ipv6
# - 1043er detect "wrong" bootloader/wan-problem
# - rrd: show overall values
# - update: spbansin/cam + dhsylt/central + vivaldi/central
# - monitoring: give up, when empty default route AND error
# - monitoring: generic support for "heartbeat"/hb
# - build-support: "bigbrother": multimedia: +fswebcam +ffmpeg +motion  utilities: +v4l-utils  kernelmodules: videosupport: +kmod-video-core +kmod-video-uvc
# - build-support: +rrdtool +kmod-batman-adv +kmod-ipip +kmod-sit +kmod-usb-printer +p910 +luci +mii-tool(9k)
# - crashlog.o: abstraktion: uhrzeit retten? rrd retten? tgz retten!
# - lowmem-device: shut down olsrd-txtinfo-plugin
# - lowmem-device: find more minimal iptables set?
# - Make: all hostapd-switches configurable
# - remove all calls to iwconfig/iwpriv/wext -> without iwconfig, it runs
# - /www/NETFILTER_AUTOADD: check before reboot and enforce readding
# - wan-detect via ifplugd or script
# - crondebug: kerneltasks: fgrep "0 SW" /tmp/CRON_PSWORK2 | wc -l
# - build: hostapd:
#   - remove: CONFIG_DRIVER_MADWIFI=y + CONFIG_DRIVER_WIRED=y + CONFIG_DRIVER_HOSTAP=y + CONFIG_RSN_PREAUTH=y + CONFIG_PEERKEY=y + CONFIG_IEEE80211N=y
#   - add: CONFIG_NO_VLAN=y
# - build: lowmem: remove CONFIG_UBUS=y from package/network/services/hostapd/files/hostapd-mini.config
# - cron.minutley: mesh/lowmem: ping -s 1337 = startup uhttpd
#   - iptables -I INPUT -p icmp -m length --length 1365
#   - ping -c 1 -s 1337 10.63.15.33
#   - or: https://github.com/libre-mesh/magic-icmp
# - check /proc/sys/vm/min_free_kbytes - http://lists.centos.org/pipermail/centos/2006-December/030766.html
# - nightly reboot: wait till forwarding is 0 for 60sec
# - crondebug: last longer than 60sec? -> CRONSTATUS + locked ans ende
# - klog: nf_conntrack: automatic helper assignment is deprecated and it will be removed soon. Use the iptables CT target to attach helpers instead.
# - log_debug() handle brdip = ff:ff:ff:ff:ff:ff
# - build: minimal: no px5g if nohttps, no debug: no package/network/ipv6/6relayd + odhcp6c + ipv6-support 
# - nightly_reboot() only unload/store vds - not fully stop packetfilter
# - wifiscan jede nacht - alle macs/ssid merken -> graph? -> kanalaufteilung? -> olsr-plugin?
# - netfilter_stop() without removing nat and without killing connection
# - netfilter_ror() in extra function
# - rrd: also store load over time
# - rrd: not inet_offer? plot rule 3 + 4
# - store dmesg for later checks?: cp /tmp/dmesg.log "/www/dmesg.log.$( _system date humanreadable )"
# - db_restore() soll auch serverkopie benutzen (und aus cron.evaluate_syslogd rausnehmen)
# - make incoming_framecounter base on 'iw dev $wifidev station dump'
# - repair nodes with broken webserverconfig
# - webcam: [ $( logread | grep "uvcvideo: Failed to set UVC probe control" | wc -l ) -gt 5 ] && reboot
# - webcam: make resolution uci-configurable + fix 450 pixels -> modulo 16 -> 448 px
# - solution for special macs / no shaping: liszt28: nasf36: 02:50:43:ab:1c:91
# - px5g nur nachinstallieren, wenn erst/einmalig benoetigt
# - fix watch_random_node_id() during apply_profile
# - generalize live-traffic shower per mac on commandline
# - rrd for inet-gw/wan
# - inactive for >x mins? -> throttling/shape to original values
# - override_uci: 10m leasetime wlan when ipsystem = normal
# - why does stats/yesterday not work?
# - check autostart of webserver, otherwise we always spam the log after each reboot
# - switch() give points per connection-speed so we can better log
# - netfilter: special mode for NETFILTER_AUTOADD + testing
# - log all reboots not @4.00 during successful ntp_set
#   - crashlog or unknown reason?
# - ntp_set via neighbour
# - uci -q get ueberall
# - monitoring: cat $WIFI_RESTARTS.wlan0 2>/dev/null
# - olsr-init: IFS immer retten
# - finetune max_length in monitoring
# - why S01/overrid_uci_vars is not called
# - is S00/generate_kalua_loader really working?
# - integrate new rules for ejbw / lan-dhcp
# - testing if new function client_list() build correct: fix /30 WAN
# - activate patch for rcS-watcher
# - no inet_offer and ! ping_to_nexthop (but not myself) -> reboot
# - cron-replace: while true; do sleep 60; command . /tmp/CRON_IS_CAREFUL; touch /tmp/CRON_IS_CAREFUL; done &
#   - http://intercity-vpn.de/files/openwrt/dmesg_r35300_error_mac80211_ath9k.no_cron_action_anymore.txt
#   - http://intercity-vpn.de/files/openwrt/dmesg_r35300_error_mac80211_ath9k.no_cron_action_anymore-ps.txt
#   - or use dhcpscript to check if cron is running (is correct uptime in file x)?
# - autolearn olsr-neighhash? (K80!)
# - debug 0 byte mailfile r99/l28
# - image smaller, so that image-on-flash works
# - compile/test atheros image with -O0
# - generischer modulloader fuer lowmem-geraete
#   - xt_TCPMSS|xt_REDIRECT|xt_NETMAP|aead|crypto_blkcipher
# - apply zramscript: logger --> _log calls + loglevel same as firmware
# - dont influence oom-score for watchdog (S70prepare)
# - convert _switch() for all known hw-types
# - everybody gets "hybrid", if there is no neigh with ap-mode
#   - if b43 and ap -> mesh
# - build/apply_profile: set IP for hybrid-network
# - mail: http://vger.kernel.org/vger-lists.html#netdev : complain about: ip route list exact 0.0.0.0/0 || action
# - loader: check if multiple args in loader can be $@ instead of $1 $2 $3 ...
# - loader: if a zero-byte class is found, use logger in loader and dont fail (e.g. db() for weimarnetz)
# - if ntp_set was successful, update: head -n1 /www/NETFILTER_AUTOADD (or use a dedicated mechanism)
# - build: auto-activate SWAP in kernel for atheros
# - helper-script: vds: last traffic of $IP or $NODE or $HASH (tar -tvkf "$file.lzma" --force-local)


# idea:
# /www/startsysupgrade: ap-mode? reboot:
# special module loader + leave wifi off + netfilter off + olsr-slave

# idea:
# during scheduler -U, replace crontab with '/usr/bin/scheduler -U'

# 16mb-routers:
# S72 / no monitoring

# 16mb-routers:
# olsr-hna-slave? no NAT modules needed?

# repair all calls to set without "--"
# git grep "set "|grep -v -- "--"|grep -v reset|grep -v "uci set"|grep -v "nvram set"

# R30:
# - laptop eintragen?
# - olsr-error during check_inet?


# build:
# all patches/applymyprofile via git

# weimarnetz-server:
# for M in floppy usbcore usb_common ehci_hcd uhci_hcd cdrom hid usbhid i2c_core i2c_piix4 joydev soundcore snd psmouse snd_timer snd_page_alloc snd_pcm; do echo "blacklist $M" >>/etc/modprobe.d/my-blacklist.conf; done
#


# umount /space; mount -t tmpfs -o size=6G,mode=0777 tmpfs /space
#
# build in /dev/shm, symlink these
# ./bin (2mb) ./build_dir (3.5gb) ./staging_dir (250mb) ./tmp (15mb)
#
# symlink this globally: (~250 mb content)
# mkdir -p /tmp/openwrt-downloads
# chmod -R 777 /tmp/openwrt-downloads
# ln -s /tmp/openwrt-downloads dl 


# http://www.useragentstring.com/pages/Browserlist/
# http://www.useragentstring.com/?uas=Opera/9.70%20(Linux%20i686%20;%20U;%20en-us)%20Presto/2.2.0


# patch: all ifconfig/route/arp/netstat calls can be wether with this or with 'ip' and build without these but with full 'ip'
# measure size change

# patch_kmodules: mode = remove_file()

# vivaldi:
for I in $( seq 34 46 ); do {
iptables -t nat -I PREROUTING -i $WANDEV -p tcp --dport 100${I} -j DNAT --to-destination 192.168.1.${I}:80
} done

iptables -t mangle -I PREROUTING -d 192.168.1.0/24 -j ACCEPT
iptables -t nat -I POSTROUTING ! -s 192.168.1.0/24 -d 192.168.1.0/24 -j SNAT --to-source 192.168.1.33
#iptables -t nat -I POSTROUTING ! -s 192.168.1.0/24 -d 192.168.1.0/24 -j MASQUERADE


# rehungen/userdb:
iptables -t nat -I PREROUTING -p tcp --dport 10080 -j DNAT --to-destination 10.10.8.33:80
iptables -t nat -I PREROUTING -p tcp --dport 10443 -j DNAT --to-destination 10.10.8.33:443
iptables -t nat -I POSTROUTING ! -s 10.0.0.0/8 -d 10.10.8.33 -j MASQUERADE
#
iptables -t nat -D PREROUTING 1
iptables -t nat -D PREROUTING 1
iptables -t nat -D POSTROUTING 1


# olsrd:
# dont start anymore if a stable olsr-master for myself (slave) is already found an safed, just refresh rules

# useful /etc/.vimrc:
set cul
hi CursorLine cterm=none ctermbg=darkgray ctermfg=white
syntax on
set syn=sh


# patch openwrt:
# git clone git://nbd.name/openwrt.git
# git checkout -b feature_abc
# <make some changes>
# git diff --cached --color
# git commit		(respect http://tbaggery.com/2008/04/19/a-note-about-git-commit-messages.html)
#	subject e.g. '[packages] olsrd: use system-logger instead of dumping to stdout'
#	subject e.g. '[base-files] failsafe-mode: print short help on commandline'
#
# stimmt nicht: Betreffzeile 2 mal schreiben, dann ist es gleich in der Mail richtig
#
#
# git format-patch --subject-prefix="PATCH RFC (vN)"
# git format-patch --cover-letter
# git format-patch -s -1  ('s' means: add signed-off ...)
# git format-patch -s -5
# git format-patch -s $hash_of_last_commit_not_from_me
#
# scp -P 22 000* root@intercity-vpn.de:/var/www/files/openwrt/patches
# scp -P 222 000* bastian@bwireless.mooo.com:/tmp
# wget http://intercity-vpn.de/files/openwrt/patches/000...
# mutt -H "$file"	(http://blog.ndrix.com/2007/05/mutt-and-git-format-patch.html)
#
# testen:
# git send-email --to basti@bla HEAD~3

# patch b43:
# git clone git://git.kernel.org/pub/scm/linux/kernel/git/linville/wireless-testing.git
# <make some changes>
# git add .
# git commit -m "bla"
# git show >/tmp/my.patch
# sed -n '/^---/,$p' /tmp/my.patch >/tmp/841-b43-raise_dma_rx_ringbuffer_to_128.patch


# ideensammlung 'init' -> procd
# - source a shellscript every 60 sec
# - refresh watchdog every x sec
# - syslogd
# - klogd
# - hotplug2
#
# http://www.landley.net/hg/toybox/file/aad12ce05aae/toys/other/oneit.c
# http://spblinux.de/2.0/doc/init.html
# http://busybox.net/~vda/init_vs_runsv.html
# http://www.centos.org/docs/5/html/5.1/Installation_Guide/s2-boot-init-shutdown-init.html
# http://smarden.org/runit/


# monitoring: better show +123 more dmesg lines after boot

# liste aller freigeschalteten macs direkt in dhcp-script aufnehmen
# beim ersten cron.check_inet vom server holen:
# grep "C='..:..:..:..:..:..'" /tmp/DB/USER/login/rows | cut -d';' -f4 | cut -d"'" -f2


# userdb-gui:
# vorrat/ticketsart und in db_ticketcheck beruecksichtigen
# boltenhagendh: mehr 3-tagestickets


# userdb-gui:
# berichte: tages/wochen/monats + email angeben

# userdb-gui:
# berichte: taeglich: top 10 user?

# olsr_hna_slave:
# verbieten wenn master nicht _ipsystem wie ich hat (ejbw, wanolsr)

# why this?
# /etc/init.d/S69watch_olsrd_fff+ [daemon.alert] watch_dhcp_space() clients: lan: 0/150 wifi: 1/0

# make sure to use the password hash in /tmp/vds_user_$mac, even when we
# are freed by "already known on other station"


# bugreport:
# - show normal olsr-neighs-table without error


# rehungen:
# - ask user-data every 3 month,
# - reset passwords 


# myinfo.sh:
# - start test via button and show download-speed in numbers


# rehungen: dns:
# - erzwingen von DNS = 10.10.8.33 ausser auf: sollstedt etc.
# - erlaubenvon wan-dns in Kindergarten
# - remove alias 10.1.0.8 auf kindergarten

# firmware-simpler schneller/sicherer:
  - ZENTRALER NODE = ZN
  - kein update/warten, wenn gerade AP-clients connected
  - ZN gibt firmware-datei raus? nein, muss proxy-cache erledigen
  - vor update: abmelden an ZN nach apply_profile + reboot = anmelden an ZN
  - erst dann freigabe fuer naechsten
  - alles ist gelockt mit angabe in sekunden, wann ca. erneute anfragen gestellt werden darf

# wartungmodus:
  - erstmal manuell per shell-wizard + script auf router
  - alle clients rauswerden
  - startseite = wartungsmodus
  - dnsmasq beantwortet alles mit $WIFIADR


# force minimal olsrd-setup for 16mb routers (only plugin txtinfo)

# apply_profile: use '/cgi-bin/:root:$p$root' if possible for uhttpd

# log/sms: sms.@sms[0].username / sms.@sms[0].password

# patch sysupgrade for also using /dev/console

# when in dmesg: 'failed to initialize PHY', no unloading of wireless stuff before sysupgrade

# kill ubusd, procd before sysupgrade?

# hack: activate shaping only for users which have over >mb

# if we know how long a task will last, feed a "box" with minute-signs, and cron-overload-detector will eat them up over time

# traffic ueber tunnel: config-option, wenn auch ueber lan

# split scheduler jobs into sourceable files, e.g. "w" and "O"

# rootserver: tun/tap per hna4 ankuendigen - pauschal fuer jeden

# remove dead-netfilter users midnight

# always remove dhcpscript for lowmem-devices, except if explicit configured

# deny tool if action?: while :;do ps | fgrep CRON_IS_CAREFUL | fgrep -v grep ; sleep 1; done

# wget: maybe do normal wget, but mark for cron_watcher?

# userdb-copy via wget()

# pdf-versand: seitennummern

# sms bei ticketversand nur 1mal, nicht pro seite


# beim 15min-summary abliefern neue tickets als used markieren/abziehen

# beim 15min-summary abliefern erlaubte mac's/Logins mitliefern


# wenn olsr-nachbarn nud=permanent sind, arp-plugin ausschalten
# sonst haut das plugin immer wieder rein in _net arp_permanent()

# packages automatisch mit passendem datum auschecken wie openwrt-git

# _olsr_uptime() work with uptime instead of date - check other function too

# system_date() to class date()

# check kmodules-hack for working pppoe

# 
# ssh bastian@gcc20.fsffrance.org

# userdb-GUI: force global fuzzy

# [ERR] are wired neighbours LQ/NLQ nearly synchronous? no! REMOTE/LQ/NLQ = '10.10.31.33'/'1000'/'0'
# uci changes | fgrep 10.10.31.0	// ignore hna-slaves

# monitoring: remove 0 byte or small db-backup


# 1) harte route setzen
# 2) while :; do ssh $IP; sleep 10; done
# 3) echo 4194304 >/sys/block/zram0/disksize; mkswap /dev/zram0; swapon /dev/zram0
# 4) comment 'killall dropbear' in /etc/init.d/S70prepare_fff+
# 5) uncomment usb-stuff in /etc/kalua/netfilter
# 6) rm /www/GOOD_MODULE_UNLOAD
# 7) reboot && exit

echo 4194304 >/sys/block/zram0/disksize; mkswap /dev/zram0; swapon /dev/zram0; sed -i 's/dropbear/dropBear/' /etc/init.d/S70prepare_fff+
sed -i 's|/etc/kalua_init|/etc/kalua_init;echo 4194304 >/sys/block/zram0/disksize;mkswap /dev/zram0;swapon /dev/zram0|' /etc/init.d/generate_kalua_loader 
sed -i 's/sleep 30/break;sleep 30/' /etc/init.d/apply_profile; sed -i 's/crond/crondBLA/' /etc/init.d/apply_profile
rm /etc/modules.d/19-usb-brcm47xx /etc/modules.d/50-usb-ohci /etc/modules.d/20-usb-core
sed -i 's/_wifi vendor_and_model_usb/# _wifi vendor_and_model_usb/' /etc/kalua/wifi; rm /www/GOOD_MODULE_UNLOAD; reboot && exit


# monitoring: dmesg:
# SQUASHFS error: Unable to read page, block c52d2, size ebb8
# SQUASHFS error: Unable to read fragment cache entry [c52d2]

# watch_random_node_id() really enforce apply_profile, if nodenumber clashes/registrator complains 

# echo 4194304 >/sys/block/zram0/disksize; mkswap /dev/zram0; swapon /dev/zram0

# package: ffweimar-mapstraction-karte

# rehungen: dont allow weblogin <r33726 (after updating hybrid-router)


# find a way to auto-config:
# hybrid
# dualradio: ap/ap
# dualradio: hybrid/ap
# dualradio: ap/adhoc

# liszt28: etx_ffeth + 02:ca:ff:ee:00:11 + kanal 11

# apply_profile: always do bssid_wellformed() even in 11g mode and preset to "02:ca:ff:ee:ba:be"

# sms bei ticketversand konfigurierbar machen

# monitoring: change order if ssid's in hybrid mode (first "Hotello", then 'bb')

# fusionpbx
# ^03643?(\d{5-8})$
# the ^03643 means that the number can start with 03643 but its optional

# rehungen 10.1.0.8 auf richtfunk ändern zu 10.10.254.33
# auf 8/kindergarten: + hna4 10.1.0.8/32

# apply_profile: boltenhagendh: festscheune: free-login

# apply_profie: config: dhcp: list notinterface = wan ::: nur wenn auch einspeiser, netzintern egal (rehungen8)


# on both servers:

# MYDIR="y"; ARCH="brcm47xx"; R=34054; FILE="openwrt-brcm47xx-squashfs.trx"; HARDWARE="Buffalo WHR-HP-G54"; K=3.3.8
# MYDIR="z"; ARCH="ar71xx";   R=34054; FILE="openwrt-ar71xx-generic-wzr-hp-ag300h-squashfs-sysupgrade.bin"; HARDWARE="Buffalo WZR-HP-AG300H"; K=3.3.8
# MYDIR="x"; ARCH="ar71xx";   R=34054; FILE="openwrt-ar71xx-generic-tl-wr1043nd-v1-squashfs-sysupgrade.bin"; HARDWARE="HARDWARE.TP-LINK TL-WR1043ND"; K=3.3.8

# on build-server:
$DO r$R "$HARDWARE" standard kernel.addzram dataretention trafficshaping kcmdlinetweak

# on file-server:
# scp bastian@46.252.25.48:$MYDIR/release/openwrt/bin/$ARCH/$FILE "${HARDWARE}-exp-r${R}-${K}.sysupgrade.bin"
# cp "${HARDWARE}-exp-r${R}-${K}.sysupgrade.bin" "${HARDWARE}.sysupgrade.bin"; md5sum "${HARDWARE}.sysupgrade.bin"




# db_cleanup()
# = remove old entries from stats >1 month
# = dont hash login-entries older than X month untouched

# while :; do netstat -an 2>/dev/null | grep $LANADR:80 | grep ESTABLISHED | while read LINE; do set -- $LINE; echo -n "$( echo $5 | cut -d':' -f2 ) "; done | sort -n; test -z "$LINE" && echo "#"; sleep 5; done


# erste inbetriebnahme: _db_backup() schlaegt fehl. checken
# touch ... noetig


# forbid udp-source-ip-spoofing: sudo hping3 10.63.99.33 --udp --spoof 192.168.1.150


# package: ekuku-longshot: ath5k -b43 +mii-tool
# package: rrdtool


# rrd:
# each router
# each user
# each login


# high load + multiple dropbear-pids: shutdown dropbear
#
# needs iptables-mod-conntrack-extra: _net local_inet_offer && {
# iptables -I INPUT -i $WANDEV -p tcp -m tcp --dport 22 -m state --state NEW -m recent \
#  --set --name DEFAULT --rsource
# iptables -I INPUT -i $WANDEV -p tcp -m tcp --dport 22 -m state --state NEW -m recent \
#  --update --seconds 180 --hitcount 4 --name DEFAULT --rsource -j DROP
# http://www.digitalsanctuary.com/tech-blog/debian/using-iptables-to-prevent-ssh-brute-force-attacks.html
# }


# FILE_IN=youtube.flv
# FILE_OUT=vtech_kidizoom.avi	// 102_0366.avi
# ffmpeg -i "$FILE_IN" -r 25 -ab 16k -ar 22050 -vcodec mjpeg -b 64k -acodec pcm_s16le -ac 1 -s 320x240 -sameq "$FILE_OUT"


# complex feedback during server_ask weblogin() -> speed, traffic, yes/no, special message etc.


# for i in $(seq 0 255); do hex="$( printf "%X\n" $i )"; echo "$i: $hex: $( eval "echo \$'\x$hex'" )"; sleep 1; done


# bytes bei user_del speichern und bei user_add apply?


# wenn ramdisk voll, dann logrotate checken: manchmal ist /www/everlasting_syslog weg

# speedwerte in file schreiben
#
# change per user traffshaping implementieren: percent from original OR percentual change (down to 75% OR -5%)
#
# change per profile alle 15mins (?) neu applien (kurven vor ermitteln)


# best practise for making an hybrid-router (adhoc+ap):
# in /etc/config/network add (beside to normal wlan-network)
#
# config 'interface' 'wlanadhoc'
# 	option 'ifname' 'wlan0-1'
# 	option 'proto'  'static'
#	option 'ipaddr'  'same like in network wlan'
#	option 'netmask' 'same like in network wlan'
#
# in /etc/config/wireless add
#
# config wifi-iface
#	option device   radio0
#	option network  wlanadhoc
#	option mode     adhoc
#	option bssid    '02:ca:ff:ee:ba:be'
#	option ssid     'bb'
#
# config wifi-iface
#	option device   radio0
#	option network  wlan
#	option mode     ap
#	option ssid     'myAP'
#

# implement correct ipsystem() for vivaldi
# and integrate into definitions

# fix profile_counter -> faster check, run every night for every ticket
# dont lock weblogin-via-mac-enabled clients during db_process
# make use of SNI?: http://en.gentoo-wiki.com/wiki/Apache2/SSL_and_Name_Based_Virtual_Hosts 

# Make panic_on_oops configurable / always on
# http://lkml.indiana.edu/hypermail/linux/kernel/1204.1/01389.html

# weblogin:
# support for single-string-login

# _netfilter user_list verbose
# xx:xx:xx:xx:xx:xx $ip $dev $tx $rx $shape_in $shape_out

# option for not kicking users over time, but slow them down to 8kbit/8kbit -> move to another profile?
# if not used for X days, remove from DB

# why index_gen is fully done after creating 32 tickets? -> implement also index_gen for a specific entry

# implement wshaper.htb for each user

# make var: LOCAL_INET_OFFER=lan

# better force of reboot for lowmem-devices each night

# why does olsr_restarts_over_limit() not work in lowmem-AP?

# add: kernel.hung_task_panic=1
# add: softlockup_panic=1

# kalua_init: allow 0 byte classes and allow all calls to them

# netfilter: mode for redirect of DNS requests to me, must be done global or per user

# fake-hybrid: update:
# F=/etc/config/wireless;I=0;while read L;do case "$L" in *wifi-iface*) I=$(($I+1));;esac;test $I -gt 1 && L="#$L";echo $L;done <$F >/tmp/W;mv /tmp/W $F
# F=/etc/config/wireless;I=0;while read L;do case "\$L" in *wifi-iface*) I=\$((\$I+1));;esac;test \$I -gt 1 && L="#\$L";echo \$L;done <\$F >/tmp/W;mv /tmp/W \$F

# debug uhttpd:
# /usr/sbin/uhttpd -h /www -r HOSTNAME -c /etc/httpd.conf -x /cgi-bin
# -t 60 -T 30 -A 1 -E /cgi-bin-404.sh -I cgi-bin-404.sh 
# -n 1 -p 0.0.0.0:80 -i .sh=/bin/ash -C /etc/uhttpd.crt -K /etc/uhttpd.key -s 0.0.0.0:443


# use "cutycapt" for make screenshots/pdf of webpages
# and for automatic walled_garden-url's -> list_of_ipaddresses

# add to website: https://github.com/blog/273-github-ribbons

# everything before the first :
# ${varname%%:*}
# everything after the first :
# ${varname#*:}
#
# always use 'set -- $var'

rm /www/channel_try
for i in $(seq 1 300); do
	uci set wireless.radio0.channel=$i
	wifi
	sleep 8
	[ -z "$(iwconfig $WIFIDEV | grep "Not-Associated" )" ] && echo $i >>/www/channel_try
done >/dev/null

# netfilter user_add: make an option 'force' for ignoring reachability

# autoapply config_ath9kdebug if possible during standard-conf

# abstraction for ticketcounter "_counterA", use: watch_counter() + set in _db_autocreate_tickets_and_send_mail() and _db_ticketcheck()

# DSL-modem/get values: http://www.webtemp.org/?page=sm50b

# wan-dhcp? -> use dns provided by wan, not 8.8.8.8

# unselect b43legacy
# CONFIG_PACKAGE_kmod-b43legacy is not set

# why do WZR/dual-radio have problems with beeing an olsr-slave?

# check: how does it look, if ip must be reauthenticated during send_mail()?

# kirkwood:
# use flash_eraseall and nandwrite -p from mtd-utils
# I mean flash_eraseall both the kernel and rootfs partition
# nandwrite -p the kernel to the kernel mtd
# mount -t jffs2  the rootfs mtdblock
# and tar -C /mnt -xzf openwrt-kirkwood-rootfs.tar.gz
# all this is best done from within an initramfs image


# after r32739 it should be enough to use "sed -ne ':package; /^Package: / { s/.*: //; h; :line; n;
# s/^Status: .* \(.*\) .*/\1/; /^user$/ { x; p; }; t package; b line }' /usr/lib/opkg/status" to find the list of user
# installed packages

# css-sprites for weblogin?

# check 15mins: tmpfs full?

# ticketcheck: use idX_counterA for fast processing

# b43:
# http://permalink.gmane.org/gmane.linux.drivers.bcm54xx.devel/10680

# automate build / continous integration via
# echo "# CONFIG_foo is not set" >> .config; make defconfig

# lowmem-device: make sure ulogd is not started by default; /etc/init.d/ulogd disable
# option for enforce dns for specific client: iptables -t nat -I PREROUTING -p udp -s 10.63.99.6 --dport 53 -j DNAT --to 10.63.99.1
# special longshot-mode, ping always, log stats (timeouts) -> simply set IP to check
# _watch inetoffer() -> restart masq, if no -> yes

# captive portal with oauth support
# https://github.com/livibetter/bash-oauth/blob/master/OAuth.sh

# http://holstentor.metameute.de/nodes/nodes.html

# show (count?) interesting tasks:
#
# ps | while read LINE; do set $LINE
#	case "$5" in
#		COMMAND|init|watchdog|uniq|sort|sleep|ps)
#		;;
#		"["*)
#		;;
#		*)
#			basename $5
#		;;
#	esac
# done | sort | uniq

# A="$( grep " sda"$ /proc/partitions )"; set $A; echo $3/1024 ->kilobyte

# debug: paste in /etc/functions.sh
# iw(){ logger -s "iw $@"; /usr/sbin/iw $@; };
# ifconfig(){ logger -s "ifconfig $@"; /sbin/ifconfig $@; };

# hook in system_date() for setting time
# check if 'option hidden 1' makes sense for adhoc-mode-only routers

# auf DSLer/Satama: ip: 10.63.119.1
# iptables -t nat -I PREROUTING -i $WANDEV -p tcp --dport 443 -j DNAT --to-destination 10.63.222.1:80
# iptables -t nat -I POSTROUTING -d 10.63.222.1 -j MASQUERADE
# test: http://pubip:443/robots.txt

# auf DSLer/FparkSsee: ip: 10.63.222.1, interner zielrrouter: 192.168.101.112
# iptables -t nat -I PREROUTING -s 10.63.119.33 -p tcp --dport 80 -j DNAT --to-destination 192.168.101.112

# more generic solution for simulated hw-clock

# dell-2300:
# robocfg show (egal ob LAN- oder WAN-kabel steckt)
#
# probing eth1
# phyid: Success
# probing eth0
# phyid: Success
# bcm53xx_probe: Success



build()
* bug: minor: same gitrev-tarball must have the same hash
* bug: minor: leave channel untouched in AP-mode, when rewriting profile
* bug: minor: http://wiki.openwrt.org/doc/howto/vpn.nat.pptp
* feature+: (testing) no stopping cron.minutely due to SSH-action on all inet-offer-nodes
* feature+: use .txz instead of .tgz for tarball
* feature+: include mysshpubkeys.ipk -> /root/.ssh/authorized_keys | known_hosts
* feature+: include mydesign + mysettings
* feature+: build /tmp/loader + kalua_working_dir on demand directly in the image (safes space)
* feature+: rework zram-stuff, simple append '; echo >$size >$kernel' to /etc/modules.d/00-zram
* feature+: apply_profile: better use dhcp-space on wifi
* feature+: ipsystem() cleanup variables-usage, throw away everything which is not used
* feature+: ipsystem() new var: NETDEVPRE=WAN|LAN|WIFI - show if $IP is from lan/wan/wifi
* feature+: autoinstall/deinstall_if_needed of: luci-mod-admin-full + luci-theme-bootstrap + ( libiwinfo-lua )
* hardware: Picostation M2 = dmesg: "MyLoader: sysp=f0f0f0f0, boardp=f0f0f0f0, parts=f1f0f0f0" + "mtd: partition "rootfs_data" created automatically, ofs=3A0000, len=410000"
* hardware: Bullet:        = dmesg: "MyLoader: sysp=f0f0f0f0, boardp=f0f0f0f0, parts=f0f0f0f0" + "mtd: partition "rootfs_data" created automatically, ofs=390000, len=420000"
* specialtweak: elephant/76: dualradio/olsr-hna-slave-error?
* specialtweak: apply_profile: olympia/2: telefonanlage -> OlsrMainIp = $WIFIADR
* specialtweak: apply_profile: hotelloB01/K80: disable olsr-hna-slave
* specialtweak: preskil: timezone "MUT"
* specialtweak: fparkssee: 222: olsrd: hna-offer (it's over lan)
* specialtweak: marinapark: inet:96/10 :announce alias-ip
* specialtweak: galerie: 3_inet: no wan OLSR
* specialtweak: fparkssee: 223: must have 152 for neigh? -> rapid shrink of routing table?
* specialtweak: ejbw/52 -> landhcp on (flurtelefone)

vpn()
* feature+: cleanup andi's approach

netfilter()
* bug: major: use a dummy policy-routing rule on simplemesh to avoid clients
* bug: minor: remove /tmp/user-$HASH* during restart()
* documentation: describe dependencies for each mode
* feature+: move vds-data to user's dir /tmp/NETFILTER/USER/$MAC/dataretention
* feature+: support special dir for vds-data, e.g. softlinked to usbdisk?
* feature+: conntrack_max++ on 32mb+: http://wiki.imagestream.com/wiki/Resolving_%22ip_conntrack:_table_full,_dropping_packet%22_errors
* feature+: check if connection_tracking is really of when '-m state --state' is not used
* feature+: maintenance-mode() on: enforce 5353-dnsmasq + logout all + show special message in weblogin off: back to normal + simulate 8.8.8.8
* feature+: detect 0x1337-port action ("a neighbour reboots")
* feature+: config-option to forbid forwarding for local-net-clients ("no clients"), to have a simple/fast setup on mesh-nodes
* feature+: masquerade "$exception/$cidr"
* feature+: portforwarding start|stop: iptables -t nat -I PREROUTING -p tcp -i $WANDEV --dport 222 -j DNAT --to-destination 10.63.2.34:22
* feature+: user_quota add|del "$mac" "$upload" "$download"
* feature+: user_quota query "$mac" <up|down|all>
* feature+: user_quota diff "$mac" <up|down|all>
* feature+: user_speed add|del "$mac" "$upload" "$download"
* feature+: user_adblock add|del
* feature+: olsr_whitelist (no more double ip's by accident) + monitoring bad packets
* feature+: use "passiv" speedtesting with connbytes: packets/quantum


lowmem()
* feature+: maintain a list if essential kmods/hardware-type, instead of checking each if used
* feature+: dynamically remove wandev, if not needed
* feature+: switch off lan-dhcp on APs
* feature+: switch off dhcp-script in APs
* feature+: use zram-based ramdisk instead of tmpfs (frontswap/cleancache)
* feature+: measure ssh-port-activity, kill daemon if no action for x minutes
* feature+: build config_profile-specific dhcp-script during startup (lowering condition checks/size)
* idea: instead of crond, use: 'while :; do . /tmp/cron.script; sleep 60; done &' -> problem? does it really safe mem?

misc()
* bug: major: fparkssee/222: cron.check_inet_gw / laninet_offer
* bug: major: patch mtd.c for verify + correct error-codes, respect that in sysupgrade
* bug: major: netintern scp with pubkeys is b0rken?
* bug: minor: why hangs '/etc/init.d/rcS' + 'logger' in tasklist
* bug: minor: change timing for inet-speedtest to be more accurate
* bug: minor: speedtest without iptables -> use /proc/net/dev -> e.g. $WANDEV
* bug: minor: change server/file for inet-speedtest (roundrobin)
* bug: minor: during speedtest disable any forwarding to be more accurate
* bug: minor: remove all occurences of normal wget: cron.upgrade_packages / cron.evaluate_ulogd / speedtest?
* bug: minor: read dbclient cmdline + check ssh/http-reverse-ssh-tunnel correctly
* feature+: collect radio-stats each minute (ath9k)
* feature+: shell/logger: lookout for a way the handover "interactive" mode, e.g. *.sh calls another *.sh
* feature+: use curl or ssl-enabled wget for HTTPS-based REST for internal communication instead of plain HTTP
* feature+: set a maximum pause/uptime before running a scheduler job/in general, so we have "unknown" reboot
* feature+: firmware_burn() no pause in image-on-flash mode
* feature+: get rid of the cronwatchdog.sh
* feature+: use something like crondog.o, which pitches the kernel watchdog every 20 secs
* feature+: kalua-loader: only regen, if md5sum differs (overall/each class)
* feature+: if inet_offer via WANDEV, check regulary ping to gateway (primacom-problem)
* feature+: overclocking WRT54G? http://www.dd-wrt.com/wiki/index.php/Linksys_WRT54G/GL/GS/GX#Clock_Speed_and_Overclocking
* feature+: overclocking WHR-HP-54g (EU-version)? http://www.dd-wrt.com/phpBB2/viewtopic.php?p=102911&sid=01f76318a484a52a3267e4c2fe61ef41
* feature+: choose random channel on ap on early boot
* feature+: firmware_update_pmu() needs locking
* feature+: make logile-archive-length (monitoring etc.) configureable and limit it on lowmem-devices
* feature+: uci2nvram-wrapper for having a configureable lowflash-squashfs-only-device
* feature+: after setting time with ntp, safe /tmp/uptime2unixtime - so we have an offset for easy calculating
* cleanup: use generic locking-mechanism and use /tmp/lock
* cleanup: remove all calls to nvram-stuff

documentation()
* feature+: add screenshots of userdb-gui
* feature+: add screenshots of several splash-pages/captive-portals/weblogins
* feature+: add script for generate functions-call-graph with arguments

upgrade_packages()
* feature+: success? broadcast to all neighbours: "do it now"
* cleanup: use wget() for fetching or maybe activate busybox-option 'wget -T xxx'
* cleanup: use full opkg features for upgrade: if package-source-list is in ramdisk, temporarily hide full repo but leave ours alive and use 'opkg update', 'opkg install mydesign' (upgrade?)

switch()
* bug: minor: be correct when translating vlans, e.g. if somebody has changed the position of wan-port
* feature+: check every minute, if state of wan-port has changed: do ifup/ifdown accordingly
* feature+: detect permanent status-change of one or more ports
* feature+: detect time of port-status-change and include in monitoring

pdf()
* feature+: ongoing site-numbers for overview
* feature+: ongoing ticketnumber for labels

monitoring()
* bug: minor: after each correct transmitted line, move the OK-mark one line further (now, a wrong transmission after line 99/100 will cause an retransmission of all 99 lines)
* feature+: implement heartbeat, which simply refreshes old values ("no change, but alive")
* feature+: add some more speedtest-servers/files and use appropriate, e.g. in mauritus: http://www.gov.mu/portal/goc/educationsite/file/Livelihood%20And%20Trade%20Skills%20Book.pdf
* feature+: show: minstrelRX from my wifi-gateway '_tool remote $gateway minstrel'
* feature+: show: /www/dmesg.$$ + how many lines dmesg has raised during boot
* feature+: show: how many connection time, how many wifi-clients
* feature+: show: dhcp via trafficlight: LAN-max+used|WIFI-max+used|dhcpscript-on/off|dnsserver (color=symbol or ip)|cachesize|queries|cachehits|size:/etc/local.hosts (adblock)
* feature+: show: olsrd on/off
* feature+: show: last weblogin-fetch
* feature+: show: last weblogin-good-login
* feature+: show: last dhcp-offer
* feature+: show: db: profiles/logins/devices/index?
* feature+: different/shorter intervals for different values
* feature+: for specific changes fire a monitoring send immediately
* feature+: show: detect usb-stick plugin/out
* feature+: show: per neigh: HT20/HT40, LGI/SGI, MCS xy/rate
* feature+: show: wifi_signal() non_olsr_clients
* feature+: show: count of different connected clients LAN/WIFI + conn_time
* feature+: show: last wifi_phy_restart() reason (if any)
* feature+: show: count of usertunnels
* feature+: intranet internal aggregation of monitoring data
* feature+: network-map with javascript: http://thejit.org/demos/ -> http://thejit.org/static/v20/Jit/Examples/ForceDirected/example2.js
* feature+: network-map 3d with js: http://mrdoob.github.com/three.js/ -> http://mrdoob.github.com/three.js/examples/canvas_lines.html

monitoring-server()
* bug: password-protect admin-interface
* bug: accept/deny hostname if more than one is given (e.g. changed a correct hostname)
* feature+: allow change of arbitrary values via webif
* feature+: show olsrd-errors in relation to time-unit
* feature+: detect devices with always short uptime
* feature+: use 'logo.gif' from 'design.ipk' of all profiles to build a nice summary

olsr()
* bug: major: check_plausi() costs_getting_worse: doess the double check really work? (comparing correct database?)
* bug: minor: olsr-hna-slave: don't become a slave, if behind is an further olsr-neigh (e.g. at wandev, but default is via lan)
* bug: minor: olsr-hna-slave: master: block olsr-packets from slave before restarting daemon, otherwise we get the hna again
* feature+: deactivate arp-plugin, make arp permanent during check_plausi()
* feature+: olsr-hna-slave: if OK for specific host is often, output NEVER
* feature+: olsr-hna-slave: if answer is NEVER, dont try again this ip
* feature+: olsr-hna-slave: force to ask a specific neigh, if "ip" is set via uci
* feature+: maintain a list of all HNA-entries, lookout for missing ones
* feature+: check_plausi: detect: no_wifi_neigh, but had_good_before
* feature+: check_plausi: detect: lost a good neigh

sms()
* feature+: simplify procedure and use/send only one token (not username+password)
* feature+: premium-sms
* feature+: text2pay
* feature+: smsbox.net

fax()
* feature+: implement sipgate-API

userdb()
* bug: major: check if '_db user device show $ID' can be changed to be more exakt, e.g. append 'last'?
* bug: major: respect settings how much macs/devices are allowed to getin with one login (b0rken)
* bug: major: respect group-logins during device-check (e.g. devices eat up limit for 1 login)
* bug: minor: respect race, if index_gen runs, but new logins will be added
* bug: minor: change specific login -> index_gen runs not automatically or wrong
* feature+: implement ticket-print for Avery Zweckform Quick&Clean C32011
* feature+: remember last OK ticket-mail-sending - profile specific
* feature+: list_logins: last week, last month ...
* feature+: during cron.add-traff, built: active_users.html -> show in userdb-gui (+overall time/traff)
* feature+: index_gen() allow specific login (fast!)
* feature+: report() username/password or login_id -> fetches all devices
* feature+: report() $mac: -> PDF -> email
* feature+: report() show XX devices on YY routers
* feature+: report() top 10 users, top 10 devices
* feature+: report() show theoretical max download and "x percent of" for top-graphs + typical up/download ratio
* feature+: report() rotate_view() http://meinews.niuz.biz/re-t496245.html?s=1bf4dc343372425d68a62bcd18de7a6d&amp;
* feature+: report() punchcard: http://g.raphaeljs.com/dotchart.html
* feature+: report() traffic: http://g.raphaeljs.com/linechart.html
* feature+: measure tickets/s during index_gen and safe this value
* feature+: during index_gen write a mark each 30sec according to speed-value (see above)
* feature+: profile: allow access to internal network: yes/no
* feature+: profile: sanitize all speed-values to integer
* feature+: meta: weblogin = username/password | sms | both: (which is default)(user selectable)
* feature+: meta: weblogin is blocked, if hostname is virgin: yes/no
* feature+: meta: emails, sms-numbers, fax-numbers 
* feature+: meta: object name, speed uplink/downlink, ...
* feature+: meta: default language for weblogin (=order of languages)
* feature+: login: add message to user on next login
* feature+: login: temporarily disable a login
* feature+: relation between login and free-lan-dhcp-device
* feature+: list_logins: show used_or_not
* feature+: list_logins: show last used time
* feature+: username_namespace: 'islands of the world'
* feature+: auto distribute DB over network
* feature+: after making e.g. 32 logins, print a direct link to overview
* feature+: index_gen() if password = number && fuzzy-mode -> _list uniq $(hashes)
* cleanup: move hardcoded db-servers into config_var which is set during apply_profile

weblogin()
* bug: minor: translate logout-page
* bug: major: sms-mode: make sure, that phonenumer is safed in database
* cleanup: minor: change/translate varnames in terms_of_use.meta
* feature+: link to installation-object-name/webpage on logo
* feature+: fakepop / autoanswer pop3 action ("please login")
* feature+: make use of user-language via HTTP_ACCEPT_LANGUAGE
* feature+: make the sms-auth only visible in configurable timeslots
* feature+: implement credit-card API for payment
* feature+: implement import of xml/csv logins

usertunnel()
* bug: minor: allow local entry in/out: e.g. direct connection to inet_offering node
* bug: minor: check via ping the other tunnel-end - stop tunnel if fails (test: server reboots)
* bug: minor: disconnecting client: rewrite all.conf + remove client.conf 
* bug: minor: use different config-file-names on client/server
* bug: minor: release unused tunnel IDs
* feature+: explicit intranet tunnels (compression, another shaping?)
* feature+: join several tunnels into one, to corectly shape several devices with one login

config()
* bug: minor: leave already configured special network/vlan-settings
* feature+: make WAN-olsr better configureable
* feature+: repect /tmp/resolv.conf.ppp + .auto? (faster resolution)
* feature+: use special ip4 for service HNA/redundancy: 6.6.6.[5|6|7|8] = monitoring|dns|userdb|tunnelsrv

scheduler()
* bug: minor: why does it happen: "scheduler_allow_run() removing lockfile, which seems to be left by accident"
* feature+: run tasks at a specific time

net()
* cleanup: implement pingtest-abstraction and use it
* feature+: sort "/tmp/dhcp.leases" | while read LINE; do set $LINE; echo "$( _system date unixtime2date $1 ) $LINE";done

wifi()
* bug: major: b43: "BCM4318 chipset: AP mode does not work because of packet loss in high transmission rates"
* feature+: check if arping-test raised wifi-tx-counter
* feature+: b43: try module parameter 'nohwcrypt=1 qos=0' (lowering mem?)

